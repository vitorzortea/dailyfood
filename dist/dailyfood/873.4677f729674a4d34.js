(self.webpackChunkdailyfood=self.webpackChunkdailyfood||[]).push([[873],{7873:(ah,B,K)=>{"use strict";K.r(B),K.d(B,{PanelModule:()=>O0});var ze=K(6895),_=K(9392),At=K(9751),ho=K(5698),rc=K(5226),Fe=K.n(rc),g=K(4650),Ie=K(4004),j=(()=>{return(n=j||(j={}))[n.PLAIN_TO_CLASS=0]="PLAIN_TO_CLASS",n[n.CLASS_TO_PLAIN=1]="CLASS_TO_PLAIN",n[n.CLASS_TO_CLASS=2]="CLASS_TO_CLASS",j;var n})();const je=new class ic{constructor(){this._typeMetadatas=new Map,this._transformMetadatas=new Map,this._exposeMetadatas=new Map,this._excludeMetadatas=new Map,this._ancestorsMap=new Map}addTypeMetadata(e){this._typeMetadatas.has(e.target)||this._typeMetadatas.set(e.target,new Map),this._typeMetadatas.get(e.target).set(e.propertyName,e)}addTransformMetadata(e){this._transformMetadatas.has(e.target)||this._transformMetadatas.set(e.target,new Map),this._transformMetadatas.get(e.target).has(e.propertyName)||this._transformMetadatas.get(e.target).set(e.propertyName,[]),this._transformMetadatas.get(e.target).get(e.propertyName).push(e)}addExposeMetadata(e){this._exposeMetadatas.has(e.target)||this._exposeMetadatas.set(e.target,new Map),this._exposeMetadatas.get(e.target).set(e.propertyName,e)}addExcludeMetadata(e){this._excludeMetadatas.has(e.target)||this._excludeMetadatas.set(e.target,new Map),this._excludeMetadatas.get(e.target).set(e.propertyName,e)}findTransformMetadatas(e,t,s){return this.findMetadatas(this._transformMetadatas,e,t).filter(r=>!r.options||!0===r.options.toClassOnly&&!0===r.options.toPlainOnly||(!0===r.options.toClassOnly?s===j.CLASS_TO_CLASS||s===j.PLAIN_TO_CLASS:!0!==r.options.toPlainOnly||s===j.CLASS_TO_PLAIN))}findExcludeMetadata(e,t){return this.findMetadata(this._excludeMetadatas,e,t)}findExposeMetadata(e,t){return this.findMetadata(this._exposeMetadatas,e,t)}findExposeMetadataByCustomName(e,t){return this.getExposedMetadatas(e).find(s=>s.options&&s.options.name===t)}findTypeMetadata(e,t){return this.findMetadata(this._typeMetadatas,e,t)}getStrategy(e){const t=this._excludeMetadatas.get(e),s=t&&t.get(void 0),r=this._exposeMetadatas.get(e),i=r&&r.get(void 0);return s&&i||!s&&!i?"none":s?"excludeAll":"exposeAll"}getExposedMetadatas(e){return this.getMetadata(this._exposeMetadatas,e)}getExcludedMetadatas(e){return this.getMetadata(this._excludeMetadatas,e)}getExposedProperties(e,t){return this.getExposedMetadatas(e).filter(s=>!s.options||!0===s.options.toClassOnly&&!0===s.options.toPlainOnly||(!0===s.options.toClassOnly?t===j.CLASS_TO_CLASS||t===j.PLAIN_TO_CLASS:!0!==s.options.toPlainOnly||t===j.CLASS_TO_PLAIN)).map(s=>s.propertyName)}getExcludedProperties(e,t){return this.getExcludedMetadatas(e).filter(s=>!s.options||!0===s.options.toClassOnly&&!0===s.options.toPlainOnly||(!0===s.options.toClassOnly?t===j.CLASS_TO_CLASS||t===j.PLAIN_TO_CLASS:!0!==s.options.toPlainOnly||t===j.CLASS_TO_PLAIN)).map(s=>s.propertyName)}clear(){this._typeMetadatas.clear(),this._exposeMetadatas.clear(),this._excludeMetadatas.clear(),this._ancestorsMap.clear()}getMetadata(e,t){const s=e.get(t);let r;s&&(r=Array.from(s.values()).filter(o=>void 0!==o.propertyName));const i=[];for(const o of this.getAncestors(t)){const a=e.get(o);if(a){const l=Array.from(a.values()).filter(h=>void 0!==h.propertyName);i.push(...l)}}return i.concat(r||[])}findMetadata(e,t,s){const r=e.get(t);if(r){const i=r.get(s);if(i)return i}for(const i of this.getAncestors(t)){const o=e.get(i);if(o){const a=o.get(s);if(a)return a}}}findMetadatas(e,t,s){const r=e.get(t);let i;r&&(i=r.get(s));const o=[];for(const a of this.getAncestors(t)){const l=e.get(a);l&&l.has(s)&&o.push(...l.get(s))}return o.slice().reverse().concat((i||[]).slice().reverse())}getAncestors(e){if(!e)return[];if(!this._ancestorsMap.has(e)){const t=[];for(let s=Object.getPrototypeOf(e.prototype.constructor);typeof s.prototype<"u";s=Object.getPrototypeOf(s.prototype.constructor))t.push(s);this._ancestorsMap.set(e,t)}return this._ancestorsMap.get(e)}};class wt{constructor(e,t){this.transformationType=e,this.options=t,this.recursionStack=new Set}transform(e,t,s,r,i,o=0){if(Array.isArray(t)||t instanceof Set){const a=r&&this.transformationType===j.PLAIN_TO_CLASS?function In(n){const e=new n;return e instanceof Set||"push"in e?e:[]}(r):[];return t.forEach((l,h)=>{const f=e?e[h]:void 0;if(this.options.enableCircularCheck&&this.isCircular(l))this.transformationType===j.CLASS_TO_CLASS&&(a instanceof Set?a.add(l):a.push(l));else{let p;if("function"!=typeof s&&s&&s.options&&s.options.discriminator&&s.options.discriminator.property&&s.options.discriminator.subTypes){if(this.transformationType===j.PLAIN_TO_CLASS){p=s.options.discriminator.subTypes.find(S=>S.name===l[s.options.discriminator.property]);const I=s.typeFunction({newObject:a,object:l,property:void 0});p=void 0===p?I:p.value,s.options.keepDiscriminatorProperty||delete l[s.options.discriminator.property]}this.transformationType===j.CLASS_TO_CLASS&&(p=l.constructor),this.transformationType===j.CLASS_TO_PLAIN&&(l[s.options.discriminator.property]=s.options.discriminator.subTypes.find(v=>v.value===l.constructor).name)}else p=s;const y=this.transform(f,l,p,void 0,l instanceof Map,o+1);a instanceof Set?a.add(y):a.push(y)}}),a}if(s===String&&!i)return null==t?t:String(t);if(s===Number&&!i)return null==t?t:Number(t);if(s===Boolean&&!i)return null==t?t:Boolean(t);if((s===Date||t instanceof Date)&&!i)return t instanceof Date?new Date(t.valueOf()):null==t?t:new Date(t);if(function ms(){return typeof globalThis<"u"?globalThis:typeof global<"u"?global:typeof window<"u"?window:typeof self<"u"?self:void 0}().Buffer&&(s===Buffer||t instanceof Buffer)&&!i)return null==t?t:Buffer.from(t);if(function Tr(n){return null!==n&&"object"==typeof n&&"function"==typeof n.then}(t)&&!i)return new Promise((a,l)=>{t.then(h=>a(this.transform(void 0,h,s,void 0,void 0,o+1)),l)});if(!i&&null!==t&&"object"==typeof t&&"function"==typeof t.then)return t;if("object"==typeof t&&null!==t){!s&&t.constructor!==Object&&(!Array.isArray(t)&&t.constructor===Array||(s=t.constructor)),!s&&e&&(s=e.constructor),this.options.enableCircularCheck&&this.recursionStack.add(t);const a=this.getKeys(s,t,i);let l=e||{};!e&&(this.transformationType===j.PLAIN_TO_CLASS||this.transformationType===j.CLASS_TO_CLASS)&&(l=i?new Map:s?new s:{});for(const h of a){if("__proto__"===h||"constructor"===h)continue;const f=h;let v,p=h,y=h;if(!this.options.ignoreDecorators&&s)if(this.transformationType===j.PLAIN_TO_CLASS){const M=je.findExposeMetadataByCustomName(s,h);M&&(y=M.propertyName,p=M.propertyName)}else if(this.transformationType===j.CLASS_TO_PLAIN||this.transformationType===j.CLASS_TO_CLASS){const M=je.findExposeMetadata(s,h);M&&M.options&&M.options.name&&(p=M.options.name)}v=this.transformationType===j.PLAIN_TO_CLASS?t[f]:t instanceof Map?t.get(f):t[f]instanceof Function?t[f]():t[f];let I,S=v instanceof Map;if(s&&i)I=s;else if(s){const M=je.findTypeMetadata(s,y);if(M){const ue=M.typeFunction?M.typeFunction({newObject:l,object:t,property:y}):M.reflectedType;M.options&&M.options.discriminator&&M.options.discriminator.property&&M.options.discriminator.subTypes?t[f]instanceof Array?I=M:(this.transformationType===j.PLAIN_TO_CLASS&&(I=M.options.discriminator.subTypes.find(z=>{if(v&&v instanceof Object&&M.options.discriminator.property in v)return z.name===v[M.options.discriminator.property]}),I=void 0===I?ue:I.value,M.options.keepDiscriminatorProperty||v&&v instanceof Object&&M.options.discriminator.property in v&&delete v[M.options.discriminator.property]),this.transformationType===j.CLASS_TO_CLASS&&(I=v.constructor),this.transformationType===j.CLASS_TO_PLAIN&&v&&(v[M.options.discriminator.property]=M.options.discriminator.subTypes.find(z=>z.value===v.constructor).name)):I=ue,S=S||M.reflectedType===Map}else if(this.options.targetMaps)this.options.targetMaps.filter(L=>L.target===s&&!!L.properties[y]).forEach(L=>I=L.properties[y]);else if(this.options.enableImplicitConversion&&this.transformationType===j.PLAIN_TO_CLASS){const L=Reflect.getMetadata("design:type",s.prototype,y);L&&(I=L)}}const P=Array.isArray(t[f])?this.getReflectedType(s,y):void 0,J=e?e[f]:void 0;if(l.constructor.prototype){const M=Object.getOwnPropertyDescriptor(l.constructor.prototype,p);if((this.transformationType===j.PLAIN_TO_CLASS||this.transformationType===j.CLASS_TO_CLASS)&&(M&&!M.set||l[p]instanceof Function))continue}if(this.options.enableCircularCheck&&this.isCircular(v)){if(this.transformationType===j.CLASS_TO_CLASS){let M=v;M=this.applyCustomTransformations(M,s,h,t,this.transformationType),(void 0!==M||this.options.exposeUnsetFields)&&(l instanceof Map?l.set(p,M):l[p]=M)}}else{const M=this.transformationType===j.PLAIN_TO_CLASS?p:h;let L;this.transformationType===j.CLASS_TO_PLAIN?(L=t[M],L=this.applyCustomTransformations(L,s,M,t,this.transformationType),L=t[M]===L?v:L,L=this.transform(J,L,I,P,S,o+1)):void 0===v&&this.options.exposeDefaultValues?L=l[p]:(L=this.transform(J,v,I,P,S,o+1),L=this.applyCustomTransformations(L,s,M,t,this.transformationType)),(void 0!==L||this.options.exposeUnsetFields)&&(l instanceof Map?l.set(p,L):l[p]=L)}}return this.options.enableCircularCheck&&this.recursionStack.delete(t),l}return t}applyCustomTransformations(e,t,s,r,i){let o=je.findTransformMetadatas(t,s,this.transformationType);return void 0!==this.options.version&&(o=o.filter(a=>!a.options||this.checkVersion(a.options.since,a.options.until))),o=o.filter(this.options.groups&&this.options.groups.length?a=>!a.options||this.checkGroups(a.options.groups):a=>!a.options||!a.options.groups||!a.options.groups.length),o.forEach(a=>{e=a.transformFn({value:e,key:s,obj:r,type:i,options:this.options})}),e}isCircular(e){return this.recursionStack.has(e)}getReflectedType(e,t){if(!e)return;const s=je.findTypeMetadata(e,t);return s?s.reflectedType:void 0}getKeys(e,t,s){let r=je.getStrategy(e);"none"===r&&(r=this.options.strategy||"exposeAll");let i=[];if(("exposeAll"===r||s)&&(i=t instanceof Map?Array.from(t.keys()):Object.keys(t)),s)return i;if(this.options.ignoreDecorators&&this.options.excludeExtraneousValues&&e&&(i=[...je.getExposedProperties(e,this.transformationType),...je.getExcludedProperties(e,this.transformationType)]),!this.options.ignoreDecorators&&e){let o=je.getExposedProperties(e,this.transformationType);this.transformationType===j.PLAIN_TO_CLASS&&(o=o.map(l=>{const h=je.findExposeMetadata(e,l);return h&&h.options&&h.options.name?h.options.name:l})),i=this.options.excludeExtraneousValues?o:i.concat(o);const a=je.getExcludedProperties(e,this.transformationType);a.length>0&&(i=i.filter(l=>!a.includes(l))),void 0!==this.options.version&&(i=i.filter(l=>{const h=je.findExposeMetadata(e,l);return!h||!h.options||this.checkVersion(h.options.since,h.options.until)})),i=i.filter(this.options.groups&&this.options.groups.length?l=>{const h=je.findExposeMetadata(e,l);return!h||!h.options||this.checkGroups(h.options.groups)}:l=>{const h=je.findExposeMetadata(e,l);return!(h&&h.options&&h.options.groups&&h.options.groups.length)})}return this.options.excludePrefixes&&this.options.excludePrefixes.length&&(i=i.filter(o=>this.options.excludePrefixes.every(a=>o.substr(0,a.length)!==a))),i=i.filter((o,a,l)=>l.indexOf(o)===a),i}checkVersion(e,t){let s=!0;return s&&e&&(s=this.options.version>=e),s&&t&&(s=this.options.version<t),s}checkGroups(e){return!e||this.options.groups.some(t=>e.includes(t))}}const fe={enableCircularCheck:!1,enableImplicitConversion:!1,excludeExtraneousValues:!1,excludePrefixes:void 0,exposeDefaultValues:!1,exposeUnsetFields:!0,groups:void 0,ignoreDecorators:!1,strategy:void 0,targetMaps:void 0,version:void 0},re=new class Cn{instanceToPlain(e,t){return new wt(j.CLASS_TO_PLAIN,{...fe,...t}).transform(void 0,e,void 0,void 0,void 0,void 0)}classToPlainFromExist(e,t,s){return new wt(j.CLASS_TO_PLAIN,{...fe,...s}).transform(t,e,void 0,void 0,void 0,void 0)}plainToInstance(e,t,s){return new wt(j.PLAIN_TO_CLASS,{...fe,...s}).transform(void 0,t,e,void 0,void 0,void 0)}plainToClassFromExist(e,t,s){return new wt(j.PLAIN_TO_CLASS,{...fe,...s}).transform(e,t,void 0,void 0,void 0,void 0)}instanceToInstance(e,t){return new wt(j.CLASS_TO_CLASS,{...fe,...t}).transform(void 0,e,void 0,void 0,void 0,void 0)}classToClassFromExist(e,t,s){return new wt(j.CLASS_TO_CLASS,{...fe,...s}).transform(t,e,void 0,void 0,void 0,void 0)}serialize(e,t){return JSON.stringify(this.instanceToPlain(e,t))}deserialize(e,t,s){const r=JSON.parse(t);return this.plainToInstance(e,r,s)}deserializeArray(e,t,s){const r=JSON.parse(t);return this.plainToInstance(e,r,s)}};class Er{constructor(e,t,s){this.type=e,this.firestore=t,this.caminho=s,this.ref=this.firestore.collection(this.caminho)}get(e){return this.ref.doc(e).get().pipe((0,Ie.U)(s=>this.docToClass(s)))}list(){return this.ref.valueChanges()}createOrUpdate(e){let t=e.id;if(!e)return null;let s=null;return s=e instanceof this.type?e.toObject():e,t?this.ref.doc(t).set(s,{merge:!0}):this.ref.add(s).then(r=>{s.id=r.id,this.ref.doc(r.id).set(s,{merge:!0})})}delete(e){return this.ref.doc(e).delete()}docToClass(e){let t={id:e.id,...e.data()};return function fo(n,e,t){return re.plainToInstance(n,e,t)}(this.type,t)}}class vt{toObject(){let e=function X(n,e){return re.instanceToPlain(n,e)}(this);return delete e.id,e}}class En extends vt{}class mo extends vt{}class ys extends vt{}var Sr=K(4986),ws=K(8996),vs=K(9646),$e=K(2122),Ht=K(8675),ac=K(4482),Qt=K(5403);function Re(){return(0,ac.e)((n,e)=>{let t,s=!1;n.subscribe((0,Qt.x)(e,r=>{const i=t;t=r,s&&e.next([i,r]),s=!0}))})}var N,rt=K(5026),cc=K(1884),He=K(9300),Zt=K(2011),go=(K(4217),K(3942)),w=K(5861),Qe=K(9681),pt=K(4859),Je=K(1877),q=K(2090),De=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ut={},Ve=Ve||{},V=De||self;function Sn(){}function An(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Dt(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var Ar="closure_uid_"+(1e9*Math.random()>>>0),G=0;function hc(n,e,t){return n.call.apply(n.bind,arguments)}function dc(n,e,t){if(!n)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,s),n.apply(e,r)}}return function(){return n.apply(e,arguments)}}function Ce(n,e,t){return(Ce=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?hc:dc).apply(null,arguments)}function bs(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var s=t.slice();return s.push.apply(s,arguments),n.apply(this,s)}}function Ee(n,e){function t(){}t.prototype=e.prototype,n.X=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Wb=function(s,r,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[r].apply(s,o)}}function Ke(){this.s=this.s,this.o=this.o}Ke.prototype.s=!1,Ke.prototype.na=function(){!this.s&&(this.s=!0,this.M(),0)&&function lc(n){Object.prototype.hasOwnProperty.call(n,Ar)&&n[Ar]||(n[Ar]=++G)}(this)},Ke.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const yo=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function kr(n){const e=n.length;if(0<e){const t=Array(e);for(let s=0;s<e;s++)t[s]=n[s];return t}return[]}function wo(n,e){for(let t=1;t<arguments.length;t++){const s=arguments[t];if(An(s)){const r=n.length||0,i=s.length||0;n.length=r+i;for(let o=0;o<i;o++)n[r+o]=s[o]}else n.push(s)}}function Me(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Me.prototype.h=function(){this.defaultPrevented=!0};var Dr=function(){if(!V.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{V.addEventListener("test",Sn,e),V.removeEventListener("test",Sn,e)}catch{}return n}();function xs(n){return/^[\s\xa0]*$/.test(n)}var vo=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function Mt(n,e){return n<e?-1:n>e?1:0}function _s(){var n=V.navigator;return n&&(n=n.userAgent)?n:""}function lt(n){return-1!=_s().indexOf(n)}function Mr(n){return Mr[" "](n),n}Mr[" "]=Sn;var Ts,n,Nr=lt("Opera"),Wt=lt("Trident")||lt("MSIE"),bo=lt("Edge"),Pr=bo||Wt,xo=lt("Gecko")&&!(-1!=_s().toLowerCase().indexOf("webkit")&&!lt("Edge"))&&!(lt("Trident")||lt("MSIE"))&&!lt("Edge"),mc=-1!=_s().toLowerCase().indexOf("webkit")&&!lt("Edge");function _o(){var n=V.document;return n?n.documentMode:void 0}e:{var Or="",Lr=(n=_s(),xo?/rv:([^\);]+)(\)|;)/.exec(n):bo?/Edge\/([\d\.]+)/.exec(n):Wt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):mc?/WebKit\/(\S+)/.exec(n):Nr?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(Lr&&(Or=Lr?Lr[1]:""),Wt){var Fr=_o();if(null!=Fr&&Fr>parseFloat(Or)){Ts=String(Fr);break e}}Ts=Or}var gc={};var Is=V.document&&Wt&&(_o()||parseInt(Ts,10))||void 0;function xe(n,e){if(Me.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,s=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(xo){e:{try{Mr(e.nodeName);var r=!0;break e}catch{}r=!1}r||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:yc[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&xe.X.h.call(this)}}Ee(xe,Me);var yc={2:"touch",3:"pen",4:"mouse"};xe.prototype.h=function(){xe.X.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var kn="closure_listenable_"+(1e6*Math.random()|0),wc=0;function To(n,e,t,s,r){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!s,this.ha=r,this.key=++wc,this.ba=this.ea=!1}function Cs(n){n.ba=!0,n.listener=null,n.proxy=null,n.src=null,n.ha=null}function Br(n,e,t){for(const s in n)e.call(t,n[s],s,n)}function Io(n){const e={};for(const t in n)e[t]=n[t];return e}const qr="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Co(n,e){let t,s;for(let r=1;r<arguments.length;r++){for(t in s=arguments[r],s)n[t]=s[t];for(let i=0;i<qr.length;i++)t=qr[i],Object.prototype.hasOwnProperty.call(s,t)&&(n[t]=s[t])}}function Dn(n){this.src=n,this.g={},this.h=0}function Ur(n,e){var t=e.type;if(t in n.g){var i,s=n.g[t],r=yo(s,e);(i=0<=r)&&Array.prototype.splice.call(s,r,1),i&&(Cs(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function jr(n,e,t,s){for(var r=0;r<n.length;++r){var i=n[r];if(!i.ba&&i.listener==e&&i.capture==!!t&&i.ha==s)return r}return-1}Dn.prototype.add=function(n,e,t,s,r){var i=n.toString();(n=this.g[i])||(n=this.g[i]=[],this.h++);var o=jr(n,e,s,r);return-1<o?(e=n[o],t||(e.ea=!1)):((e=new To(e,this.src,i,!!s,r)).ea=t,n.push(e)),e};var $r="closure_lm_"+(1e6*Math.random()|0),Kr={};function Eo(n,e,t,s,r){if(s&&s.once)return Gr(n,e,t,s,r);if(Array.isArray(e)){for(var i=0;i<e.length;i++)Eo(n,e[i],t,s,r);return null}return t=Zr(t),n&&n[kn]?n.N(e,t,Dt(s)?!!s.capture:!!s,r):So(n,e,t,!1,s,r)}function So(n,e,t,s,r,i){if(!e)throw Error("Invalid event type");var o=Dt(r)?!!r.capture:!!r,a=Es(n);if(a||(n[$r]=a=new Dn(n)),(t=a.add(e,t,s,o,i)).proxy)return t;if(s=function vc(){const e=bc;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=s,s.src=n,s.listener=t,n.addEventListener)Dr||(r=o),void 0===r&&(r=!1),n.addEventListener(e.toString(),s,r);else if(n.attachEvent)n.attachEvent(Ao(e.toString()),s);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(s)}return t}function Gr(n,e,t,s,r){if(Array.isArray(e)){for(var i=0;i<e.length;i++)Gr(n,e[i],t,s,r);return null}return t=Zr(t),n&&n[kn]?n.O(e,t,Dt(s)?!!s.capture:!!s,r):So(n,e,t,!0,s,r)}function zr(n,e,t,s,r){if(Array.isArray(e))for(var i=0;i<e.length;i++)zr(n,e[i],t,s,r);else s=Dt(s)?!!s.capture:!!s,t=Zr(t),n&&n[kn]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=jr(i=n.g[e],t,s,r))&&(Cs(i[t]),Array.prototype.splice.call(i,t,1),0==i.length&&(delete n.g[e],n.h--))):n&&(n=Es(n))&&(e=n.g[e.toString()],n=-1,e&&(n=jr(e,t,s,r)),(t=-1<n?e[n]:null)&&Hr(t))}function Hr(n){if("number"!=typeof n&&n&&!n.ba){var e=n.src;if(e&&e[kn])Ur(e.i,n);else{var t=n.type,s=n.proxy;e.removeEventListener?e.removeEventListener(t,s,n.capture):e.detachEvent?e.detachEvent(Ao(t),s):e.addListener&&e.removeListener&&e.removeListener(s),(t=Es(e))?(Ur(t,n),0==t.h&&(t.src=null,e[$r]=null)):Cs(n)}}}function Ao(n){return n in Kr?Kr[n]:Kr[n]="on"+n}function bc(n,e){if(n.ba)n=!0;else{e=new xe(e,this);var t=n.listener,s=n.ha||n.src;n.ea&&Hr(n),n=t.call(s,e)}return n}function Es(n){return(n=n[$r])instanceof Dn?n:null}var Qr="__closure_events_fn_"+(1e9*Math.random()>>>0);function Zr(n){return"function"==typeof n?n:(n[Qr]||(n[Qr]=function(e){return n.handleEvent(e)}),n[Qr])}function ie(){Ke.call(this),this.i=new Dn(this),this.P=this,this.I=null}function _e(n,e){var t,s=n.I;if(s)for(t=[];s;s=s.I)t.push(s);if(n=n.P,s=e.type||e,"string"==typeof e)e=new Me(e,n);else if(e instanceof Me)e.target=e.target||n;else{var r=e;Co(e=new Me(s,n),r)}if(r=!0,t)for(var i=t.length-1;0<=i;i--){var o=e.g=t[i];r=Ss(o,s,!0,e)&&r}if(r=Ss(o=e.g=n,s,!0,e)&&r,r=Ss(o,s,!1,e)&&r,t)for(i=0;i<t.length;i++)r=Ss(o=e.g=t[i],s,!1,e)&&r}function Ss(n,e,t,s){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var r=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ba&&o.capture==t){var a=o.listener,l=o.ha||o.src;o.ea&&Ur(n.i,o),r=!1!==a.call(l,s)&&r}}return r&&!s.defaultPrevented}Ee(ie,Ke),ie.prototype[kn]=!0,ie.prototype.removeEventListener=function(n,e,t,s){zr(this,n,e,t,s)},ie.prototype.M=function(){if(ie.X.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],s=0;s<t.length;s++)Cs(t[s]);delete n.g[e],n.h--}}this.I=null},ie.prototype.N=function(n,e,t,s){return this.i.add(String(n),e,!1,t,s)},ie.prototype.O=function(n,e,t,s){return this.i.add(String(n),e,!0,t,s)};var Mn=V.JSON.stringify;function ko(){var n=Yr;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var Wr,Do=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new _c,n=>n.reset());class _c{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Tc(n){V.setTimeout(()=>{throw n},0)}function Mo(n,e){Wr||function Nn(){var n=V.Promise.resolve(void 0);Wr=function(){n.then(Ic)}}(),Xr||(Wr(),Xr=!0),Yr.add(n,e)}var Xr=!1,Yr=new class xc{constructor(){this.h=this.g=null}add(e,t){const s=Do.get();s.set(e,t),this.h?this.h.next=s:this.g=s,this.h=s}};function Ic(){for(var n;n=ko();){try{n.h.call(n.g)}catch(t){Tc(t)}var e=Do;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Xr=!1}function As(n,e){ie.call(this),this.h=n||1,this.g=e||V,this.j=Ce(this.lb,this),this.l=Date.now()}function Jr(n){n.ca=!1,n.R&&(n.g.clearTimeout(n.R),n.R=null)}function ei(n,e,t){if("function"==typeof n)t&&(n=Ce(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=Ce(n.handleEvent,n)}return 2147483647<Number(e)?-1:V.setTimeout(n,e||0)}function No(n){n.g=ei(()=>{n.g=null,n.i&&(n.i=!1,No(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}Ee(As,ie),(N=As.prototype).ca=!1,N.R=null,N.lb=function(){if(this.ca){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-n):(this.R&&(this.g.clearTimeout(this.R),this.R=null),_e(this,"tick"),this.ca&&(Jr(this),this.start()))}},N.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},N.M=function(){As.X.M.call(this),Jr(this),delete this.g};class Cc extends Ke{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:No(this)}M(){super.M(),this.g&&(V.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Pn(n){Ke.call(this),this.h=n,this.g={}}Ee(Pn,Ke);var Po=[];function Oo(n,e,t,s){Array.isArray(t)||(t&&(Po[0]=t.toString()),t=Po);for(var r=0;r<t.length;r++){var i=Eo(e,t[r],s||n.handleEvent,!1,n.h||n);if(!i)break;n.g[i.key]=i}}function ti(n){Br(n.g,function(e,t){this.g.hasOwnProperty(t)&&Hr(e)},n),n.g={}}function ks(){this.g=!0}function Xt(n,e,t,s){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function On(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var s=t[n];if(!(2>s.length)){var r=s[1];if(Array.isArray(r)&&!(1>r.length)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<r.length;o++)r[o]=""}}}return Mn(t)}catch{return e}}(n,t)+(s?" "+s:"")})}Pn.prototype.M=function(){Pn.X.M.call(this),ti(this)},Pn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ks.prototype.Aa=function(){this.g=!1},ks.prototype.info=function(){};var Pt={},Lo=null;function Ms(){return Lo=Lo||new ie}function ni(n){Me.call(this,Pt.Pa,n)}function Yt(n){const e=Ms();_e(e,new ni(e))}function si(n,e){Me.call(this,Pt.STAT_EVENT,n),this.stat=e}function Be(n){const e=Ms();_e(e,new si(e,n))}function Fo(n,e){Me.call(this,Pt.Qa,n),this.size=e}function Ln(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return V.setTimeout(function(){n()},e)}Pt.Pa="serverreachability",Ee(ni,Me),Pt.STAT_EVENT="statevent",Ee(si,Me),Pt.Qa="timingevent",Ee(Fo,Me);var Ns={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},Ro={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function ri(){}function Vo(){}ri.prototype.h=null;var Os,Fn={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function ii(){Me.call(this,"d")}function Ps(){Me.call(this,"c")}function Jt(){}function Rn(n,e,t,s){this.l=n,this.j=e,this.m=t,this.U=s||1,this.S=new Pn(this),this.O=Ac,this.T=new As(n=Pr?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Bo}function Bo(){this.i=null,this.g="",this.h=!1}Ee(ii,Me),Ee(Ps,Me),Ee(Jt,ri),Jt.prototype.g=function(){return new XMLHttpRequest},Jt.prototype.i=function(){return{}},Os=new Jt;var Ac=45e3,oi={},Ls={};function ai(n,e,t){n.K=1,n.v=Bs(ht(e)),n.s=t,n.P=!0,qo(n,null)}function qo(n,e){n.F=Date.now(),en(n),n.A=ht(n.v);var t=n.A,s=n.U;Array.isArray(s)||(s=[String(s)]),hi(t.i,"t",s),n.C=0,t=n.l.H,n.h=new Bo,n.g=uh(n.l,t?e:null,!n.s),0<n.N&&(n.L=new Cc(Ce(n.La,n,n.g),n.N)),Oo(n.S,n.g,"readystatechange",n.ib),e=n.H?Io(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.da(n.A,n.u,n.s,e)):(n.u="GET",n.g.da(n.A,n.u,null,e)),Yt(),function Ds(n,e,t,s,r,i){n.info(function(){if(n.g)if(i)for(var o="",a=i.split("&"),l=0;l<a.length;l++){var h=a[l].split("=");if(1<h.length){var f=h[0];h=h[1];var p=f.split("_");o=2<=p.length&&"type"==p[1]?o+(f+"=")+h+"&":o+(f+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+s+") [attempt "+r+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.U,n.s)}function Uo(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Da}function ci(n,e,t){let r,s=!0;for(;!n.I&&n.C<t.length;){if(r=ui(n,t),r==Ls){4==e&&(n.o=4,Be(14),s=!1),Xt(n.j,n.m,null,"[Incomplete Response]");break}if(r==oi){n.o=4,Be(15),Xt(n.j,n.m,t,"[Invalid Chunk]"),s=!1;break}Xt(n.j,n.m,r,null),li(n,r)}Uo(n)&&r!=Ls&&r!=oi&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,Be(16),s=!1),n.i=n.i&&s,s?0<t.length&&!n.$&&(n.$=!0,(e=n.l).g==n&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+t.length),m(e),e.K=!0,Be(11))):(Xt(n.j,n.m,t,"[Invalid Chunked Response]"),Ft(n),Vn(n))}function ui(n,e){var t=n.C,s=e.indexOf("\n",t);return-1==s?Ls:(t=Number(e.substring(t,s)),isNaN(t)?oi:(s+=1)+t>e.length?Ls:(e=e.substr(s,t),n.C=s+t,e))}function en(n){n.V=Date.now()+n.O,Lt(n,n.O)}function Lt(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=Ln(Ce(n.gb,n),e)}function Fs(n){n.B&&(V.clearTimeout(n.B),n.B=null)}function Vn(n){0==n.l.G||n.I||ee(n.l,n)}function Ft(n){Fs(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,Jr(n.T),ti(n.S),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function li(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||fi(t.h,n)))if(!n.J&&fi(t.h,n)&&3==t.G){try{var s=t.Fa.g.parse(e)}catch{s=null}if(Array.isArray(s)&&3==s.length){var r=s;if(0==r[0]){e:if(!t.u){if(t.g){if(!(t.g.F+3e3<n.F))break e;F(t),Gs(t)}d(t),Be(18)}}else t.Ba=r[1],0<t.Ba-t.T&&37500>r[2]&&t.L&&0==t.A&&!t.v&&(t.v=Ln(Ce(t.cb,t),6e3));if(1>=Wo(t.h)&&t.ja){try{t.ja()}catch{}t.ja=void 0}}else pe(t,11)}else if((n.J||t.g==n)&&F(t),!xs(e))for(r=t.Fa.g.parse(e),e=0;e<r.length;e++){let h=r[e];if(t.T=h[0],h=h[1],2==t.G)if("c"==h[0]){t.I=h[1],t.ka=h[2];const f=h[3];null!=f&&(t.ma=f,t.j.info("VER="+t.ma));const p=h[4];null!=p&&(t.Ca=p,t.j.info("SVER="+t.Ca));const y=h[5];null!=y&&"number"==typeof y&&0<y&&(t.J=s=1.5*y,t.j.info("backChannelRequestTimeoutMs_="+s)),s=t;const v=n.g;if(v){const I=v.g?v.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(I){var i=s.h;i.g||-1==I.indexOf("spdy")&&-1==I.indexOf("quic")&&-1==I.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(pi(i,i.h),i.h=null))}if(s.D){const S=v.g?v.g.getResponseHeader("X-HTTP-Session-Id"):null;S&&(s.za=S,se(s.F,s.D,S))}}t.G=3,t.l&&t.l.xa(),t.$&&(t.P=Date.now()-n.F,t.j.info("Handshake RTT: "+t.P+"ms"));var o=n;if((s=t).sa=Hs(s,s.H?s.ka:null,s.V),o.J){mi(s.h,o);var a=o,l=s.J;l&&a.setTimeout(l),a.B&&(Fs(a),en(a)),s.g=o}else u(s);0<t.i.length&&zs(t)}else"stop"!=h[0]&&"close"!=h[0]||pe(t,7);else 3==t.G&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?pe(t,7):bi(t):"noop"!=h[0]&&t.l&&t.l.wa(h),t.A=0)}Yt()}catch{}}function jo(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(An(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function Dc(n){if(n.oa&&"function"==typeof n.oa)return n.oa();if(!n.W||"function"!=typeof n.W){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(An(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const s in n)e[t++]=s;return e}}}(n),s=function kc(n){if(n.W&&"function"==typeof n.W)return n.W();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(An(n)){for(var e=[],t=n.length,s=0;s<t;s++)e.push(n[s]);return e}for(s in e=[],t=0,n)e[t++]=n[s];return e}(n),r=s.length,i=0;i<r;i++)e.call(void 0,s[i],t&&t[i],n)}(N=Rn.prototype).setTimeout=function(n){this.O=n},N.ib=function(n){n=n.target;const e=this.L;e&&3==gt(n)?e.l():this.La(n)},N.La=function(n){try{if(n==this.g)e:{const f=gt(this.g);var e=this.g.Ea();if(this.g.aa(),!(3>f)&&(3!=f||Pr||this.g&&(this.h.h||this.g.fa()||na(this.g)))){this.I||4!=f||7==e||Yt(),Fs(this);var t=this.g.aa();this.Y=t;t:if(Uo(this)){var s=na(this.g);n="";var r=s.length,i=4==gt(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){Ft(this),Vn(this);var o="";break t}this.h.i=new V.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,n+=this.h.i.decode(s[e],{stream:i&&e==r-1});s.splice(0,r),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==t,function Ec(n,e,t,s,r,i,o){n.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+r+"]: "+e+"\n"+t+"\n"+i+" "+o})}(this.j,this.u,this.A,this.m,this.U,f,t),this.i){if(this.Z&&!this.J){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!xs(a)){var h=a;break t}}h=null}if(!(t=h)){this.i=!1,this.o=3,Be(12),Ft(this),Vn(this);break e}Xt(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,li(this,t)}this.P?(ci(this,f,o),Pr&&this.i&&3==f&&(Oo(this.S,this.T,"tick",this.hb),this.T.start())):(Xt(this.j,this.m,o,null),li(this,o)),4==f&&Ft(this),this.i&&!this.I&&(4==f?ee(this.l,this):(this.i=!1,en(this)))}else 400==t&&0<o.indexOf("Unknown SID")?(this.o=3,Be(12)):(this.o=0,Be(13)),Ft(this),Vn(this)}}}catch{}},N.hb=function(){if(this.g){var n=gt(this.g),e=this.g.fa();this.C<e.length&&(Fs(this),ci(this,n,e),this.i&&4!=n&&en(this))}},N.cancel=function(){this.I=!0,Ft(this)},N.gb=function(){this.B=null;const n=Date.now();0<=n-this.V?(function Sc(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Yt(),Be(17)),Ft(this),this.o=2,Vn(this)):Lt(this,this.V-n)};var $o=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function mt(n,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof mt){this.h=void 0!==e?e:n.h,Rs(this,n.j),this.s=n.s,this.g=n.g,Vs(this,n.m),this.l=n.l,e=n.i;var t=new Bn;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Ko(this,t),this.o=n.o}else n&&(t=String(n).match($o))?(this.h=!!e,Rs(this,t[1]||"",!0),this.s=Rt(t[2]||""),this.g=Rt(t[3]||"",!0),Vs(this,t[4]),this.l=Rt(t[5]||"",!0),Ko(this,t[6]||"",!0),this.o=Rt(t[7]||"")):(this.h=!!e,this.i=new Bn(null,this.h))}function ht(n){return new mt(n)}function Rs(n,e,t){n.j=t?Rt(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Vs(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Ko(n,e,t){e instanceof Bn?(n.i=e,function Lc(n,e){e&&!n.j&&(bt(n),n.i=null,n.g.forEach(function(t,s){var r=s.toLowerCase();s!=r&&(zo(this,s),hi(this,r,t))},n)),n.j=e}(n.i,n.h)):(t||(e=tn(e,Oc)),n.i=new Bn(e,n.h))}function se(n,e,t){n.i.set(e,t)}function Bs(n){return se(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Rt(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function tn(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Go),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Go(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}mt.prototype.toString=function(){var n=[],e=this.j;e&&n.push(tn(e,qs,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(tn(e,qs,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(tn(t,"/"==t.charAt(0)?Pc:Nc,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",tn(t,Us)),n.join("")};var qs=/[#\/\?@]/g,Nc=/[#\?:]/g,Pc=/[#\?]/g,Oc=/[#\?@]/g,Us=/#/g;function Bn(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function bt(n){n.g||(n.g=new Map,n.h=0,n.i&&function Mc(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var s=n[t].indexOf("="),r=null;if(0<=s){var i=n[t].substring(0,s);r=n[t].substring(s+1)}else i=n[t];e(i,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function zo(n,e){bt(n),e=nn(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Ho(n,e){return bt(n),e=nn(n,e),n.g.has(e)}function hi(n,e,t){zo(n,e),0<t.length&&(n.i=null,n.g.set(nn(n,e),kr(t)),n.h+=t.length)}function nn(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Qo(n){this.l=n||Zo,n=V.PerformanceNavigationTiming?0<(n=V.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(V.g&&V.g.Ga&&V.g.Ga()&&V.g.Ga().$b),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(N=Bn.prototype).add=function(n,e){bt(this),this.i=null,n=nn(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},N.forEach=function(n,e){bt(this),this.g.forEach(function(t,s){t.forEach(function(r){n.call(e,r,s,this)},this)},this)},N.oa=function(){bt(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let s=0;s<e.length;s++){const r=n[s];for(let i=0;i<r.length;i++)t.push(e[s])}return t},N.W=function(n){bt(this);let e=[];if("string"==typeof n)Ho(this,n)&&(e=e.concat(this.g.get(nn(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},N.set=function(n,e){return bt(this),this.i=null,Ho(this,n=nn(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},N.get=function(n,e){return n&&0<(n=this.W(n)).length?String(n[0]):e},N.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var s=e[t];const i=encodeURIComponent(String(s)),o=this.W(s);for(s=0;s<o.length;s++){var r=i;""!==o[s]&&(r+="="+encodeURIComponent(String(o[s]))),n.push(r)}}return this.i=n.join("&")};var Zo=10;function di(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Wo(n){return n.h?1:n.g?n.g.size:0}function fi(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function pi(n,e){n.g?n.g.add(e):n.h=e}function mi(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function js(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return kr(n.i)}function gi(){}function Rc(){this.g=new gi}function Vc(n,e,t){const s=t||"";try{jo(n,function(r,i){let o=r;Dt(r)&&(o=Mn(r)),e.push(s+i+"="+encodeURIComponent(o))})}catch(r){throw e.push(s+"type="+encodeURIComponent("_badmap")),r}}function qn(n,e,t,s,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(s)}catch{}}function Un(n){this.l=n.ac||null,this.j=n.jb||!1}function $s(n,e){ie.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=yi,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Qo.prototype.cancel=function(){if(this.i=js(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},gi.prototype.stringify=function(n){return V.JSON.stringify(n,void 0)},gi.prototype.parse=function(n){return V.JSON.parse(n,void 0)},Ee(Un,ri),Un.prototype.g=function(){return new $s(this.l,this.j)},Un.prototype.i=function(n){return function(){return n}}({}),Ee($s,ie);var yi=0;function Xo(n){n.j.read().then(n.Ta.bind(n)).catch(n.ga.bind(n))}function jn(n){n.readyState=4,n.l=null,n.j=null,n.A=null,$n(n)}function $n(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(N=$s.prototype).open=function(n,e){if(this.readyState!=yi)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,$n(this)},N.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||V).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))},N.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,jn(this)),this.readyState=yi},N.Wa=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,$n(this)),this.g&&(this.readyState=3,$n(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(typeof V.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Xo(this)}else n.text().then(this.Va.bind(this),this.ga.bind(this))},N.Ta=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?jn(this):$n(this),3==this.readyState&&Xo(this)}},N.Va=function(n){this.g&&(this.response=this.responseText=n,jn(this))},N.Ua=function(n){this.g&&(this.response=n,jn(this))},N.ga=function(){this.g&&jn(this)},N.setRequestHeader=function(n,e){this.v.append(n,e)},N.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},N.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty($s.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var qc=V.JSON.parse;function le(n){ie.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Yo,this.K=this.L=!1}Ee(le,ie);var Yo="",Vt=/^https?$/i,Jo=["POST","PUT"];function wi(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,ea(n),Ks(n)}function ea(n){n.D||(n.D=!0,_e(n,"complete"),_e(n,"error"))}function ta(n){if(n.h&&typeof Ve<"u"&&(!n.C[1]||4!=gt(n)||2!=n.aa()))if(n.v&&4==gt(n))ei(n.Ha,0,n);else if(_e(n,"readystatechange"),4==gt(n)){n.h=!1;try{const a=n.aa();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var s;if(s=0===a){var r=String(n.H).match($o)[1]||null;if(!r&&V.self&&V.self.location){var i=V.self.location.protocol;r=i.substr(0,i.length-1)}s=!Vt.test(r?r.toLowerCase():"")}t=s}if(t)_e(n,"complete"),_e(n,"success");else{n.m=6;try{var o=2<gt(n)?n.g.statusText:""}catch{o=""}n.j=o+" ["+n.aa()+"]",ea(n)}}finally{Ks(n)}}}function Ks(n,e){if(n.g){vi(n);const t=n.g,s=n.C[0]?Sn:null;n.g=null,n.C=null,e||_e(n,"ready");try{t.onreadystatechange=s}catch{}}}function vi(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(V.clearTimeout(n.A),n.A=null)}function gt(n){return n.g?n.g.readyState:0}function na(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case Yo:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function sa(n){let e="";return Br(n,function(t,s){e+=s,e+=":",e+=t,e+="\r\n"}),e}function et(n,e,t){e:{for(s in t){var s=!1;break e}s=!0}s||(t=sa(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):se(n,e,t))}function dt(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function ra(n){this.Ca=0,this.i=[],this.j=new ks,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=dt("failFast",!1,n),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=dt("baseRetryDelayMs",5e3,n),this.bb=dt("retryDelaySeedMs",1e4,n),this.$a=dt("forwardChannelMaxRetries",2,n),this.ta=dt("forwardChannelRequestTimeoutMs",2e4,n),this.ra=n&&n.xmlHttpFactory||void 0,this.Da=n&&n.Zb||!1,this.J=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.I="",this.h=new Qo(n&&n.concurrentRequestLimit),this.Fa=new Rc,this.O=n&&n.fastHandshake||!1,this.N=n&&n.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=n&&n.Xb||!1,n&&n.Aa&&this.j.Aa(),n&&n.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&n&&n.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function bi(n){if(ia(n),3==n.G){var e=n.U++,t=ht(n.F);se(t,"SID",n.I),se(t,"RID",e),se(t,"TYPE","terminate"),xt(n,t),(e=new Rn(n,n.j,e,void 0)).K=2,e.v=Bs(ht(t)),t=!1,V.navigator&&V.navigator.sendBeacon&&(t=V.navigator.sendBeacon(e.v.toString(),"")),!t&&V.Image&&((new Image).src=e.v,t=!0),t||(e.g=uh(e.l,null),e.g.da(e.v)),e.F=Date.now(),en(e)}Bt(n)}function Gs(n){n.g&&(m(n),n.g.cancel(),n.g=null)}function ia(n){Gs(n),n.u&&(V.clearTimeout(n.u),n.u=null),F(n),n.h.cancel(),n.m&&("number"==typeof n.m&&V.clearTimeout(n.m),n.m=null)}function zs(n){di(n.h)||n.m||(n.m=!0,Mo(n.Ja,n),n.C=0)}function oa(n,e){var t;t=e?e.m:n.U++;const s=ht(n.F);se(s,"SID",n.I),se(s,"RID",t),se(s,"AID",n.T),xt(n,s),n.o&&n.s&&et(s,n.o,n.s),t=new Rn(n,n.j,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.i=e.D.concat(n.i)),e=c(n,t,1e3),t.setTimeout(Math.round(.5*n.ta)+Math.round(.5*n.ta*Math.random())),pi(n.h,t),ai(t,s,e)}function xt(n,e){n.ia&&Br(n.ia,function(t,s){se(e,s,t)}),n.l&&jo({},function(t,s){se(e,s,t)})}function c(n,e,t){t=Math.min(n.i.length,t);var s=n.l?Ce(n.l.Ra,n.l,n):null;e:{var r=n.i;let i=-1;for(;;){const o=["count="+t];-1==i?0<t?(i=r[0].h,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let l=0;l<t;l++){let h=r[l].h;const f=r[l].g;if(h-=i,0>h)i=Math.max(0,r[l].h-100),a=!1;else try{Vc(f,o,"req"+h+"_")}catch{s&&s(f)}}if(a){s=o.join("&");break e}}}return n=n.i.splice(0,t),e.D=n,s}function u(n){n.g||n.u||(n.Z=1,Mo(n.Ia,n),n.A=0)}function d(n){return!(n.g||n.u||3<=n.A||(n.Z++,n.u=Ln(Ce(n.Ia,n),Ge(n,n.A)),n.A++,0))}function m(n){null!=n.B&&(V.clearTimeout(n.B),n.B=null)}function T(n){n.g=new Rn(n,n.j,"rpc",n.Z),null===n.o&&(n.g.H=n.s),n.g.N=0;var e=ht(n.sa);se(e,"RID","rpc"),se(e,"SID",n.I),se(e,"CI",n.L?"0":"1"),se(e,"AID",n.T),se(e,"TYPE","xmlhttp"),xt(n,e),n.o&&n.s&&et(e,n.o,n.s),n.J&&n.g.setTimeout(n.J);var t=n.g;n=n.ka,t.K=1,t.v=Bs(ht(e)),t.s=null,t.P=!0,qo(t,n)}function F(n){null!=n.v&&(V.clearTimeout(n.v),n.v=null)}function ee(n,e){var t=null;if(n.g==e){F(n),m(n),n.g=null;var s=2}else{if(!fi(n.h,e))return;t=e.D,mi(n.h,e),s=1}if(0!=n.G)if(n.pa=e.Y,e.i)if(1==s){t=e.s?e.s.length:0,e=Date.now()-e.F;var r=n.C;_e(s=Ms(),new Fo(s,t)),zs(n)}else u(n);else if(3==(r=e.o)||0==r&&0<n.pa||!(1==s&&function jc(n,e){return!(Wo(n.h)>=n.h.j-(n.m?1:0)||(n.m?(n.i=e.D.concat(n.i),0):1==n.G||2==n.G||n.C>=(n.Za?0:n.$a)||(n.m=Ln(Ce(n.Ja,n,e),Ge(n,n.C)),n.C++,0)))}(n,e)||2==s&&d(n)))switch(t&&0<t.length&&(e=n.h,e.i=e.i.concat(t)),r){case 1:pe(n,5);break;case 4:pe(n,10);break;case 3:pe(n,6);break;default:pe(n,2)}}function Ge(n,e){let t=n.Xa+Math.floor(Math.random()*n.bb);return n.l||(t*=2),t*e}function pe(n,e){if(n.j.info("Error code "+e),2==e){var t=null;n.l&&(t=null);var s=Ce(n.kb,n);t||(t=new mt("//www.google.com/images/cleardot.gif"),V.location&&"http"==V.location.protocol||Rs(t,"https"),Bs(t)),function Bc(n,e){const t=new ks;if(V.Image){const s=new Image;s.onload=bs(qn,t,s,"TestLoadImage: loaded",!0,e),s.onerror=bs(qn,t,s,"TestLoadImage: error",!1,e),s.onabort=bs(qn,t,s,"TestLoadImage: abort",!1,e),s.ontimeout=bs(qn,t,s,"TestLoadImage: timeout",!1,e),V.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=n}else e(!1)}(t.toString(),s)}else Be(2);n.G=0,n.l&&n.l.va(e),Bt(n),ia(n)}function Bt(n){if(n.G=0,n.la=[],n.l){const e=js(n.h);(0!=e.length||0!=n.i.length)&&(wo(n.la,e),wo(n.la,n.i),n.h.i.length=0,kr(n.i),n.i.length=0),n.l.ua()}}function Hs(n,e,t){var s=t instanceof mt?ht(t):new mt(t,void 0);if(""!=s.g)e&&(s.g=e+"."+s.g),Vs(s,s.m);else{var r=V.location;s=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var i=new mt(null,void 0);s&&Rs(i,s),e&&(i.g=e),r&&Vs(i,r),t&&(i.l=t),s=i}return e=n.za,(t=n.D)&&e&&se(s,t,e),se(s,"VER",n.ma),xt(n,s),s}function uh(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new le(t&&n.Da&&!n.ra?new Un({jb:!0}):n.ra)).Ka(n.H),e}function lh(){}function aa(){if(Wt&&!(10<=Number(Is)))throw Error("Environmental error: no available transport.")}function it(n,e){ie.call(this),this.g=new ra(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.S=n,(n=e&&e.Yb)&&!xs(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!xs(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Qs(this)}function hh(n){ii.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function dh(){Ps.call(this),this.status=1}function Qs(n){this.g=n}(N=le.prototype).Ka=function(n){this.L=n},N.da=function(n,e,t,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Os.g(),this.C=function Ot(n){return n.h||(n.h=n.i())}(this.u?this.u:Os),this.g.onreadystatechange=Ce(this.Ha,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(i){return void wi(this,i)}if(n=t||"",t=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var r in s)t.set(r,s[r]);else{if("function"!=typeof s.keys||"function"!=typeof s.get)throw Error("Unknown input type for opt_headers: "+String(s));for(const i of s.keys())t.set(i,s.get(i))}s=Array.from(t.keys()).find(i=>"content-type"==i.toLowerCase()),r=V.FormData&&n instanceof V.FormData,!(0<=yo(Jo,e))||s||r||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,o]of t)this.g.setRequestHeader(i,o);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{vi(this),0<this.B&&((this.K=function Uc(n){return Wt&&function Rr(){return function pc(n){var e=gc;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}(function(){let n=0;const e=vo(String(Ts)).split("."),t=vo("9").split("."),s=Math.max(e.length,t.length);for(let o=0;0==n&&o<s;o++){var r=e[o]||"",i=t[o]||"";do{if(r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],0==r[0].length&&0==i[0].length)break;n=Mt(0==r[1].length?0:parseInt(r[1],10),0==i[1].length?0:parseInt(i[1],10))||Mt(0==r[2].length,0==i[2].length)||Mt(r[2],i[2]),r=r[3],i=i[3]}while(0==n)}return 0<=n})}()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ce(this.qa,this)):this.A=ei(this.qa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(i){wi(this,i)}},N.qa=function(){typeof Ve<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,_e(this,"timeout"),this.abort(8))},N.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,_e(this,"complete"),_e(this,"abort"),Ks(this))},N.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ks(this,!0)),le.X.M.call(this)},N.Ha=function(){this.s||(this.F||this.v||this.l?ta(this):this.fb())},N.fb=function(){ta(this)},N.aa=function(){try{return 2<gt(this)?this.g.status:-1}catch{return-1}},N.fa=function(){try{return this.g?this.g.responseText:""}catch{return""}},N.Sa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),qc(e)}},N.Ea=function(){return this.m},N.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(N=ra.prototype).ma=8,N.G=1,N.Ja=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.U=Math.floor(1e5*Math.random()),n=this.U++;const r=new Rn(this,this.j,n,void 0);let i=this.s;if(this.S&&(i?(i=Io(i),Co(i,this.S)):i=this.S),null!==this.o||this.N||(r.H=i,i=null),this.O)e:{for(var e=0,t=0;t<this.i.length;t++){var s=this.i[t];if(void 0===(s="__data__"in s.g&&"string"==typeof(s=s.g.__data__)?s.length:void 0))break;if(4096<(e+=s)){e=t;break e}if(4096===e||t===this.i.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=c(this,r,e),se(t=ht(this.F),"RID",n),se(t,"CVER",22),this.D&&se(t,"X-HTTP-Session-Id",this.D),xt(this,t),i&&(this.N?e="headers="+encodeURIComponent(String(sa(i)))+"&"+e:this.o&&et(t,this.o,i)),pi(this.h,r),this.Ya&&se(t,"TYPE","init"),this.O?(se(t,"$req",e),se(t,"SID","null"),r.Z=!0,ai(r,t,null)):ai(r,t,e),this.G=2}}else 3==this.G&&(n?oa(this,n):0==this.i.length||di(this.h)||oa(this))},N.Ia=function(){if(this.u=null,T(this),this.$&&!(this.K||null==this.g||0>=this.P)){var n=2*this.P;this.j.info("BP detection timer enabled: "+n),this.B=Ln(Ce(this.eb,this),n)}},N.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Be(10),Gs(this),T(this))},N.cb=function(){null!=this.v&&(this.v=null,Gs(this),d(this),Be(19))},N.kb=function(n){n?(this.j.info("Successfully pinged google.com"),Be(2)):(this.j.info("Failed to ping google.com"),Be(1))},(N=lh.prototype).xa=function(){},N.wa=function(){},N.va=function(){},N.ua=function(){},N.Ra=function(){},aa.prototype.g=function(n,e){return new it(n,e)},Ee(it,ie),it.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;Be(0),n.V=e,n.ia=t||{},n.L=n.Y,n.F=Hs(n,null,n.V),zs(n)},it.prototype.close=function(){bi(this.g)},it.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=Mn(n),n=t);e.i.push(new class{constructor(n,e){this.h=n,this.g=e}}(e.ab++,n)),3==e.G&&zs(e)},it.prototype.M=function(){this.g.l=null,delete this.j,bi(this.g),delete this.g,it.X.M.call(this)},Ee(hh,ii),Ee(dh,Ps),Ee(Qs,lh),Qs.prototype.xa=function(){_e(this.g,"a")},Qs.prototype.wa=function(n){_e(this.g,new hh(n))},Qs.prototype.va=function(n){_e(this.g,new dh)},Qs.prototype.ua=function(){_e(this.g,"b")},aa.prototype.createWebChannel=aa.prototype.g,it.prototype.send=it.prototype.u,it.prototype.open=it.prototype.m,it.prototype.close=it.prototype.close,Ns.NO_ERROR=0,Ns.TIMEOUT=8,Ns.HTTP_ERROR=6,Ro.COMPLETE="complete",Vo.EventType=Fn,Fn.OPEN="a",Fn.CLOSE="b",Fn.ERROR="c",Fn.MESSAGE="d",ie.prototype.listen=ie.prototype.N,le.prototype.listenOnce=le.prototype.O,le.prototype.getLastError=le.prototype.Oa,le.prototype.getLastErrorCode=le.prototype.Ea,le.prototype.getStatus=le.prototype.aa,le.prototype.getResponseJson=le.prototype.Sa,le.prototype.getResponseText=le.prototype.fa,le.prototype.send=le.prototype.da,le.prototype.setWithCredentials=le.prototype.Ka;var Hp=ut.createWebChannelTransport=function(){return new aa},Qp=ut.getStatEventTarget=function(){return Ms()},$c=ut.ErrorCode=Ns,Zp=ut.EventType=Ro,Wp=ut.Event=Pt,fh=ut.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},Xp=ut.FetchXmlHttpFactory=Un,ca=ut.WebChannel=Vo,Yp=ut.XhrIo=le;const ph="@firebase/firestore";class Ne{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ne.UNAUTHENTICATED=new Ne(null),Ne.GOOGLE_CREDENTIALS=new Ne("google-credentials-uid"),Ne.FIRST_PARTY=new Ne("first-party-uid"),Ne.MOCK_USER=new Ne("mock-user");let Zs="9.17.2";const sn=new Je.Yd("@firebase/firestore");function Kc(){return sn.logLevel}function E(n,...e){if(sn.logLevel<=Je.in.DEBUG){const t=e.map(Gc);sn.debug(`Firestore (${Zs}): ${n}`,...t)}}function we(n,...e){if(sn.logLevel<=Je.in.ERROR){const t=e.map(Gc);sn.error(`Firestore (${Zs}): ${n}`,...t)}}function Kn(n,...e){if(sn.logLevel<=Je.in.WARN){const t=e.map(Gc);sn.warn(`Firestore (${Zs}): ${n}`,...t)}}function Gc(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function D(n="Unexpected state"){const e=`FIRESTORE (${Zs}) INTERNAL ASSERTION FAILED: `+n;throw we(e),new Error(e)}function O(n,e){n||D()}function k(n,e){return n}const x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class C extends q.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Se{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class mh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class tm{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ne.UNAUTHENTICATED))}shutdown(){}}class nm{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class sm{constructor(e){this.t=e,this.currentUser=Ne.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var s=this;let r=this.i;const i=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve();let o=new Se;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Se,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const h=o;e.enqueueRetryable((0,w.Z)(function*(){yield h.promise,yield i(s.currentUser)}))},l=h=>{E("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(h=>l(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?l(h):(E("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Se)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(s=>this.i!==e?(E("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(O("string"==typeof s.accessToken),new mh(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return O(null===e||"string"==typeof e),new Ne(e)}}class rm{constructor(e,t,s,r){this.h=e,this.l=t,this.m=s,this.g=r,this.type="FirstParty",this.user=Ne.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(O(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class im{constructor(e,t,s,r){this.h=e,this.l=t,this.m=s,this.g=r}getToken(){return Promise.resolve(new rm(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(Ne.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class gh{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class om{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const s=i=>{null!=i.error&&E("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.A;return this.A=i.token,E("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>s(i))};const r=i=>{E("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.T.onInit(i=>r(i)),setTimeout(()=>{if(!this.appCheck){const i=this.T.getImmediate({optional:!0});i?r(i):E("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(O("string"==typeof t.token),this.A=t.token,new gh(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function am(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}class yh{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let s="";for(;s.length<20;){const r=am(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<t&&(s+=e.charAt(r[i]%e.length))}return s}}function U(n,e){return n<e?-1:n>e?1:0}function Ws(n,e,t){return n.length===e.length&&n.every((s,r)=>t(s,e[r]))}function wh(n){return n+"\0"}class he{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new C(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new C(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new C(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new C(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return he.fromMillis(Date.now())}static fromDate(e){return he.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor(1e6*(e-1e3*t));return new he(t,s)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?U(this.nanoseconds,e.nanoseconds):U(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class R{constructor(e){this.timestamp=e}static fromTimestamp(e){return new R(e)}static min(){return new R(new he(0,0))}static max(){return new R(new he(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class xi{constructor(e,t,s){void 0===t?t=0:t>e.length&&D(),void 0===s?s=e.length-t:s>e.length-t&&D(),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return 0===xi.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof xi?e.forEach(s=>{t.push(s)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const i=e.get(r),o=t.get(r);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Z extends xi{construct(e,t,s){return new Z(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new C(x.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter(r=>r.length>0))}return new Z(t)}static emptyPath(){return new Z([])}}const cm=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class me extends xi{construct(e,t,s){return new me(e,t,s)}static isValidIdentifier(e){return cm.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),me.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new me(["__name__"])}static fromServerFormat(e){const t=[];let s="",r=0;const i=()=>{if(0===s.length)throw new C(x.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let o=!1;for(;r<e.length;){const a=e[r];if("\\"===a){if(r+1===e.length)throw new C(x.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if("\\"!==l&&"."!==l&&"`"!==l)throw new C(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=l,r+=2}else"`"===a?(o=!o,r++):"."!==a||o?(s+=a,r++):(i(),r++)}if(i(),o)throw new C(x.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new me(t)}static emptyPath(){return new me([])}}class A{constructor(e){this.path=e}static fromPath(e){return new A(Z.fromString(e))}static fromName(e){return new A(Z.fromString(e).popFirst(5))}static empty(){return new A(Z.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Z.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Z.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new A(new Z(e.slice()))}}class ua{constructor(e,t,s,r){this.indexId=e,this.collectionGroup=t,this.fields=s,this.indexState=r}}function zc(n){return n.fields.find(e=>2===e.kind)}function Gn(n){return n.fields.filter(e=>2!==e.kind)}ua.UNKNOWN_ID=-1;class la{constructor(e,t){this.fieldPath=e,this.kind=t}}class _i{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new _i(0,ot.min())}}function vh(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=R.fromTimestamp(1e9===s?new he(t+1,0):new he(t,s));return new ot(r,A.empty(),e)}function bh(n){return new ot(n.readTime,n.key,-1)}class ot{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new ot(R.min(),A.empty(),-1)}static max(){return new ot(R.max(),A.empty(),-1)}}function Hc(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=A.comparator(n.documentKey,e.documentKey),0!==t?t:U(n.largestBatchId,e.largestBatchId))}const xh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class _h{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function rn(n){return Qc.apply(this,arguments)}function Qc(){return Qc=(0,w.Z)(function*(n){if(n.code!==x.FAILED_PRECONDITION||n.message!==xh)throw n;E("LocalStore","Unexpectedly lost primary lease")}),Qc.apply(this,arguments)}class b{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&D(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new b((s,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(s,r)},this.catchCallback=i=>{this.wrapFailure(t,i).next(s,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof b?t:b.resolve(t)}catch(t){return b.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):b.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):b.reject(t)}static resolve(e){return new b((t,s)=>{t(e)})}static reject(e){return new b((t,s)=>{s(e)})}static waitFor(e){return new b((t,s)=>{let r=0,i=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++i,o&&i===r&&t()},l=>s(l))}),o=!0,i===r&&t()})}static or(e){let t=b.resolve(!1);for(const s of e)t=t.next(r=>r?b.resolve(r):s());return t}static forEach(e,t){const s=[];return e.forEach((r,i)=>{s.push(t.call(this,r,i))}),this.waitFor(s)}static mapArray(e,t){return new b((s,r)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const h=l;t(e[h]).next(f=>{o[h]=f,++a,a===i&&s(o)},f=>r(f))}})}static doWhile(e,t){return new b((s,r)=>{const i=()=>{!0===e()?t().next(()=>{i()},r):s()};i()})}}class ha{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.v=new Se,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{t.error?this.v.reject(new Ti(e,t.error)):this.v.resolve()},this.transaction.onerror=s=>{const r=Zc(s.target.error);this.v.reject(new Ti(e,r))}}static open(e,t,s,r){try{return new ha(t,e.transaction(r,s))}catch(i){throw new Ti(t,i)}}get P(){return this.v.promise}abort(e){e&&this.v.reject(e),this.aborted||(E("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new dm(t)}}class yt{constructor(e,t,s){this.name=e,this.version=t,this.S=s,12.2===yt.D((0,q.z$)())&&we("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return E("SimpleDb","Removing database:",e),zn(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!(0,q.hl)())return!1;if(yt.N())return!0;const e=(0,q.z$)(),t=yt.D(e),s=0<t&&t<10,r=yt.k(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||s||i)}static N(){var e;return typeof process<"u"&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),s=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(s)}static k(e){const t=e.match(/Android ([\d.]+)/i),s=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(s)}F(e){var t=this;return(0,w.Z)(function*(){return t.db||(E("SimpleDb","Opening database:",t.name),t.db=yield new Promise((s,r)=>{const i=indexedDB.open(t.name,t.version);i.onsuccess=o=>{s(o.target.result)},i.onblocked=()=>{r(new Ti(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=o=>{const a=o.target.error;r("VersionError"===a.name?new C(x.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new C(x.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new Ti(e,a))},i.onupgradeneeded=o=>{E("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.S.$(o.target.result,i.transaction,o.oldVersion,t.version).next(()=>{E("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.B&&(t.db.onversionchange=s=>t.B(s)),t.db})()}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,s,r){var i=this;return(0,w.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{i.db=yield i.F(e);const l=ha.open(i.db,e,o?"readonly":"readwrite",s),h=r(l).next(f=>(l.V(),f)).catch(f=>(l.abort(f),b.reject(f))).toPromise();return h.catch(()=>{}),yield l.P,h}catch(l){const h=l,f="FirebaseError"!==h.name&&a<3;if(E("SimpleDb","Transaction failed with error:",h.message,"Retrying:",f),i.close(),!f)return Promise.reject(h)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class hm{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return zn(this.q.delete())}}class Ti extends C{constructor(e,t){super(x.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function on(n){return"IndexedDbTransactionError"===n.name}class dm{constructor(e){this.store=e}put(e,t){let s;return void 0!==t?(E("SimpleDb","PUT",this.store.name,e,t),s=this.store.put(t,e)):(E("SimpleDb","PUT",this.store.name,"<auto-key>",e),s=this.store.put(e)),zn(s)}add(e){return E("SimpleDb","ADD",this.store.name,e,e),zn(this.store.add(e))}get(e){return zn(this.store.get(e)).next(t=>(void 0===t&&(t=null),E("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return E("SimpleDb","DELETE",this.store.name,e),zn(this.store.delete(e))}count(){return E("SimpleDb","COUNT",this.store.name),zn(this.store.count())}W(e,t){const s=this.options(e,t);if(s.index||"function"!=typeof this.store.getAll){const r=this.cursor(s),i=[];return this.H(r,(o,a)=>{i.push(a)}).next(()=>i)}{const r=this.store.getAll(s.range);return new b((i,o)=>{r.onerror=a=>{o(a.target.error)},r.onsuccess=a=>{i(a.target.result)}})}}J(e,t){const s=this.store.getAll(e,null===t?void 0:t);return new b((r,i)=>{s.onerror=o=>{i(o.target.error)},s.onsuccess=o=>{r(o.target.result)}})}Y(e,t){E("SimpleDb","DELETE ALL",this.store.name);const s=this.options(e,t);s.Z=!1;const r=this.cursor(s);return this.H(r,(i,o,a)=>a.delete())}X(e,t){let s;t?s=e:(s={},t=e);const r=this.cursor(s);return this.H(r,t)}tt(e){const t=this.cursor({});return new b((s,r)=>{t.onerror=i=>{const o=Zc(i.target.error);r(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():s()}):s()}})}H(e,t){const s=[];return new b((r,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void r();const l=new hm(a),h=t(a.primaryKey,a.value,l);if(h instanceof b){const f=h.catch(p=>(l.done(),b.reject(p)));s.push(f)}l.isDone?r():null===l.G?a.continue():a.continue(l.G)}}).next(()=>b.waitFor(s))}options(e,t){let s;return void 0!==e&&("string"==typeof e?s=e:t=e),{index:s,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const s=this.store.index(e.index);return e.Z?s.openKeyCursor(e.range,t):s.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function zn(n){return new b((e,t)=>{n.onsuccess=s=>{e(s.target.result)},n.onerror=s=>{const r=Zc(s.target.error);t(r)}})}let Th=!1;function Zc(n){const e=yt.D((0,q.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const s=new C("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Th||(Th=!0,setTimeout(()=>{throw s},0)),s}}return n}class fm{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){var t=this;E("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,w.Z)(function*(){t.task=null;try{E("IndexBackiller",`Documents written: ${yield t.et.st()}`)}catch(s){on(s)?E("IndexBackiller","Ignoring IndexedDB error during index backfill: ",s):yield rn(s)}yield t.nt(6e4)}))}}class pm{constructor(e,t){this.localStore=e,this.persistence=t}st(e=50){var t=this;return(0,w.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",s=>t.it(s,e))})()}it(e,t){const s=new Set;let r=t,i=!0;return b.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(null!==o&&!s.has(o))return E("IndexBackiller",`Processing collection: ${o}`),this.rt(e,o,r).next(a=>{r-=a,s.add(o)});i=!1})).next(()=>t-r)}rt(e,t,s){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,s).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ot(r,i)).next(a=>(E("IndexBackiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}ot(e,t){let s=e;return t.changes.forEach((r,i)=>{const o=bh(i);Hc(o,s)>0&&(s=o)}),new ot(s.readTime,s.documentKey,Math.max(t.batchId,e.largestBatchId))}}let at=(()=>{class n{constructor(t,s){this.previousValue=t,s&&(s.sequenceNumberHandler=r=>this.ut(r),this.ct=r=>s.writeSequenceNumber(r))}ut(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ct&&this.ct(t),t}}return n.at=-1,n})();class ym{constructor(e,t,s,r,i,o,a,l){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=l}}class an{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new an("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof an&&e.projectId===this.projectId&&e.database===this.database}}function Ih(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Hn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Ch(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ii(n){return null==n}function Ci(n){return 0===n&&1/n==-1/0}function Eh(n){return"number"==typeof n&&Number.isInteger(n)&&!Ci(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}class wm extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ae{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(r){throw r instanceof DOMException?new wm("Invalid base64 string: "+r):r}}(e);return new Ae(t)}static fromUint8Array(e){const t=function(s){let r="";for(let i=0;i<s.length;++i)r+=String.fromCharCode(s[i]);return r}(e);return new Ae(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return U(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ae.EMPTY_BYTE_STRING=new Ae("");const bm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function cn(n){if(O(!!n),"string"==typeof n){let e=0;const t=bm.exec(n);if(O(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:ge(n.seconds),nanos:ge(n.nanos)}}function ge(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Qn(n){return"string"==typeof n?Ae.fromBase64String(n):Ae.fromUint8Array(n)}function Xc(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Sh(n){const e=n.mapValue.fields.__previous_value__;return Xc(e)?Sh(e):e}function Ei(n){const e=cn(n.mapValue.fields.__local_write_time__.timestampValue);return new he(e.seconds,e.nanos)}const un={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},da={nullValue:"NULL_VALUE"};function Zn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Xc(n)?4:Mh(n)?9007199254740991:10:D()}function _t(n,e){if(n===e)return!0;const t=Zn(n);if(t!==Zn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ei(n).isEqual(Ei(e));case 3:return function(s,r){if("string"==typeof s.timestampValue&&"string"==typeof r.timestampValue&&s.timestampValue.length===r.timestampValue.length)return s.timestampValue===r.timestampValue;const i=cn(s.timestampValue),o=cn(r.timestampValue);return i.seconds===o.seconds&&i.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return r=e,Qn(n.bytesValue).isEqual(Qn(r.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,r){return ge(s.geoPointValue.latitude)===ge(r.geoPointValue.latitude)&&ge(s.geoPointValue.longitude)===ge(r.geoPointValue.longitude)}(n,e);case 2:return function(s,r){if("integerValue"in s&&"integerValue"in r)return ge(s.integerValue)===ge(r.integerValue);if("doubleValue"in s&&"doubleValue"in r){const i=ge(s.doubleValue),o=ge(r.doubleValue);return i===o?Ci(i)===Ci(o):isNaN(i)&&isNaN(o)}return!1}(n,e);case 9:return Ws(n.arrayValue.values||[],e.arrayValue.values||[],_t);case 10:return function(s,r){const i=s.mapValue.fields||{},o=r.mapValue.fields||{};if(Ih(i)!==Ih(o))return!1;for(const a in i)if(i.hasOwnProperty(a)&&(void 0===o[a]||!_t(i[a],o[a])))return!1;return!0}(n,e);default:return D()}var r}function Si(n,e){return void 0!==(n.values||[]).find(t=>_t(t,e))}function ln(n,e){if(n===e)return 0;const t=Zn(n),s=Zn(e);if(t!==s)return U(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return U(n.booleanValue,e.booleanValue);case 2:return function(r,i){const o=ge(r.integerValue||r.doubleValue),a=ge(i.integerValue||i.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(n,e);case 3:return Ah(n.timestampValue,e.timestampValue);case 4:return Ah(Ei(n),Ei(e));case 5:return U(n.stringValue,e.stringValue);case 6:return function(r,i){const o=Qn(r),a=Qn(i);return o.compareTo(a)}(n.bytesValue,e.bytesValue);case 7:return function(r,i){const o=r.split("/"),a=i.split("/");for(let l=0;l<o.length&&l<a.length;l++){const h=U(o[l],a[l]);if(0!==h)return h}return U(o.length,a.length)}(n.referenceValue,e.referenceValue);case 8:return function(r,i){const o=U(ge(r.latitude),ge(i.latitude));return 0!==o?o:U(ge(r.longitude),ge(i.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(r,i){const o=r.values||[],a=i.values||[];for(let l=0;l<o.length&&l<a.length;++l){const h=ln(o[l],a[l]);if(h)return h}return U(o.length,a.length)}(n.arrayValue,e.arrayValue);case 10:return function(r,i){if(r===un.mapValue&&i===un.mapValue)return 0;if(r===un.mapValue)return 1;if(i===un.mapValue)return-1;const o=r.fields||{},a=Object.keys(o),l=i.fields||{},h=Object.keys(l);a.sort(),h.sort();for(let f=0;f<a.length&&f<h.length;++f){const p=U(a[f],h[f]);if(0!==p)return p;const y=ln(o[a[f]],l[h[f]]);if(0!==y)return y}return U(a.length,h.length)}(n.mapValue,e.mapValue);default:throw D()}}function Ah(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return U(n,e);const t=cn(n),s=cn(e),r=U(t.seconds,s.seconds);return 0!==r?r:U(t.nanos,s.nanos)}function Xs(n){return Yc(n)}function Yc(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(s){const r=cn(s);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Qn(n.bytesValue).toBase64():"referenceValue"in n?A.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(s){let r="[",i=!0;for(const o of s.values||[])i?i=!1:r+=",",r+=Yc(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(s){const r=Object.keys(s.fields||{}).sort();let i="{",o=!0;for(const a of r)o?o=!1:i+=",",i+=`${a}:${Yc(s.fields[a])}`;return i+"}"}(n.mapValue):D();var e}function Wn(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Jc(n){return!!n&&"integerValue"in n}function Ai(n){return!!n&&"arrayValue"in n}function kh(n){return!!n&&"nullValue"in n}function Dh(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function fa(n){return!!n&&"mapValue"in n}function ki(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Hn(n.mapValue.fields,(t,s)=>e.mapValue.fields[t]=ki(s)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ki(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Mh(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function xm(n){return"nullValue"in n?da:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Wn(an.empty(),A.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:D()}function _m(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Wn(an.empty(),A.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?un:D()}function Nh(n,e){const t=ln(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Ph(n,e){const t=ln(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class hn{constructor(e,t){this.position=e,this.inclusive=t}}function Oh(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const i=e[r],o=n.position[r];if(s=i.field.isKeyField()?A.comparator(A.fromName(o.referenceValue),t.key):ln(o,t.data.field(i.field)),"desc"===i.dir&&(s*=-1),0!==s)break}return s}function Lh(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!_t(n.position[t],e.position[t]))return!1;return!0}class Fh{}class H extends Fh{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,s):new Tm(e,t,s):"array-contains"===t?new Em(e,s):"in"===t?new jh(e,s):"not-in"===t?new Sm(e,s):"array-contains-any"===t?new Am(e,s):new H(e,t,s)}static createKeyFieldInFilter(e,t,s){return"in"===t?new Im(e,s):new Cm(e,s)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(ln(t,this.value)):null!==t&&Zn(this.value)===Zn(t)&&this.matchesComparison(ln(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return D()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class te extends Fh{constructor(e,t){super(),this.filters=e,this.op=t,this.ft=null}static create(e,t){return new te(e,t)}matches(e){return Ys(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ft||(this.ft=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ft}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.dt(t=>t.isInequality());return null!==e?e.field:null}dt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Ys(n){return"and"===n.op}function eu(n){return"or"===n.op}function tu(n){return Rh(n)&&Ys(n)}function Rh(n){for(const e of n.filters)if(e instanceof te)return!1;return!0}function nu(n){if(n instanceof H)return n.field.canonicalString()+n.op.toString()+Xs(n.value);if(tu(n))return n.filters.map(e=>nu(e)).join(",");{const e=n.filters.map(t=>nu(t)).join(",");return`${n.op}(${e})`}}function Vh(n,e){return n instanceof H?(t=n,(s=e)instanceof H&&t.op===s.op&&t.field.isEqual(s.field)&&_t(t.value,s.value)):n instanceof te?function(t,s){return s instanceof te&&t.op===s.op&&t.filters.length===s.filters.length&&t.filters.reduce((r,i,o)=>r&&Vh(i,s.filters[o]),!0)}(n,e):void D();var t,s}function Bh(n,e){const t=n.filters.concat(e);return te.create(t,n.op)}function qh(n){return n instanceof H?`${(e=n).field.canonicalString()} ${e.op} ${Xs(e.value)}`:n instanceof te?function(e){return e.op.toString()+" {"+e.getFilters().map(qh).join(" ,")+"}"}(n):"Filter";var e}class Tm extends H{constructor(e,t,s){super(e,t,s),this.key=A.fromName(s.referenceValue)}matches(e){const t=A.comparator(e.key,this.key);return this.matchesComparison(t)}}class Im extends H{constructor(e,t){super(e,"in",t),this.keys=Uh(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Cm extends H{constructor(e,t){super(e,"not-in",t),this.keys=Uh(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Uh(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(s=>A.fromName(s.referenceValue))}class Em extends H{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ai(t)&&Si(t.arrayValue,this.value)}}class jh extends H{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Si(this.value.arrayValue,t)}}class Sm extends H{constructor(e,t){super(e,"not-in",t)}matches(e){if(Si(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Si(this.value.arrayValue,t)}}class Am extends H{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ai(t)||!t.arrayValue.values)&&t.arrayValue.values.some(s=>Si(this.value.arrayValue,s))}}class Js{constructor(e,t="asc"){this.field=e,this.dir=t}}function km(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class ye{constructor(e,t){this.comparator=e,this.root=t||qe.EMPTY}insert(e,t){return new ye(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,qe.BLACK,null,null))}remove(e){return new ye(this.comparator,this.root.remove(e,this.comparator).copy(null,null,qe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(0===s)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(0===r)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,s)=>(e(t,s),!1))}toString(){const e=[];return this.inorderTraversal((t,s)=>(e.push(`${t}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new pa(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new pa(this.root,e,this.comparator,!1)}getReverseIterator(){return new pa(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new pa(this.root,e,this.comparator,!0)}}class pa{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?s(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class qe{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??qe.RED,this.left=r??qe.EMPTY,this.right=i??qe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,i){return new qe(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,s),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return qe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return qe.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,qe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,qe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw D();const e=this.left.check();if(e!==this.right.check())throw D();return e+(this.isRed()?0:1)}}qe.EMPTY=null,qe.RED=!0,qe.BLACK=!1,qe.EMPTY=new class{constructor(){this.size=0}get key(){throw D()}get value(){throw D()}get color(){throw D()}get left(){throw D()}get right(){throw D()}copy(n,e,t,s,r){return this}insert(n,e,t){return new qe(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ne{constructor(e){this.comparator=e,this.data=new ye(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,s)=>(e(t),!1))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new $h(this.data.getIterator())}getIteratorFrom(e){return new $h(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(s=>{t=t.add(s)}),t}isEqual(e){if(!(e instanceof ne)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(0!==this.comparator(r,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ne(this.comparator);return t.data=e,t}}class $h{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function er(n){return n.hasNext()?n.getNext():void 0}class tt{constructor(e){this.fields=e,e.sort(me.comparator)}static empty(){return new tt([])}unionWith(e){let t=new ne(me.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new tt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ws(this.fields,e.fields,(t,s)=>t.isEqual(s))}}class Pe{constructor(e){this.value=e}static empty(){return new Pe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!fa(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ki(t)}setAll(e){let t=me.emptyPath(),s={},r=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,s,r),s={},r=[],t=a.popLast()}o?s[a.lastSegment()]=ki(o):r.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,s,r)}delete(e){const t=this.field(e.popLast());fa(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return _t(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];fa(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){Hn(t,(r,i)=>e[r]=i);for(const r of s)delete e[r]}clone(){return new Pe(ki(this.value))}}function Kh(n){const e=[];return Hn(n.fields,(t,s)=>{const r=new me([t]);if(fa(s)){const i=Kh(s.mapValue).fields;if(0===i.length)e.push(r);else for(const o of i)e.push(r.child(o))}else e.push(r)}),new tt(e)}class oe{constructor(e,t,s,r,i,o,a){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new oe(e,0,R.min(),R.min(),R.min(),Pe.empty(),0)}static newFoundDocument(e,t,s,r){return new oe(e,1,t,R.min(),s,r,0)}static newNoDocument(e,t){return new oe(e,2,t,R.min(),R.min(),Pe.empty(),0)}static newUnknownDocument(e,t){return new oe(e,3,t,R.min(),R.min(),Pe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(R.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=R.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof oe&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new oe(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Dm{constructor(e,t=null,s=[],r=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this._t=null}}function su(n,e=null,t=[],s=[],r=null,i=null,o=null){return new Dm(n,e,t,s,r,i,o)}function Xn(n){const e=k(n);if(null===e._t){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(s=>nu(s)).join(","),t+="|ob:",t+=e.orderBy.map(s=>{return(r=s).field.canonicalString()+r.dir;var r}).join(","),Ii(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(s=>Xs(s)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(s=>Xs(s)).join(",")),e._t=t}return e._t}function Di(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!km(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Vh(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Lh(n.startAt,e.startAt)&&Lh(n.endAt,e.endAt)}function ma(n){return A.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function ga(n,e){return n.filters.filter(t=>t instanceof H&&t.field.isEqual(e))}function Gh(n,e,t){let s=da,r=!0;for(const i of ga(n,e)){let o=da,a=!0;switch(i.op){case"<":case"<=":o=xm(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=da}Nh({value:s,inclusive:r},{value:o,inclusive:a})<0&&(s=o,r=a)}if(null!==t)for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Nh({value:s,inclusive:r},{value:o,inclusive:t.inclusive})<0&&(s=o,r=t.inclusive);break}return{value:s,inclusive:r}}function zh(n,e,t){let s=un,r=!0;for(const i of ga(n,e)){let o=un,a=!0;switch(i.op){case">=":case">":o=_m(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=un}Ph({value:s,inclusive:r},{value:o,inclusive:a})>0&&(s=o,r=a)}if(null!==t)for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Ph({value:s,inclusive:r},{value:o,inclusive:t.inclusive})>0&&(s=o,r=t.inclusive);break}return{value:s,inclusive:r}}class qt{constructor(e,t=null,s=[],r=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.wt=null,this.gt=null}}function Hh(n,e,t,s,r,i,o,a){return new qt(n,e,t,s,r,i,o,a)}function tr(n){return new qt(n)}function Qh(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function ru(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function ya(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function iu(n){return null!==n.collectionGroup}function Yn(n){const e=k(n);if(null===e.wt){e.wt=[];const t=ya(e),s=ru(e);if(null!==t&&null===s)t.isKeyField()||e.wt.push(new Js(t)),e.wt.push(new Js(me.keyField(),"asc"));else{let r=!1;for(const i of e.explicitOrderBy)e.wt.push(i),i.field.isKeyField()&&(r=!0);if(!r){const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new Js(me.keyField(),i))}}}return e.wt}function Ze(n){const e=k(n);if(!e.gt)if("F"===e.limitType)e.gt=su(e.path,e.collectionGroup,Yn(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const i of Yn(e))t.push(new Js(i.field,"desc"===i.dir?"asc":"desc"));const s=e.endAt?new hn(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new hn(e.startAt.position,e.startAt.inclusive):null;e.gt=su(e.path,e.collectionGroup,t,e.filters,e.limit,s,r)}return e.gt}function ou(n,e){e.getFirstInequalityField(),ya(n);const t=n.filters.concat([e]);return new qt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function wa(n,e,t){return new qt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Mi(n,e){return Di(Ze(n),Ze(e))&&n.limitType===e.limitType}function Zh(n){return`${Xn(Ze(n))}|lt:${n.limitType}`}function au(n){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(s=>qh(s)).join(", ")}]`),Ii(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(s=>{return`${(r=s).field.canonicalString()} (${r.dir})`;var r}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(s=>Xs(s)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(s=>Xs(s)).join(",")),`Target(${t})`}(Ze(n))}; limitType=${n.limitType})`}function Ni(n,e){return e.isFoundDocument()&&function(t,s){const r=s.key.path;return null!==t.collectionGroup?s.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(r):A.isDocumentKey(t.path)?t.path.isEqual(r):t.path.isImmediateParentOf(r)}(n,e)&&function(t,s){for(const r of Yn(t))if(!r.field.isKeyField()&&null===s.data.field(r.field))return!1;return!0}(n,e)&&function(t,s){for(const r of t.filters)if(!r.matches(s))return!1;return!0}(n,e)&&(s=e,!((t=n).startAt&&!function(r,i,o){const a=Oh(r,i,o);return r.inclusive?a<=0:a<0}(t.startAt,Yn(t),s)||t.endAt&&!function(r,i,o){const a=Oh(r,i,o);return r.inclusive?a>=0:a>0}(t.endAt,Yn(t),s)));var t,s}function Wh(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Xh(n){return(e,t)=>{let s=!1;for(const r of Yn(n)){const i=Mm(r,e,t);if(0!==i)return i;s=s||r.field.isKeyField()}return 0}}function Mm(n,e,t){const s=n.field.isKeyField()?A.comparator(e.key,t.key):function(r,i,o){const a=i.data.field(r),l=o.data.field(r);return null!==a&&null!==l?ln(a,l):D()}(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return D()}}function Yh(n,e){if(n.yt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ci(e)?"-0":e}}function Jh(n){return{integerValue:""+n}}function ed(n,e){return Eh(e)?Jh(e):Yh(n,e)}class va{constructor(){this._=void 0}}function Nm(n,e,t){return n instanceof nr?function(s,r){const i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return r&&(i.fields.__previous_value__=r),{mapValue:i}}(t,e):n instanceof Jn?nd(n,e):n instanceof es?sd(n,e):function(s,r){const i=td(s,r),o=rd(i)+rd(s.It);return Jc(i)&&Jc(s.It)?Jh(o):Yh(s.Tt,o)}(n,e)}function Pm(n,e,t){return n instanceof Jn?nd(n,e):n instanceof es?sd(n,e):t}function td(n,e){return n instanceof sr?Jc(t=e)||(s=t)&&"doubleValue"in s?e:{integerValue:0}:null;var s,t}class nr extends va{}class Jn extends va{constructor(e){super(),this.elements=e}}function nd(n,e){const t=id(e);for(const s of n.elements)t.some(r=>_t(r,s))||t.push(s);return{arrayValue:{values:t}}}class es extends va{constructor(e){super(),this.elements=e}}function sd(n,e){let t=id(e);for(const s of n.elements)t=t.filter(r=>!_t(r,s));return{arrayValue:{values:t}}}class sr extends va{constructor(e,t){super(),this.Tt=e,this.It=t}}function rd(n){return ge(n.integerValue||n.doubleValue)}function id(n){return Ai(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Pi{constructor(e,t){this.field=e,this.transform=t}}class Lm{constructor(e,t){this.version=e,this.transformResults=t}}class de{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new de}static exists(e){return new de(void 0,e)}static updateTime(e){return new de(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ba(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class xa{}function od(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new ir(n.key,de.none()):new rr(n.key,n.data,de.none());{const t=n.data,s=Pe.empty();let r=new ne(me.comparator);for(let i of e.fields)if(!r.has(i)){let o=t.field(i);null===o&&i.length>1&&(i=i.popLast(),o=t.field(i)),null===o?s.delete(i):s.set(i,o),r=r.add(i)}return new Ut(n.key,s,new tt(r.toArray()),de.none())}}function Fm(n,e,t){n instanceof rr?function(s,r,i){const o=s.value.clone(),a=ud(s.fieldTransforms,r,i.transformResults);o.setAll(a),r.convertToFoundDocument(i.version,o).setHasCommittedMutations()}(n,e,t):n instanceof Ut?function(s,r,i){if(!ba(s.precondition,r))return void r.convertToUnknownDocument(i.version);const o=ud(s.fieldTransforms,r,i.transformResults),a=r.data;a.setAll(cd(s)),a.setAll(o),r.convertToFoundDocument(i.version,a).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Oi(n,e,t,s){return n instanceof rr?function(r,i,o,a){if(!ba(r.precondition,i))return o;const l=r.value.clone(),h=ld(r.fieldTransforms,a,i);return l.setAll(h),i.convertToFoundDocument(i.version,l).setHasLocalMutations(),null}(n,e,t,s):n instanceof Ut?function(r,i,o,a){if(!ba(r.precondition,i))return o;const l=ld(r.fieldTransforms,a,i),h=i.data;return h.setAll(cd(r)),h.setAll(l),i.convertToFoundDocument(i.version,h).setHasLocalMutations(),null===o?null:o.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map(f=>f.field))}(n,e,t,s):(o=t,ba(n.precondition,i=e)?(i.convertToNoDocument(i.version).setHasLocalMutations(),null):o);var i,o}function Rm(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),i=td(s.transform,r||null);null!=i&&(null===t&&(t=Pe.empty()),t.set(s.field,i))}return t||null}function ad(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(s=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===s||t&&s&&Ws(t,s,(r,i)=>function Om(n,e){return n.field.isEqual(e.field)&&(s=e.transform,(t=n.transform)instanceof Jn&&s instanceof Jn||t instanceof es&&s instanceof es?Ws(t.elements,s.elements,_t):t instanceof sr&&s instanceof sr?_t(t.It,s.It):t instanceof nr&&s instanceof nr);var t,s}(r,i))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,s}class rr extends xa{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Ut extends xa{constructor(e,t,s,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function cd(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}}),e}function ud(n,e,t){const s=new Map;O(n.length===t.length);for(let r=0;r<t.length;r++){const i=n[r],o=i.transform,a=e.data.field(i.field);s.set(i.field,Pm(o,a,t[r]))}return s}function ld(n,e,t){const s=new Map;for(const r of n){const i=r.transform,o=t.data.field(r.field);s.set(r.field,Nm(i,o,e))}return s}class ir extends xa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class cu extends xa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Vm{constructor(e){this.count=e}}var Te,W;function hd(n){switch(n){default:return D();case x.CANCELLED:case x.UNKNOWN:case x.DEADLINE_EXCEEDED:case x.RESOURCE_EXHAUSTED:case x.INTERNAL:case x.UNAVAILABLE:case x.UNAUTHENTICATED:return!1;case x.INVALID_ARGUMENT:case x.NOT_FOUND:case x.ALREADY_EXISTS:case x.PERMISSION_DENIED:case x.FAILED_PRECONDITION:case x.ABORTED:case x.OUT_OF_RANGE:case x.UNIMPLEMENTED:case x.DATA_LOSS:return!0}}function dd(n){if(void 0===n)return we("GRPC error has no .code"),x.UNKNOWN;switch(n){case Te.OK:return x.OK;case Te.CANCELLED:return x.CANCELLED;case Te.UNKNOWN:return x.UNKNOWN;case Te.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case Te.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case Te.INTERNAL:return x.INTERNAL;case Te.UNAVAILABLE:return x.UNAVAILABLE;case Te.UNAUTHENTICATED:return x.UNAUTHENTICATED;case Te.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case Te.NOT_FOUND:return x.NOT_FOUND;case Te.ALREADY_EXISTS:return x.ALREADY_EXISTS;case Te.PERMISSION_DENIED:return x.PERMISSION_DENIED;case Te.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case Te.ABORTED:return x.ABORTED;case Te.OUT_OF_RANGE:return x.OUT_OF_RANGE;case Te.UNIMPLEMENTED:return x.UNIMPLEMENTED;case Te.DATA_LOSS:return x.DATA_LOSS;default:return D()}}(W=Te||(Te={}))[W.OK=0]="OK",W[W.CANCELLED=1]="CANCELLED",W[W.UNKNOWN=2]="UNKNOWN",W[W.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",W[W.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",W[W.NOT_FOUND=5]="NOT_FOUND",W[W.ALREADY_EXISTS=6]="ALREADY_EXISTS",W[W.PERMISSION_DENIED=7]="PERMISSION_DENIED",W[W.UNAUTHENTICATED=16]="UNAUTHENTICATED",W[W.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",W[W.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",W[W.ABORTED=10]="ABORTED",W[W.OUT_OF_RANGE=11]="OUT_OF_RANGE",W[W.UNIMPLEMENTED=12]="UNIMPLEMENTED",W[W.INTERNAL=13]="INTERNAL",W[W.UNAVAILABLE=14]="UNAVAILABLE",W[W.DATA_LOSS=15]="DATA_LOSS";class dn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(void 0!==s)for(const[r,i]of s)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(void 0===r)return this.inner[s]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(void 0===s)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return 1===s.length?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Hn(this.inner,(t,s)=>{for(const[r,i]of s)e(r,i)})}isEmpty(){return Ch(this.inner)}size(){return this.innerSize}}const Bm=new ye(A.comparator);function nt(){return Bm}const fd=new ye(A.comparator);function Li(...n){let e=fd;for(const t of n)e=e.insert(t.key,t);return e}function pd(n){let e=fd;return n.forEach((t,s)=>e=e.insert(t,s.overlayedDocument)),e}function Tt(){return Fi()}function md(){return Fi()}function Fi(){return new dn(n=>n.toString(),(n,e)=>n.isEqual(e))}const qm=new ye(A.comparator),Um=new ne(A.comparator);function $(...n){let e=Um;for(const t of n)e=e.add(t);return e}const jm=new ne(U);function _a(){return jm}class Ri{constructor(e,t,s,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,Vi.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new Ri(R.min(),r,_a(),nt(),$())}}class Vi{constructor(e,t,s,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new Vi(s,t,$(),$(),$())}}class Ta{constructor(e,t,s,r){this.Et=e,this.removedTargetIds=t,this.key=s,this.At=r}}class gd{constructor(e,t){this.targetId=e,this.Rt=t}}class yd{constructor(e,t,s=Ae.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class wd{constructor(){this.bt=0,this.vt=bd(),this.Pt=Ae.EMPTY_BYTE_STRING,this.Vt=!1,this.St=!0}get current(){return this.Vt}get resumeToken(){return this.Pt}get Dt(){return 0!==this.bt}get Ct(){return this.St}xt(e){e.approximateByteSize()>0&&(this.St=!0,this.Pt=e)}Nt(){let e=$(),t=$(),s=$();return this.vt.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:D()}}),new Vi(this.Pt,this.Vt,e,t,s)}kt(){this.St=!1,this.vt=bd()}Ot(e,t){this.St=!0,this.vt=this.vt.insert(e,t)}Mt(e){this.St=!0,this.vt=this.vt.remove(e)}Ft(){this.bt+=1}$t(){this.bt-=1}Bt(){this.St=!0,this.Vt=!0}}class $m{constructor(e){this.Lt=e,this.qt=new Map,this.Ut=nt(),this.Kt=vd(),this.Gt=new ne(U)}Qt(e){for(const t of e.Et)e.At&&e.At.isFoundDocument()?this.jt(t,e.At):this.zt(t,e.key,e.At);for(const t of e.removedTargetIds)this.zt(t,e.key,e.At)}Wt(e){this.forEachTarget(e,t=>{const s=this.Ht(t);switch(e.state){case 0:this.Jt(t)&&s.xt(e.resumeToken);break;case 1:s.$t(),s.Dt||s.kt(),s.xt(e.resumeToken);break;case 2:s.$t(),s.Dt||this.removeTarget(t);break;case 3:this.Jt(t)&&(s.Bt(),s.xt(e.resumeToken));break;case 4:this.Jt(t)&&(this.Yt(t),s.xt(e.resumeToken));break;default:D()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.qt.forEach((s,r)=>{this.Jt(r)&&t(r)})}Zt(e){const t=e.targetId,s=e.Rt.count,r=this.Xt(t);if(r){const i=r.target;if(ma(i))if(0===s){const o=new A(i.path);this.zt(t,o,oe.newNoDocument(o,R.min()))}else O(1===s);else this.te(t)!==s&&(this.Yt(t),this.Gt=this.Gt.add(t))}}ee(e){const t=new Map;this.qt.forEach((i,o)=>{const a=this.Xt(o);if(a){if(i.current&&ma(a.target)){const l=new A(a.target.path);null!==this.Ut.get(l)||this.ne(o,l)||this.zt(o,l,oe.newNoDocument(l,e))}i.Ct&&(t.set(o,i.Nt()),i.kt())}});let s=$();this.Kt.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const h=this.Xt(l);return!h||2===h.purpose||(a=!1,!1)}),a&&(s=s.add(i))}),this.Ut.forEach((i,o)=>o.setReadTime(e));const r=new Ri(e,t,this.Gt,this.Ut,s);return this.Ut=nt(),this.Kt=vd(),this.Gt=new ne(U),r}jt(e,t){if(!this.Jt(e))return;const s=this.ne(e,t.key)?2:0;this.Ht(e).Ot(t.key,s),this.Ut=this.Ut.insert(t.key,t),this.Kt=this.Kt.insert(t.key,this.se(t.key).add(e))}zt(e,t,s){if(!this.Jt(e))return;const r=this.Ht(e);this.ne(e,t)?r.Ot(t,1):r.Mt(t),this.Kt=this.Kt.insert(t,this.se(t).delete(e)),s&&(this.Ut=this.Ut.insert(t,s))}removeTarget(e){this.qt.delete(e)}te(e){const t=this.Ht(e).Nt();return this.Lt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ft(e){this.Ht(e).Ft()}Ht(e){let t=this.qt.get(e);return t||(t=new wd,this.qt.set(e,t)),t}se(e){let t=this.Kt.get(e);return t||(t=new ne(U),this.Kt=this.Kt.insert(e,t)),t}Jt(e){const t=null!==this.Xt(e);return t||E("WatchChangeAggregator","Detected inactive target",e),t}Xt(e){const t=this.qt.get(e);return t&&t.Dt?null:this.Lt.ie(e)}Yt(e){this.qt.set(e,new wd),this.Lt.getRemoteKeysForTarget(e).forEach(t=>{this.zt(e,t,null)})}ne(e,t){return this.Lt.getRemoteKeysForTarget(e).has(t)}}function vd(){return new ye(A.comparator)}function bd(){return new ye(A.comparator)}const Km={asc:"ASCENDING",desc:"DESCENDING"},Gm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},zm={and:"AND",or:"OR"};class Hm{constructor(e,t){this.databaseId=e,this.yt=t}}function or(n,e){return n.yt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function xd(n,e){return n.yt?e.toBase64():e.toUint8Array()}function Qm(n,e){return or(n,e.toTimestamp())}function ve(n){return O(!!n),R.fromTimestamp(function(e){const t=cn(e);return new he(t.seconds,t.nanos)}(n))}function uu(n,e){return(t=n,new Z(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function _d(n){const e=Z.fromString(n);return O(Md(e)),e}function Bi(n,e){return uu(n.databaseId,e.path)}function It(n,e){const t=_d(e);if(t.get(1)!==n.databaseId.projectId)throw new C(x.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new C(x.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new A(Id(t))}function lu(n,e){return uu(n.databaseId,e)}function Td(n){const e=_d(n);return 4===e.length?Z.emptyPath():Id(e)}function qi(n){return new Z(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Id(n){return O(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Cd(n,e,t){return{name:Bi(n,e),fields:t.value.mapValue.fields}}function Ed(n,e,t){const s=It(n,e.name),r=ve(e.updateTime),i=e.createTime?ve(e.createTime):R.min(),o=new Pe({mapValue:{fields:e.fields}}),a=oe.newFoundDocument(s,r,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function Ui(n,e){let t;if(e instanceof rr)t={update:Cd(n,e.key,e.value)};else if(e instanceof ir)t={delete:Bi(n,e.key)};else if(e instanceof Ut)t={update:Cd(n,e.key,e.data),updateMask:ng(e.fieldMask)};else{if(!(e instanceof cu))return D();t={verify:Bi(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(s=>function(r,i){const o=i.transform;if(o instanceof nr)return{fieldPath:i.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof Jn)return{fieldPath:i.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof es)return{fieldPath:i.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof sr)return{fieldPath:i.field.canonicalString(),increment:o.It};throw D()}(0,s))),e.precondition.isNone||(t.currentDocument=void 0!==(r=e.precondition).updateTime?{updateTime:Qm(n,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:D()),t;var r}function hu(n,e){const t=e.currentDocument?void 0!==(r=e.currentDocument).updateTime?de.updateTime(ve(r.updateTime)):void 0!==r.exists?de.exists(r.exists):de.none():de.none(),s=e.updateTransforms?e.updateTransforms.map(r=>function(i,o){let a=null;"setToServerValue"in o?(O("REQUEST_TIME"===o.setToServerValue),a=new nr):"appendMissingElements"in o?a=new Jn(o.appendMissingElements.values||[]):"removeAllFromArray"in o?a=new es(o.removeAllFromArray.values||[]):"increment"in o?a=new sr(i,o.increment):D();const l=me.fromServerFormat(o.fieldPath);return new Pi(l,a)}(n,r)):[];var r;if(e.update){const r=It(n,e.update.name),i=new Pe({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new tt((e.updateMask.fieldPaths||[]).map(h=>me.fromServerFormat(h)));return new Ut(r,i,o,t,s)}return new rr(r,i,t,s)}if(e.delete){const r=It(n,e.delete);return new ir(r,t)}if(e.verify){const r=It(n,e.verify);return new cu(r,t)}return D()}function Sd(n,e){return{documents:[lu(n,e.path)]}}function du(n,e){const t={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(t.parent=lu(n,s),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=lu(n,s.popLast()),t.structuredQuery.from=[{collectionId:s.lastSegment()}]);const r=function(l){if(0!==l.length)return Dd(te.create(l,"and"))}(e.filters);r&&(t.structuredQuery.where=r);const i=function(l){if(0!==l.length)return l.map(h=>{return{field:fn((f=h).field),direction:Jm(f.dir)};var f})}(e.orderBy);i&&(t.structuredQuery.orderBy=i);const o=(h=e.limit,n.yt||Ii(h)?h:{value:h});var h,a,l;return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(t.structuredQuery.endAt={before:!(l=e.endAt).inclusive,values:l.position}),t}function Ad(n){let e=Td(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){O(1===s);const f=t.from[0];f.allDescendants?r=f.collectionId:e=e.child(f.collectionId)}let i=[];t.where&&(i=function(f){const p=kd(f);return p instanceof te&&tu(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(f=>{return new Js(ar((p=f).field),function(y){switch(y){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(p.direction));var p}));let a=null;t.limit&&(a=function(f){let p;return p="object"==typeof f?f.value:f,Ii(p)?null:p}(t.limit));let l=null;var f;t.startAt&&(l=new hn((f=t.startAt).values||[],!!f.before));let h=null;return t.endAt&&(h=function(f){return new hn(f.values||[],!f.before)}(t.endAt)),Hh(e,r,o,i,a,"F",l,h)}function kd(n){return void 0!==n.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=ar(e.unaryFilter.field);return H.create(t,"==",{doubleValue:NaN});case"IS_NULL":const s=ar(e.unaryFilter.field);return H.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=ar(e.unaryFilter.field);return H.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=ar(e.unaryFilter.field);return H.create(i,"!=",{nullValue:"NULL_VALUE"});default:return D()}}(n):void 0!==n.fieldFilter?H.create(ar((e=n).fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return D()}}(e.fieldFilter.op),e.fieldFilter.value):void 0!==n.compositeFilter?function(e){return te.create(e.compositeFilter.filters.map(t=>kd(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return D()}}(e.compositeFilter.op))}(n):D();var e}function Jm(n){return Km[n]}function eg(n){return Gm[n]}function tg(n){return zm[n]}function fn(n){return{fieldPath:n.canonicalString()}}function ar(n){return me.fromServerFormat(n.fieldPath)}function Dd(n){return n instanceof H?function(e){if("=="===e.op){if(Dh(e.value))return{unaryFilter:{field:fn(e.field),op:"IS_NAN"}};if(kh(e.value))return{unaryFilter:{field:fn(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Dh(e.value))return{unaryFilter:{field:fn(e.field),op:"IS_NOT_NAN"}};if(kh(e.value))return{unaryFilter:{field:fn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:fn(e.field),op:eg(e.op),value:e.value}}}(n):n instanceof te?function(e){const t=e.getFilters().map(s=>Dd(s));return 1===t.length?t[0]:{compositeFilter:{op:tg(e.op),filters:t}}}(n):D()}function ng(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Md(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function We(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Nd(e)),e=sg(n.get(t),e);return Nd(e)}function sg(n,e){let t=e;const s=n.length;for(let r=0;r<s;r++){const i=n.charAt(r);switch(i){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=i}}return t}function Nd(n){return n+"\x01\x01"}function Ct(n){const e=n.length;if(O(e>=2),2===e)return O("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),Z.emptyPath();const t=e-2,s=[];let r="";for(let i=0;i<e;){const o=n.indexOf("\x01",i);switch((o<0||o>t)&&D(),n.charAt(o+1)){case"\x01":const a=n.substring(i,o);let l;0===r.length?l=a:(r+=a,l=r,r=""),s.push(l);break;case"\x10":r+=n.substring(i,o),r+="\0";break;case"\x11":r+=n.substring(i,o+1);break;default:D()}i=o+2}return new Z(s)}const Pd=["userId","batchId"];function Ia(n,e){return[n,We(e)]}function Od(n,e,t){return[n,We(e),t]}const rg={},ig=["prefixPath","collectionGroup","readTime","documentId"],og=["prefixPath","collectionGroup","documentId"],ag=["collectionGroup","readTime","prefixPath","documentId"],cg=["canonicalId","targetId"],ug=["targetId","path"],lg=["path","targetId"],hg=["collectionId","parent"],dg=["indexId","uid"],fg=["uid","sequenceNumber"],pg=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],mg=["indexId","uid","orderedDocumentKey"],gg=["userId","collectionPath","documentId"],yg=["userId","collectionPath","largestBatchId"],wg=["userId","collectionGroup","largestBatchId"],Ld=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],vg=[...Ld,"documentOverlays"],Fd=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Rd=Fd,bg=[...Rd,"indexConfiguration","indexState","indexEntries"];class fu extends _h{constructor(e,t){super(),this.re=e,this.currentSequenceNumber=t}}function Oe(n,e){const t=k(n);return yt.M(t.re,e)}class pu{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&Fm(i,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=Oi(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=Oi(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=md();return this.mutations.forEach(r=>{const i=e.get(r.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(r.key)?null:a;const l=od(o,a);null!==l&&s.set(r.key,l),o.isValidDocument()||o.convertToNoDocument(R.min())}),s}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),$())}isEqual(e){return this.batchId===e.batchId&&Ws(this.mutations,e.mutations,(t,s)=>ad(t,s))&&Ws(this.baseMutations,e.baseMutations,(t,s)=>ad(t,s))}}class mu{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){O(e.mutations.length===s.length);let r=qm;const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,s[o].version);return new mu(e,t,s,r)}}class gu{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class pn{constructor(e,t,s,r,i=R.min(),o=R.min(),a=Ae.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new pn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new pn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new pn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Vd{constructor(e){this.oe=e}}function Bd(n,e){const t=e.key,s={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Ca(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())s.document={name:Bi(r=n.oe,(i=e).key),fields:i.data.value.mapValue.fields,updateTime:or(r,i.version.toTimestamp()),createTime:or(r,i.createTime.toTimestamp())};else if(e.isNoDocument())s.noDocument={path:t.path.toArray(),readTime:ts(e.version)};else{if(!e.isUnknownDocument())return D();s.unknownDocument={path:t.path.toArray(),version:ts(e.version)}}var r,i;return s}function Ca(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function ts(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ns(n){const e=new he(n.seconds,n.nanoseconds);return R.fromTimestamp(e)}function ss(n,e){const t=(e.baseMutations||[]).map(i=>hu(n.oe,i));for(let i=0;i<e.mutations.length-1;++i)i+1<e.mutations.length&&void 0!==e.mutations[i+1].transform&&(e.mutations[i].updateTransforms=e.mutations[i+1].transform.fieldTransforms,e.mutations.splice(i+1,1),++i);const s=e.mutations.map(i=>hu(n.oe,i)),r=he.fromMillis(e.localWriteTimeMs);return new pu(e.batchId,r,t,s)}function ji(n){const e=ns(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?ns(n.lastLimboFreeSnapshotVersion):R.min();let s;var r;return void 0!==n.query.documents?(O(1===(r=n.query).documents.length),s=Ze(tr(Td(r.documents[0])))):s=Ze(Ad(n.query)),new pn(s,n.targetId,0,n.lastListenSequenceNumber,e,t,Ae.fromBase64String(n.resumeToken))}function qd(n,e){const t=ts(e.snapshotVersion),s=ts(e.lastLimboFreeSnapshotVersion);let r;r=ma(e.target)?Sd(n.oe,e.target):du(n.oe,e.target);const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Xn(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:s,query:r}}function yu(n){const e=Ad({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?wa(e,e.limit,"L"):e}function wu(n,e){return new gu(e.largestBatchId,hu(n.oe,e.overlayMutation))}function Ud(n,e){const t=e.path.lastSegment();return[n,We(e.path.popLast()),t]}function jd(n,e,t,s){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:ts(s.readTime),documentKey:We(s.documentKey.path),largestBatchId:s.largestBatchId}}class _g{getBundleMetadata(e,t){return $d(e).get(t).next(s=>{if(s)return{id:(r=s).bundleId,createTime:ns(r.createTime),version:r.version};var r})}saveBundleMetadata(e,t){return $d(e).put({bundleId:(s=t).id,createTime:ts(ve(s.createTime)),version:s.version});var s}getNamedQuery(e,t){return Kd(e).get(t).next(s=>{if(s)return{name:(r=s).name,query:yu(r.bundledQuery),readTime:ns(r.readTime)};var r})}saveNamedQuery(e,t){return Kd(e).put({name:(s=t).name,readTime:ts(ve(s.readTime)),bundledQuery:s.bundledQuery});var s}}function $d(n){return Oe(n,"bundles")}function Kd(n){return Oe(n,"namedQueries")}class Ea{constructor(e,t){this.Tt=e,this.userId=t}static ue(e,t){return new Ea(e,t.uid||"")}getOverlay(e,t){return $i(e).get(Ud(this.userId,t)).next(s=>s?wu(this.Tt,s):null)}getOverlays(e,t){const s=Tt();return b.forEach(t,r=>this.getOverlay(e,r).next(i=>{null!==i&&s.set(r,i)})).next(()=>s)}saveOverlays(e,t,s){const r=[];return s.forEach((i,o)=>{const a=new gu(t,o);r.push(this.ce(e,a))}),b.waitFor(r)}removeOverlaysForBatchId(e,t,s){const r=new Set;t.forEach(o=>r.add(We(o.getCollectionPath())));const i=[];return r.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,s],[this.userId,o,s+1],!1,!0);i.push($i(e).Y("collectionPathOverlayIndex",a))}),b.waitFor(i)}getOverlaysForCollection(e,t,s){const r=Tt(),i=We(t),o=IDBKeyRange.bound([this.userId,i,s],[this.userId,i,Number.POSITIVE_INFINITY],!0);return $i(e).W("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const h=wu(this.Tt,l);r.set(h.getKey(),h)}return r})}getOverlaysForCollectionGroup(e,t,s,r){const i=Tt();let o;const a=IDBKeyRange.bound([this.userId,t,s],[this.userId,t,Number.POSITIVE_INFINITY],!0);return $i(e).X({index:"collectionGroupOverlayIndex",range:a},(l,h,f)=>{const p=wu(this.Tt,h);i.size()<r||p.largestBatchId===o?(i.set(p.getKey(),p),o=p.largestBatchId):f.done()}).next(()=>i)}ce(e,t){return $i(e).put(function(s,r,i){const[o,a,l]=Ud(r,i.mutation.key);return{userId:r,collectionPath:a,documentId:l,collectionGroup:i.mutation.key.getCollectionGroup(),largestBatchId:i.largestBatchId,overlayMutation:Ui(s.oe,i.mutation)}}(this.Tt,this.userId,t))}}function $i(n){return Oe(n,"documentOverlays")}class rs{constructor(){}ae(e,t){this.he(e,t),t.le()}he(e,t){if("nullValue"in e)this.fe(t,5);else if("booleanValue"in e)this.fe(t,10),t.de(e.booleanValue?1:0);else if("integerValue"in e)this.fe(t,15),t.de(ge(e.integerValue));else if("doubleValue"in e){const s=ge(e.doubleValue);isNaN(s)?this.fe(t,13):(this.fe(t,15),Ci(s)?t.de(0):t.de(s))}else if("timestampValue"in e){const s=e.timestampValue;this.fe(t,20),"string"==typeof s?t._e(s):(t._e(`${s.seconds||""}`),t.de(s.nanos||0))}else if("stringValue"in e)this.we(e.stringValue,t),this.me(t);else if("bytesValue"in e)this.fe(t,30),t.ge(Qn(e.bytesValue)),this.me(t);else if("referenceValue"in e)this.ye(e.referenceValue,t);else if("geoPointValue"in e){const s=e.geoPointValue;this.fe(t,45),t.de(s.latitude||0),t.de(s.longitude||0)}else"mapValue"in e?Mh(e)?this.fe(t,Number.MAX_SAFE_INTEGER):(this.pe(e.mapValue,t),this.me(t)):"arrayValue"in e?(this.Ie(e.arrayValue,t),this.me(t)):D()}we(e,t){this.fe(t,25),this.Te(e,t)}Te(e,t){t._e(e)}pe(e,t){const s=e.fields||{};this.fe(t,55);for(const r of Object.keys(s))this.we(r,t),this.he(s[r],t)}Ie(e,t){const s=e.values||[];this.fe(t,50);for(const r of s)this.he(r,t)}ye(e,t){this.fe(t,37),A.fromName(e).path.forEach(s=>{this.fe(t,60),this.Te(s,t)})}fe(e,t){e.de(t)}me(e){e.de(2)}}function Tg(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Gd(n){const e=64-function(t){let s=0;for(let r=0;r<8;++r){const i=Tg(255&t[r]);if(s+=i,8!==i)break}return s}(n);return Math.ceil(e/8)}rs.Ee=new rs;class Ig{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ae(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Re(s.value),s=t.next();this.be()}ve(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Pe(s.value),s=t.next();this.Ve()}Se(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Re(s);else if(s<2048)this.Re(960|s>>>6),this.Re(128|63&s);else if(t<"\ud800"||"\udbff"<t)this.Re(480|s>>>12),this.Re(128|63&s>>>6),this.Re(128|63&s);else{const r=t.codePointAt(0);this.Re(240|r>>>18),this.Re(128|63&r>>>12),this.Re(128|63&r>>>6),this.Re(128|63&r)}}this.be()}De(e){for(const t of e){const s=t.charCodeAt(0);if(s<128)this.Pe(s);else if(s<2048)this.Pe(960|s>>>6),this.Pe(128|63&s);else if(t<"\ud800"||"\udbff"<t)this.Pe(480|s>>>12),this.Pe(128|63&s>>>6),this.Pe(128|63&s);else{const r=t.codePointAt(0);this.Pe(240|r>>>18),this.Pe(128|63&r>>>12),this.Pe(128|63&r>>>6),this.Pe(128|63&r)}}this.Ve()}Ce(e){const t=this.xe(e),s=Gd(t);this.Ne(1+s),this.buffer[this.position++]=255&s;for(let r=t.length-s;r<t.length;++r)this.buffer[this.position++]=255&t[r]}ke(e){const t=this.xe(e),s=Gd(t);this.Ne(1+s),this.buffer[this.position++]=~(255&s);for(let r=t.length-s;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}Oe(){this.Me(255),this.Me(255)}Fe(){this.$e(255),this.$e(255)}reset(){this.position=0}seed(e){this.Ne(e.length),this.buffer.set(e,this.position),this.position+=e.length}Be(){return this.buffer.slice(0,this.position)}xe(e){const t=function(r){const i=new DataView(new ArrayBuffer(8));return i.setFloat64(0,r,!1),new Uint8Array(i.buffer)}(e),s=0!=(128&t[0]);t[0]^=s?255:128;for(let r=1;r<t.length;++r)t[r]^=s?255:0;return t}Re(e){const t=255&e;0===t?(this.Me(0),this.Me(255)):255===t?(this.Me(255),this.Me(0)):this.Me(t)}Pe(e){const t=255&e;0===t?(this.$e(0),this.$e(255)):255===t?(this.$e(255),this.$e(0)):this.$e(e)}be(){this.Me(0),this.Me(1)}Ve(){this.$e(0),this.$e(1)}Me(e){this.Ne(1),this.buffer[this.position++]=e}$e(e){this.Ne(1),this.buffer[this.position++]=~e}Ne(e){const t=e+this.position;if(t<=this.buffer.length)return;let s=2*this.buffer.length;s<t&&(s=t);const r=new Uint8Array(s);r.set(this.buffer),this.buffer=r}}class Cg{constructor(e){this.Le=e}ge(e){this.Le.Ae(e)}_e(e){this.Le.Se(e)}de(e){this.Le.Ce(e)}le(){this.Le.Oe()}}class Eg{constructor(e){this.Le=e}ge(e){this.Le.ve(e)}_e(e){this.Le.De(e)}de(e){this.Le.ke(e)}le(){this.Le.Fe()}}class Ki{constructor(){this.Le=new Ig,this.qe=new Cg(this.Le),this.Ue=new Eg(this.Le)}seed(e){this.Le.seed(e)}Ke(e){return 0===e?this.qe:this.Ue}Be(){return this.Le.Be()}reset(){this.Le.reset()}}class is{constructor(e,t,s,r){this.indexId=e,this.documentKey=t,this.arrayValue=s,this.directionalValue=r}Ge(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,s=new Uint8Array(t);return s.set(this.directionalValue,0),t!==e?s.set([0],this.directionalValue.length):++s[s.length-1],new is(this.indexId,this.documentKey,this.arrayValue,s)}}function mn(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=zd(n.arrayValue,e.arrayValue),0!==t?t:(t=zd(n.directionalValue,e.directionalValue),0!==t?t:A.comparator(n.documentKey,e.documentKey)))}function zd(n,e){for(let t=0;t<n.length&&t<e.length;++t){const s=n[t]-e[t];if(0!==s)return s}return n.length-e.length}class Sg{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Qe=e.orderBy,this.je=[];for(const t of e.filters){const s=t;s.isInequality()?this.ze=s:this.je.push(s)}}We(e){O(e.collectionGroup===this.collectionId);const t=zc(e);if(void 0!==t&&!this.He(t))return!1;const s=Gn(e);let r=0,i=0;for(;r<s.length&&this.He(s[r]);++r);if(r===s.length)return!0;if(void 0!==this.ze){const o=s[r];if(!this.Je(this.ze,o)||!this.Ye(this.Qe[i++],o))return!1;++r}for(;r<s.length;++r)if(i>=this.Qe.length||!this.Ye(this.Qe[i++],s[r]))return!1;return!0}He(e){for(const t of this.je)if(this.Je(t,e))return!0;return!1}Je(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}Ye(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Hd(n){var e,t;if(O(n instanceof H||n instanceof te),n instanceof H){if(n instanceof jh){const r=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(i=>H.create(n.field,"==",i)))||[];return te.create(r,"or")}return n}const s=n.filters.map(r=>Hd(r));return te.create(s,n.op)}function Ag(n){if(0===n.getFilters().length)return[];const e=xu(Hd(n));return O(Qd(e)),vu(e)||bu(e)?[e]:e.getFilters()}function vu(n){return n instanceof H}function bu(n){return n instanceof te&&tu(n)}function Qd(n){return vu(n)||bu(n)||function(e){if(e instanceof te&&eu(e)){for(const t of e.getFilters())if(!vu(t)&&!bu(t))return!1;return!0}return!1}(n)}function xu(n){if(O(n instanceof H||n instanceof te),n instanceof H)return n;if(1===n.filters.length)return xu(n.filters[0]);const e=n.filters.map(s=>xu(s));let t=te.create(e,n.op);return t=Sa(t),Qd(t)?t:(O(t instanceof te),O(Ys(t)),O(t.filters.length>1),t.filters.reduce((s,r)=>_u(s,r)))}function _u(n,e){let t;return O(n instanceof H||n instanceof te),O(e instanceof H||e instanceof te),t=n instanceof H?e instanceof H?te.create([n,e],"and"):Zd(n,e):e instanceof H?Zd(e,n):function(s,r){if(O(s.filters.length>0&&r.filters.length>0),Ys(s)&&Ys(r))return Bh(s,r.getFilters());const i=eu(s)?s:r,o=eu(s)?r:s,a=i.filters.map(l=>_u(l,o));return te.create(a,"or")}(n,e),Sa(t)}function Zd(n,e){if(Ys(e))return Bh(e,n.getFilters());{const t=e.filters.map(s=>_u(n,s));return te.create(t,"or")}}function Sa(n){if(O(n instanceof H||n instanceof te),n instanceof H)return n;const e=n.getFilters();if(1===e.length)return Sa(e[0]);if(Rh(n))return n;const t=e.map(r=>Sa(r)),s=[];return t.forEach(r=>{r instanceof H?s.push(r):r instanceof te&&(r.op===n.op?s.push(...r.filters):s.push(r))}),1===s.length?s[0]:te.create(s,n.op)}class kg{constructor(){this.Ze=new Tu}addToCollectionParentIndex(e,t){return this.Ze.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.Ze.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(ot.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(ot.min())}updateCollectionGroup(e,t,s){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}}class Tu{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new ne(Z.comparator),i=!r.has(s);return this.index[t]=r.add(s),i}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new ne(Z.comparator)).toArray()}}const Aa=new Uint8Array(0);class Dg{constructor(e,t){this.user=e,this.databaseId=t,this.Xe=new Tu,this.tn=new dn(s=>Xn(s),(s,r)=>Di(s,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Xe.has(t)){const s=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Xe.add(t)});const i={collectionId:s,parent:We(r)};return Wd(e).put(i)}return b.resolve()}getCollectionParents(e,t){const s=[],r=IDBKeyRange.bound([t,""],[wh(t),""],!1,!0);return Wd(e).W(r).next(i=>{for(const o of i){if(o.collectionId!==t)break;s.push(Ct(o.parent))}return s})}addFieldIndex(e,t){const s=ka(e),r={indexId:(o=t).indexId,collectionGroup:o.collectionGroup,fields:o.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])};var o;delete r.indexId;const i=s.add(r);if(t.indexState){const o=zi(e);return i.next(a=>{o.put(jd(a,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const s=ka(e),r=zi(e),i=Gi(e);return s.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const s=Gi(e);let r=!0;const i=new Map;return b.forEach(this.en(t),o=>this.nn(e,o).next(a=>{r&&(r=!!a),i.set(o,a)})).next(()=>{if(r){let o=$();const a=[];return b.forEach(i,(l,h)=>{var f;E("IndexedDbIndexManager",`Using index ${f=l,`id=${f.indexId}|cg=${f.collectionGroup}|f=${f.fields.map(L=>`${L.fieldPath}:${L.kind}`).join(",")}`} to execute ${Xn(t)}`);const p=function(L,ue){const z=zc(ue);if(void 0===z)return null;for(const Y of ga(L,z.fieldPath))switch(Y.op){case"array-contains-any":return Y.value.arrayValue.values||[];case"array-contains":return[Y.value]}return null}(h,l),y=function(L,ue){const z=new Map;for(const Y of Gn(ue))for(const ke of ga(L,Y.fieldPath))switch(ke.op){case"==":case"in":z.set(Y.fieldPath.canonicalString(),ke.value);break;case"not-in":case"!=":return z.set(Y.fieldPath.canonicalString(),ke.value),Array.from(z.values())}return null}(h,l),v=function(L,ue){const z=[];let Y=!0;for(const ke of Gn(ue)){const lo=0===ke.kind?Gh(L,ke.fieldPath,L.startAt):zh(L,ke.fieldPath,L.startAt);z.push(lo.value),Y&&(Y=lo.inclusive)}return new hn(z,Y)}(h,l),I=function(L,ue){const z=[];let Y=!0;for(const ke of Gn(ue)){const lo=0===ke.kind?zh(L,ke.fieldPath,L.endAt):Gh(L,ke.fieldPath,L.endAt);z.push(lo.value),Y&&(Y=lo.inclusive)}return new hn(z,Y)}(h,l),S=this.sn(l,h,v),P=this.sn(l,h,I),J=this.rn(l,h,y),M=this.on(l.indexId,p,S,v.inclusive,P,I.inclusive,J);return b.forEach(M,L=>s.J(L,t.limit).next(ue=>{ue.forEach(z=>{const Y=A.fromSegments(z.documentKey);o.has(Y)||(o=o.add(Y),a.push(Y))})}))}).next(()=>a)}return b.resolve(null)})}en(e){let t=this.tn.get(e);return t||(t=0===e.filters.length?[e]:Ag(te.create(e.filters,"and")).map(s=>su(e.path,e.collectionGroup,e.orderBy,s.getFilters(),e.limit,e.startAt,e.endAt)),this.tn.set(e,t),t)}on(e,t,s,r,i,o,a){const l=(null!=t?t.length:1)*Math.max(s.length,i.length),h=l/(null!=t?t.length:1),f=[];for(let p=0;p<l;++p){const y=t?this.un(t[p/h]):Aa,v=this.cn(e,y,s[p%h],r),I=this.an(e,y,i[p%h],o),S=a.map(P=>this.cn(e,y,P,!0));f.push(...this.createRange(v,I,S))}return f}cn(e,t,s,r){const i=new is(e,A.empty(),t,s);return r?i:i.Ge()}an(e,t,s,r){const i=new is(e,A.empty(),t,s);return r?i.Ge():i}nn(e,t){const s=new Sg(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(i=>{let o=null;for(const a of i)s.We(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let s=2;const r=this.en(t);return b.forEach(r,i=>this.nn(e,i).next(o=>{o?0!==s&&o.fields.length<function(a){let l=new ne(me.comparator),h=!1;for(const f of a.filters)for(const p of f.getFlattenedFilters())p.field.isKeyField()||("array-contains"===p.op||"array-contains-any"===p.op?h=!0:l=l.add(p.field));for(const f of a.orderBy)f.field.isKeyField()||(l=l.add(f.field));return l.size+(h?1:0)}(i)&&(s=1):s=0})).next(()=>null!==t.limit&&r.length>1&&2===s?1:s)}hn(e,t){const s=new Ki;for(const r of Gn(e)){const i=t.data.field(r.fieldPath);if(null==i)return null;const o=s.Ke(r.kind);rs.Ee.ae(i,o)}return s.Be()}un(e){const t=new Ki;return rs.Ee.ae(e,t.Ke(0)),t.Be()}ln(e,t){const s=new Ki;return rs.Ee.ae(Wn(this.databaseId,t),s.Ke(function(r){const i=Gn(r);return 0===i.length?0:i[i.length-1].kind}(e))),s.Be()}rn(e,t,s){if(null===s)return[];let r=[];r.push(new Ki);let i=0;for(const o of Gn(e)){const a=s[i++];for(const l of r)if(this.fn(t,o.fieldPath)&&Ai(a))r=this.dn(r,o,a);else{const h=l.Ke(o.kind);rs.Ee.ae(a,h)}}return this._n(r)}sn(e,t,s){return this.rn(e,t,s.position)}_n(e){const t=[];for(let s=0;s<e.length;++s)t[s]=e[s].Be();return t}dn(e,t,s){const r=[...e],i=[];for(const o of s.arrayValue.values||[])for(const a of r){const l=new Ki;l.seed(a.Be()),rs.Ee.ae(o,l.Ke(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(s=>s instanceof H&&s.field.isEqual(t)&&("in"===s.op||"not-in"===s.op))}getFieldIndexes(e,t){const s=ka(e),r=zi(e);return(t?s.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):s.W()).next(i=>{const o=[];return b.forEach(i,a=>r.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){const p=f?new _i(f.sequenceNumber,new ot(ns(f.readTime),new A(Ct(f.documentKey)),f.largestBatchId)):_i.empty(),y=h.fields.map(([v,I])=>new la(me.fromServerFormat(v),I));return new ua(h.indexId,h.collectionGroup,y,p)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((s,r)=>{const i=s.indexState.sequenceNumber-r.indexState.sequenceNumber;return 0!==i?i:U(s.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,s){const r=ka(e),i=zi(e);return this.wn(e).next(o=>r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>b.forEach(a,l=>i.put(jd(l.indexId,this.user,o,s)))))}updateIndexEntries(e,t){const s=new Map;return b.forEach(t,(r,i)=>{const o=s.get(r.collectionGroup);return(o?b.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next(a=>(s.set(r.collectionGroup,a),b.forEach(a,l=>this.mn(e,r,l).next(h=>{const f=this.gn(i,l);return h.isEqual(f)?b.resolve():this.yn(e,i,l,h,f)}))))})}pn(e,t,s,r){return Gi(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.ln(s,t.key),documentKey:t.key.path.toArray()})}In(e,t,s,r){return Gi(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.ln(s,t.key),t.key.path.toArray()])}mn(e,t,s){const r=Gi(e);let i=new ne(mn);return r.X({index:"documentKeyIndex",range:IDBKeyRange.only([s.indexId,this.uid,this.ln(s,t)])},(o,a)=>{i=i.add(new is(s.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}gn(e,t){let s=new ne(mn);const r=this.hn(t,e);if(null==r)return s;const i=zc(t);if(null!=i){const o=e.data.field(i.fieldPath);if(Ai(o))for(const a of o.arrayValue.values||[])s=s.add(new is(t.indexId,e.key,this.un(a),r))}else s=s.add(new is(t.indexId,e.key,Aa,r));return s}yn(e,t,s,r,i){E("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(a,l,h,f,p){const y=a.getIterator(),v=l.getIterator();let I=er(y),S=er(v);for(;I||S;){let P=!1,J=!1;if(I&&S){const M=h(I,S);M<0?J=!0:M>0&&(P=!0)}else null!=I?J=!0:P=!0;P?(f(S),S=er(v)):J?(p(I),I=er(y)):(I=er(y),S=er(v))}}(r,i,mn,a=>{o.push(this.pn(e,t,s,a))},a=>{o.push(this.In(e,t,s,a))}),b.waitFor(o)}wn(e){let t=1;return zi(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(s,r,i)=>{i.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,s){s=s.sort((o,a)=>mn(o,a)).filter((o,a,l)=>!a||0!==mn(o,l[a-1]));const r=[];r.push(e);for(const o of s){const a=mn(o,e),l=mn(o,t);if(0===a)r[0]=e.Ge();else if(a>0&&l<0)r.push(o),r.push(o.Ge());else if(l>0)break}r.push(t);const i=[];for(let o=0;o<r.length;o+=2){if(this.Tn(r[o],r[o+1]))return[];i.push(IDBKeyRange.bound([r[o].indexId,this.uid,r[o].arrayValue,r[o].directionalValue,Aa,[]],[r[o+1].indexId,this.uid,r[o+1].arrayValue,r[o+1].directionalValue,Aa,[]]))}return i}Tn(e,t){return mn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Xd)}getMinOffset(e,t){return b.mapArray(this.en(t),s=>this.nn(e,s).next(r=>r||D())).next(Xd)}}function Wd(n){return Oe(n,"collectionParents")}function Gi(n){return Oe(n,"indexEntries")}function ka(n){return Oe(n,"indexConfiguration")}function zi(n){return Oe(n,"indexState")}function Xd(n){O(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let s=1;s<n.length;s++){const r=n[s].indexState.offset;Hc(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new ot(e.readTime,e.documentKey,t)}const Yd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class st{constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}static withCacheSize(e){return new st(e,st.DEFAULT_COLLECTION_PERCENTILE,st.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Jd(n,e,t){const s=n.store("mutations"),r=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=s.X({range:o},(f,p,y)=>(a++,y.delete()));i.push(l.next(()=>{O(1===a)}));const h=[];for(const f of t.mutations){const p=Od(e,f.key.path,t.batchId);i.push(r.delete(p)),h.push(f.key)}return b.waitFor(i).next(()=>h)}function Da(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw D();e=n.noDocument}return JSON.stringify(e).length}st.DEFAULT_COLLECTION_PERCENTILE=10,st.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,st.DEFAULT=new st(41943040,st.DEFAULT_COLLECTION_PERCENTILE,st.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),st.DISABLED=new st(-1,0,0);class Ma{constructor(e,t,s,r){this.userId=e,this.Tt=t,this.indexManager=s,this.referenceDelegate=r,this.En={}}static ue(e,t,s,r){O(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Ma(i,t,s,r)}checkEmpty(e){let t=!0;const s=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return gn(e).X({index:"userMutationsIndex",range:s},(r,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,s,r){const i=cr(e),o=gn(e);return o.add({}).next(a=>{O("number"==typeof a);const l=new pu(a,t,s,r),h=function(y,v,I){const S=I.baseMutations.map(J=>Ui(y.oe,J)),P=I.mutations.map(J=>Ui(y.oe,J));return{userId:v,batchId:I.batchId,localWriteTimeMs:I.localWriteTime.toMillis(),baseMutations:S,mutations:P}}(this.Tt,this.userId,l),f=[];let p=new ne((y,v)=>U(y.canonicalString(),v.canonicalString()));for(const y of r){const v=Od(this.userId,y.key.path,a);p=p.add(y.key.path.popLast()),f.push(o.put(h)),f.push(i.put(v,rg))}return p.forEach(y=>{f.push(this.indexManager.addToCollectionParentIndex(e,y))}),e.addOnCommittedListener(()=>{this.En[a]=l.keys()}),b.waitFor(f).next(()=>l)})}lookupMutationBatch(e,t){return gn(e).get(t).next(s=>s?(O(s.userId===this.userId),ss(this.Tt,s)):null)}An(e,t){return this.En[t]?b.resolve(this.En[t]):this.lookupMutationBatch(e,t).next(s=>{if(s){const r=s.keys();return this.En[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=IDBKeyRange.lowerBound([this.userId,s]);let i=null;return gn(e).X({index:"userMutationsIndex",range:r},(o,a,l)=>{a.userId===this.userId&&(O(a.batchId>=s),i=ss(this.Tt,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let s=-1;return gn(e).X({index:"userMutationsIndex",range:t,reverse:!0},(r,i,o)=>{s=i.batchId,o.done()}).next(()=>s)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return gn(e).W("userMutationsIndex",t).next(s=>s.map(r=>ss(this.Tt,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){const s=Ia(this.userId,t.path),r=IDBKeyRange.lowerBound(s),i=[];return cr(e).X({range:r},(o,a,l)=>{const[h,f,p]=o,y=Ct(f);if(h===this.userId&&t.path.isEqual(y))return gn(e).get(p).next(v=>{if(!v)throw D();O(v.userId===this.userId),i.push(ss(this.Tt,v))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new ne(U);const r=[];return t.forEach(i=>{const o=Ia(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=cr(e).X({range:a},(h,f,p)=>{const[y,v,I]=h,S=Ct(v);y===this.userId&&i.path.isEqual(S)?s=s.add(I):p.done()});r.push(l)}),b.waitFor(r).next(()=>this.Rn(e,s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1,i=Ia(this.userId,s),o=IDBKeyRange.lowerBound(i);let a=new ne(U);return cr(e).X({range:o},(l,h,f)=>{const[p,y,v]=l,I=Ct(y);p===this.userId&&s.isPrefixOf(I)?I.length===r&&(a=a.add(v)):f.done()}).next(()=>this.Rn(e,a))}Rn(e,t){const s=[],r=[];return t.forEach(i=>{r.push(gn(e).get(i).next(o=>{if(null===o)throw D();O(o.userId===this.userId),s.push(ss(this.Tt,o))}))}),b.waitFor(r).next(()=>s)}removeMutationBatch(e,t){return Jd(e.re,this.userId,t).next(s=>(e.addOnCommittedListener(()=>{this.bn(t.batchId)}),b.forEach(s,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}bn(e){delete this.En[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return b.resolve();const s=IDBKeyRange.lowerBound([this.userId]),r=[];return cr(e).X({range:s},(i,o,a)=>{if(i[0]===this.userId){const l=Ct(i[1]);r.push(l)}else a.done()}).next(()=>{O(0===r.length)})})}containsKey(e,t){return ef(e,this.userId,t)}vn(e){return tf(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function ef(n,e,t){const s=Ia(e,t.path),r=s[1],i=IDBKeyRange.lowerBound(s);let o=!1;return cr(n).X({range:i,Z:!0},(a,l,h)=>{const[f,p,y]=a;f===e&&p===r&&(o=!0),h.done()}).next(()=>o)}function gn(n){return Oe(n,"mutations")}function cr(n){return Oe(n,"documentMutations")}function tf(n){return Oe(n,"mutationQueues")}class os{constructor(e){this.Pn=e}next(){return this.Pn+=2,this.Pn}static Vn(){return new os(0)}static Sn(){return new os(-1)}}class Mg{constructor(e,t){this.referenceDelegate=e,this.Tt=t}allocateTargetId(e){return this.Dn(e).next(t=>{const s=new os(t.highestTargetId);return t.highestTargetId=s.next(),this.Cn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Dn(e).next(t=>R.fromTimestamp(new he(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Dn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,s){return this.Dn(e).next(r=>(r.highestListenSequenceNumber=t,s&&(r.lastRemoteSnapshotVersion=s.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Cn(e,r)))}addTargetData(e,t){return this.xn(e,t).next(()=>this.Dn(e).next(s=>(s.targetCount+=1,this.Nn(t,s),this.Cn(e,s))))}updateTargetData(e,t){return this.xn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>ur(e).delete(t.targetId)).next(()=>this.Dn(e)).next(s=>(O(s.targetCount>0),s.targetCount-=1,this.Cn(e,s)))}removeTargets(e,t,s){let r=0;const i=[];return ur(e).X((o,a)=>{const l=ji(a);l.sequenceNumber<=t&&null===s.get(l.targetId)&&(r++,i.push(this.removeTargetData(e,l)))}).next(()=>b.waitFor(i)).next(()=>r)}forEachTarget(e,t){return ur(e).X((s,r)=>{const i=ji(r);t(i)})}Dn(e){return nf(e).get("targetGlobalKey").next(t=>(O(null!==t),t))}Cn(e,t){return nf(e).put("targetGlobalKey",t)}xn(e,t){return ur(e).put(qd(this.Tt,t))}Nn(e,t){let s=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,s=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,s=!0),s}getTargetCount(e){return this.Dn(e).next(t=>t.targetCount)}getTargetData(e,t){const s=Xn(t),r=IDBKeyRange.bound([s,Number.NEGATIVE_INFINITY],[s,Number.POSITIVE_INFINITY]);let i=null;return ur(e).X({range:r,index:"queryTargetsIndex"},(o,a,l)=>{const h=ji(a);Di(t,h.target)&&(i=h,l.done())}).next(()=>i)}addMatchingKeys(e,t,s){const r=[],i=yn(e);return t.forEach(o=>{const a=We(o.path);r.push(i.put({targetId:s,path:a})),r.push(this.referenceDelegate.addReference(e,s,o))}),b.waitFor(r)}removeMatchingKeys(e,t,s){const r=yn(e);return b.forEach(t,i=>{const o=We(i.path);return b.waitFor([r.delete([s,o]),this.referenceDelegate.removeReference(e,s,i)])})}removeMatchingKeysForTargetId(e,t){const s=yn(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return s.delete(r)}getMatchingKeysForTargetId(e,t){const s=IDBKeyRange.bound([t],[t+1],!1,!0),r=yn(e);let i=$();return r.X({range:s,Z:!0},(o,a,l)=>{const h=Ct(o[1]),f=new A(h);i=i.add(f)}).next(()=>i)}containsKey(e,t){const s=We(t.path),r=IDBKeyRange.bound([s],[wh(s)],!1,!0);let i=0;return yn(e).X({index:"documentTargetsIndex",Z:!0,range:r},([o,a],l,h)=>{0!==o&&(i++,h.done())}).next(()=>i>0)}ie(e,t){return ur(e).get(t).next(s=>s?ji(s):null)}}function ur(n){return Oe(n,"targets")}function nf(n){return Oe(n,"targetGlobal")}function yn(n){return Oe(n,"targetDocuments")}function sf([n,e],[t,s]){const r=U(n,t);return 0===r?U(e,s):r}class Ng{constructor(e){this.kn=e,this.buffer=new ne(sf),this.On=0}Mn(){return++this.On}Fn(e){const t=[e,this.Mn()];if(this.buffer.size<this.kn)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();sf(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Pg{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.$n=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Bn(6e4)}stop(){this.$n&&(this.$n.cancel(),this.$n=null)}get started(){return null!==this.$n}Bn(e){var t=this;E("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.$n=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,w.Z)(function*(){t.$n=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(s){on(s)?E("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",s):yield rn(s)}yield t.Bn(3e5)}))}}class Og{constructor(e,t){this.Ln=e,this.params=t}calculateTargetCount(e,t){return this.Ln.qn(e).next(s=>Math.floor(t/100*s))}nthSequenceNumber(e,t){if(0===t)return b.resolve(at.at);const s=new Ng(t);return this.Ln.forEachTarget(e,r=>s.Fn(r.sequenceNumber)).next(()=>this.Ln.Un(e,r=>s.Fn(r))).next(()=>s.maxValue)}removeTargets(e,t,s){return this.Ln.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.Ln.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(E("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(Yd)):this.getCacheSize(e).next(s=>s<this.params.cacheSizeCollectionThreshold?(E("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Yd):this.Kn(e,t))}getCacheSize(e){return this.Ln.getCacheSize(e)}Kn(e,t){let s,r,i,o,a,l,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(E("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),r=this.params.maximumSequenceNumbersToCollect):r=p,o=Date.now(),this.nthSequenceNumber(e,r))).next(p=>(s=p,a=Date.now(),this.removeTargets(e,s,t))).next(p=>(i=p,l=Date.now(),this.removeOrphanedDocuments(e,s))).next(p=>(h=Date.now(),Kc()<=Je.in.DEBUG&&E("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-f}ms\n\tDetermined least recently used ${r} in `+(a-o)+`ms\n\tRemoved ${i} targets in `+(l-a)+`ms\n\tRemoved ${p} documents in `+(h-l)+`ms\nTotal Duration: ${h-f}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:p})))}}class Lg{constructor(e,t){this.db=e,this.garbageCollector=new Og(this,t)}qn(e){const t=this.Gn(e);return this.db.getTargetCache().getTargetCount(e).next(s=>t.next(r=>s+r))}Gn(e){let t=0;return this.Un(e,s=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Un(e,t){return this.Qn(e,(s,r)=>t(r))}addReference(e,t,s){return Na(e,s)}removeReference(e,t,s){return Na(e,s)}removeTargets(e,t,s){return this.db.getTargetCache().removeTargets(e,t,s)}markPotentiallyOrphaned(e,t){return Na(e,t)}jn(e,t){return function(s,r){let i=!1;return tf(s).tt(o=>ef(s,o,r).next(a=>(a&&(i=!0),b.resolve(!a)))).next(()=>i)}(e,t)}removeOrphanedDocuments(e,t){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Qn(e,(o,a)=>{if(a<=t){const l=this.jn(e,o).next(h=>{if(!h)return i++,s.getEntry(e,o).next(()=>(s.removeEntry(o,R.min()),yn(e).delete([0,We(o.path)])))});r.push(l)}}).next(()=>b.waitFor(r)).next(()=>s.apply(e)).next(()=>i)}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,s)}updateLimboDocument(e,t){return Na(e,t)}Qn(e,t){const s=yn(e);let r,i=at.at;return s.X({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:h})=>{0===o?(i!==at.at&&t(new A(Ct(r)),i),i=h,r=l):i=at.at}).next(()=>{i!==at.at&&t(new A(Ct(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Na(n,e){return yn(n).put((s=n.currentSequenceNumber,{targetId:0,path:We(e.path),sequenceNumber:s}));var s}class rf{constructor(){this.changes=new dn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,oe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return void 0!==s?b.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Fg{constructor(e){this.Tt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,s){return as(e).put(s)}removeEntry(e,t,s){return as(e).delete(function(r,i){const o=r.path.toArray();return[o.slice(0,o.length-2),o[o.length-2],Ca(i),o[o.length-1]]}(t,s))}updateMetadata(e,t){return this.getMetadata(e).next(s=>(s.byteSize+=t,this.zn(e,s)))}getEntry(e,t){let s=oe.newInvalidDocument(t);return as(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(Hi(t))},(r,i)=>{s=this.Wn(t,i)}).next(()=>s)}Hn(e,t){let s={size:0,document:oe.newInvalidDocument(t)};return as(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(Hi(t))},(r,i)=>{s={document:this.Wn(t,i),size:Da(i)}}).next(()=>s)}getEntries(e,t){let s=nt();return this.Jn(e,t,(r,i)=>{const o=this.Wn(r,i);s=s.insert(r,o)}).next(()=>s)}Yn(e,t){let s=nt(),r=new ye(A.comparator);return this.Jn(e,t,(i,o)=>{const a=this.Wn(i,o);s=s.insert(i,a),r=r.insert(i,Da(o))}).next(()=>({documents:s,Zn:r}))}Jn(e,t,s){if(t.isEmpty())return b.resolve();let r=new ne(uf);t.forEach(l=>r=r.add(l));const i=IDBKeyRange.bound(Hi(r.first()),Hi(r.last())),o=r.getIterator();let a=o.getNext();return as(e).X({index:"documentKeyIndex",range:i},(l,h,f)=>{const p=A.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;a&&uf(a,p)<0;)s(a,null),a=o.getNext();a&&a.isEqual(p)&&(s(a,h),a=o.hasNext()?o.getNext():null),a?f.j(Hi(a)):f.done()}).next(()=>{for(;a;)s(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,s,r){const i=t.path,o=[i.popLast().toArray(),i.lastSegment(),Ca(s.readTime),s.documentKey.path.isEmpty()?"":s.documentKey.path.lastSegment()],a=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return as(e).W(IDBKeyRange.bound(o,a,!0)).next(l=>{let h=nt();for(const f of l){const p=this.Wn(A.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);p.isFoundDocument()&&(Ni(t,p)||r.has(p.key))&&(h=h.insert(p.key,p))}return h})}getAllFromCollectionGroup(e,t,s,r){let i=nt();const o=cf(t,s),a=cf(t,ot.max());return as(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,h,f)=>{const p=this.Wn(A.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);i=i.insert(p.key,p),i.size===r&&f.done()}).next(()=>i)}newChangeBuffer(e){return new Rg(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return af(e).get("remoteDocumentGlobalKey").next(t=>(O(!!t),t))}zn(e,t){return af(e).put("remoteDocumentGlobalKey",t)}Wn(e,t){if(t){const s=function xg(n,e){let t;if(e.document)t=Ed(n.oe,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const s=A.fromSegments(e.noDocument.path),r=ns(e.noDocument.readTime);t=oe.newNoDocument(s,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return D();{const s=A.fromSegments(e.unknownDocument.path),r=ns(e.unknownDocument.version);t=oe.newUnknownDocument(s,r)}}return e.readTime&&t.setReadTime(function(s){const r=new he(s[0],s[1]);return R.fromTimestamp(r)}(e.readTime)),t}(this.Tt,t);if(!s.isNoDocument()||!s.version.isEqual(R.min()))return s}return oe.newInvalidDocument(e)}}function of(n){return new Fg(n)}class Rg extends rf{constructor(e,t){super(),this.Xn=e,this.trackRemovals=t,this.ts=new dn(s=>s.toString(),(s,r)=>s.isEqual(r))}applyChanges(e){const t=[];let s=0,r=new ne((i,o)=>U(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.ts.get(i);if(t.push(this.Xn.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=Bd(this.Xn.Tt,o);r=r.add(i.path.popLast());const h=Da(l);s+=h-a.size,t.push(this.Xn.addEntry(e,i,l))}else if(s-=a.size,this.trackRemovals){const l=Bd(this.Xn.Tt,o.convertToNoDocument(R.min()));t.push(this.Xn.addEntry(e,i,l))}}),r.forEach(i=>{t.push(this.Xn.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.Xn.updateMetadata(e,s)),b.waitFor(t)}getFromCache(e,t){return this.Xn.Hn(e,t).next(s=>(this.ts.set(t,{size:s.size,readTime:s.document.readTime}),s.document))}getAllFromCache(e,t){return this.Xn.Yn(e,t).next(({documents:s,Zn:r})=>(r.forEach((i,o)=>{this.ts.set(i,{size:o,readTime:s.get(i).readTime})}),s))}}function af(n){return Oe(n,"remoteDocumentGlobal")}function as(n){return Oe(n,"remoteDocumentsV14")}function Hi(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function cf(n,e){const t=e.documentKey.path.toArray();return[n,Ca(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function uf(n,e){const t=n.path.toArray(),s=e.path.toArray();let r=0;for(let i=0;i<t.length-2&&i<s.length-2;++i)if(r=U(t[i],s[i]),r)return r;return r=U(t.length,s.length),r||(r=U(t[t.length-2],s[s.length-2]),r||U(t[t.length-1],s[s.length-1]))}class Vg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class lf{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(s=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(null!==s&&Oi(s.mutation,r,tt.empty(),he.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.getLocalViewOfDocuments(e,s,$()).next(()=>s))}getLocalViewOfDocuments(e,t,s=$()){const r=Tt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,s).next(i=>{let o=Li();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const s=Tt();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,$()))}populateOverlays(e,t,s){const r=[];return s.forEach(i=>{t.has(i)||r.push(i)}),this.documentOverlayCache.getOverlays(e,r).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,s,r){let i=nt();const o=Fi(),a=Fi();return t.forEach((l,h)=>{const f=s.get(h.key);r.has(h.key)&&(void 0===f||f.mutation instanceof Ut)?i=i.insert(h.key,h):void 0!==f?(o.set(h.key,f.mutation.getFieldMask()),Oi(f.mutation,h,f.mutation.getFieldMask(),he.now())):o.set(h.key,tt.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((h,f)=>o.set(h,f)),t.forEach((h,f)=>{var p;return a.set(h,new Vg(f,null!==(p=o.get(h))&&void 0!==p?p:null))}),a))}recalculateAndSaveOverlays(e,t){const s=Fi();let r=new ye((o,a)=>o-a),i=$();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const h=t.get(l);if(null===h)return;let f=s.get(l)||tt.empty();f=a.applyToLocalView(h,f),s.set(l,f);const p=(r.get(a.batchId)||$()).add(l);r=r.insert(a.batchId,p)})}).next(()=>{const o=[],a=r.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),h=l.key,f=l.value,p=md();f.forEach(y=>{if(!i.has(y)){const v=od(t.get(y),s.get(y));null!==v&&p.set(y,v),i=i.add(y)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,p))}return b.waitFor(o)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,t,s){return A.isDocumentKey((r=t).path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):iu(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s):this.getDocumentsMatchingCollectionQuery(e,t,s);var r}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next(i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-i.size):b.resolve(Tt());let a=-1,l=i;return o.next(h=>b.forEach(h,(f,p)=>(a<p.largestBatchId&&(a=p.largestBatchId),i.get(f)?b.resolve():this.remoteDocumentCache.getEntry(e,f).next(y=>{l=l.insert(f,y)}))).next(()=>this.populateOverlays(e,h,i)).next(()=>this.computeViews(e,l,h,$())).next(f=>({batchId:a,changes:pd(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new A(t)).next(s=>{let r=Li();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,s){const r=t.collectionGroup;let i=Li();return this.indexManager.getCollectionParents(e,r).next(o=>b.forEach(o,a=>{const l=(h=t,f=a.child(r),new qt(f,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt));var h,f;return this.getDocumentsMatchingCollectionQuery(e,l,s).next(h=>{h.forEach((f,p)=>{i=i.insert(f,p)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,s){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next(i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,r))).next(i=>{r.forEach((a,l)=>{const h=l.getKey();null===i.get(h)&&(i=i.insert(h,oe.newInvalidDocument(h)))});let o=Li();return i.forEach((a,l)=>{const h=r.get(a);void 0!==h&&Oi(h.mutation,l,tt.empty(),he.now()),Ni(t,l)&&(o=o.insert(a,l))}),o})}}class Bg{constructor(e){this.Tt=e,this.es=new Map,this.ns=new Map}getBundleMetadata(e,t){return b.resolve(this.es.get(t))}saveBundleMetadata(e,t){var s;return this.es.set(t.id,{id:(s=t).id,version:s.version,createTime:ve(s.createTime)}),b.resolve()}getNamedQuery(e,t){return b.resolve(this.ns.get(t))}saveNamedQuery(e,t){return this.ns.set(t.name,{name:(s=t).name,query:yu(s.bundledQuery),readTime:ve(s.readTime)}),b.resolve();var s}}class qg{constructor(){this.overlays=new ye(A.comparator),this.ss=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){const s=Tt();return b.forEach(t,r=>this.getOverlay(e,r).next(i=>{null!==i&&s.set(r,i)})).next(()=>s)}saveOverlays(e,t,s){return s.forEach((r,i)=>{this.ce(e,t,i)}),b.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.ss.get(s);return void 0!==r&&(r.forEach(i=>this.overlays=this.overlays.remove(i)),this.ss.delete(s)),b.resolve()}getOverlaysForCollection(e,t,s){const r=Tt(),i=t.length+1,o=new A(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,h=l.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===i&&l.largestBatchId>s&&r.set(l.getKey(),l)}return b.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let i=new ye((h,f)=>h-f);const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>s){let f=i.get(h.largestBatchId);null===f&&(f=Tt(),i=i.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const a=Tt(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((h,f)=>a.set(h,f)),!(a.size()>=r)););return b.resolve(a)}ce(e,t,s){const r=this.overlays.get(s.key);if(null!==r){const o=this.ss.get(r.largestBatchId).delete(s.key);this.ss.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new gu(t,s));let i=this.ss.get(t);void 0===i&&(i=$(),this.ss.set(t,i)),this.ss.set(t,i.add(s.key))}}class Iu{constructor(){this.rs=new ne(Le.os),this.us=new ne(Le.cs)}isEmpty(){return this.rs.isEmpty()}addReference(e,t){const s=new Le(e,t);this.rs=this.rs.add(s),this.us=this.us.add(s)}hs(e,t){e.forEach(s=>this.addReference(s,t))}removeReference(e,t){this.ls(new Le(e,t))}fs(e,t){e.forEach(s=>this.removeReference(s,t))}ds(e){const t=new A(new Z([])),s=new Le(t,e),r=new Le(t,e+1),i=[];return this.us.forEachInRange([s,r],o=>{this.ls(o),i.push(o.key)}),i}_s(){this.rs.forEach(e=>this.ls(e))}ls(e){this.rs=this.rs.delete(e),this.us=this.us.delete(e)}ws(e){const t=new A(new Z([])),s=new Le(t,e),r=new Le(t,e+1);let i=$();return this.us.forEachInRange([s,r],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Le(e,0),s=this.rs.firstAfterOrEqual(t);return null!==s&&e.isEqual(s.key)}}class Le{constructor(e,t){this.key=e,this.gs=t}static os(e,t){return A.comparator(e.key,t.key)||U(e.gs,t.gs)}static cs(e,t){return U(e.gs,t.gs)||A.comparator(e.key,t.key)}}class Ug{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ys=1,this.ps=new ne(Le.os)}checkEmpty(e){return b.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,s,r){const i=this.ys;this.ys++;const o=new pu(i,t,s,r);this.mutationQueue.push(o);for(const a of r)this.ps=this.ps.add(new Le(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return b.resolve(o)}lookupMutationBatch(e,t){return b.resolve(this.Is(t))}getNextMutationBatchAfterBatchId(e,t){const r=this.Ts(t+1),i=r<0?0:r;return b.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(0===this.mutationQueue.length?-1:this.ys-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new Le(t,0),r=new Le(t,Number.POSITIVE_INFINITY),i=[];return this.ps.forEachInRange([s,r],o=>{const a=this.Is(o.gs);i.push(a)}),b.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new ne(U);return t.forEach(r=>{const i=new Le(r,0),o=new Le(r,Number.POSITIVE_INFINITY);this.ps.forEachInRange([i,o],a=>{s=s.add(a.gs)})}),b.resolve(this.Es(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let i=s;A.isDocumentKey(i)||(i=i.child(""));const o=new Le(new A(i),0);let a=new ne(U);return this.ps.forEachWhile(l=>{const h=l.key.path;return!!s.isPrefixOf(h)&&(h.length===r&&(a=a.add(l.gs)),!0)},o),b.resolve(this.Es(a))}Es(e){const t=[];return e.forEach(s=>{const r=this.Is(s);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){O(0===this.As(t.batchId,"removed")),this.mutationQueue.shift();let s=this.ps;return b.forEach(t.mutations,r=>{const i=new Le(r.key,t.batchId);return s=s.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.ps=s})}bn(e){}containsKey(e,t){const s=new Le(t,0),r=this.ps.firstAfterOrEqual(s);return b.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return b.resolve()}As(e,t){return this.Ts(e)}Ts(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Is(e){const t=this.Ts(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class jg{constructor(e){this.Rs=e,this.docs=new ye(A.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),i=r?r.size:0,o=this.Rs(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return b.resolve(s?s.document.mutableCopy():oe.newInvalidDocument(t))}getEntries(e,t){let s=nt();return t.forEach(r=>{const i=this.docs.get(r);s=s.insert(r,i?i.document.mutableCopy():oe.newInvalidDocument(r))}),b.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let i=nt();const o=t.path,a=new A(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:h,value:{document:f}}=l.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||Hc(bh(f),s)<=0||(r.has(f.key)||Ni(t,f))&&(i=i.insert(f.key,f.mutableCopy()))}return b.resolve(i)}getAllFromCollectionGroup(e,t,s,r){D()}bs(e,t){return b.forEach(this.docs,s=>t(s))}newChangeBuffer(e){return new $g(this)}getSize(e){return b.resolve(this.size)}}class $g extends rf{constructor(e){super(),this.Xn=e}applyChanges(e){const t=[];return this.changes.forEach((s,r)=>{r.isValidDocument()?t.push(this.Xn.addEntry(e,r)):this.Xn.removeEntry(s)}),b.waitFor(t)}getFromCache(e,t){return this.Xn.getEntry(e,t)}getAllFromCache(e,t){return this.Xn.getEntries(e,t)}}class Kg{constructor(e){this.persistence=e,this.vs=new dn(t=>Xn(t),Di),this.lastRemoteSnapshotVersion=R.min(),this.highestTargetId=0,this.Ps=0,this.Vs=new Iu,this.targetCount=0,this.Ss=os.Vn()}forEachTarget(e,t){return this.vs.forEach((s,r)=>t(r)),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.Ps)}allocateTargetId(e){return this.highestTargetId=this.Ss.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.Ps&&(this.Ps=t),b.resolve()}xn(e){this.vs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ss=new os(t),this.highestTargetId=t),e.sequenceNumber>this.Ps&&(this.Ps=e.sequenceNumber)}addTargetData(e,t){return this.xn(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.xn(t),b.resolve()}removeTargetData(e,t){return this.vs.delete(t.target),this.Vs.ds(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,s){let r=0;const i=[];return this.vs.forEach((o,a)=>{a.sequenceNumber<=t&&null===s.get(a.targetId)&&(this.vs.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),b.waitFor(i).next(()=>r)}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){const s=this.vs.get(t)||null;return b.resolve(s)}addMatchingKeys(e,t,s){return this.Vs.hs(t,s),b.resolve()}removeMatchingKeys(e,t,s){this.Vs.fs(t,s);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(o=>{i.push(r.markPotentiallyOrphaned(e,o))}),b.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Vs.ds(t),b.resolve()}getMatchingKeysForTargetId(e,t){const s=this.Vs.ws(t);return b.resolve(s)}containsKey(e,t){return b.resolve(this.Vs.containsKey(t))}}class hf{constructor(e,t){this.Ds={},this.overlays={},this.Cs=new at(0),this.xs=!1,this.xs=!0,this.referenceDelegate=e(this),this.Ns=new Kg(this),this.indexManager=new kg,this.remoteDocumentCache=new jg(s=>this.referenceDelegate.ks(s)),this.Tt=new Vd(t),this.Os=new Bg(this.Tt)}start(){return Promise.resolve()}shutdown(){return this.xs=!1,Promise.resolve()}get started(){return this.xs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new qg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.Ds[e.toKey()];return s||(s=new Ug(t,this.referenceDelegate),this.Ds[e.toKey()]=s),s}getTargetCache(){return this.Ns}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Os}runTransaction(e,t,s){E("MemoryPersistence","Starting transaction:",e);const r=new Gg(this.Cs.next());return this.referenceDelegate.Ms(),s(r).next(i=>this.referenceDelegate.Fs(r).next(()=>i)).toPromise().then(i=>(r.raiseOnCommittedEvent(),i))}$s(e,t){return b.or(Object.values(this.Ds).map(s=>()=>s.containsKey(e,t)))}}class Gg extends _h{constructor(e){super(),this.currentSequenceNumber=e}}class Pa{constructor(e){this.persistence=e,this.Bs=new Iu,this.Ls=null}static qs(e){return new Pa(e)}get Us(){if(this.Ls)return this.Ls;throw D()}addReference(e,t,s){return this.Bs.addReference(s,t),this.Us.delete(s.toString()),b.resolve()}removeReference(e,t,s){return this.Bs.removeReference(s,t),this.Us.add(s.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.Us.add(t.toString()),b.resolve()}removeTarget(e,t){this.Bs.ds(t.targetId).forEach(r=>this.Us.add(r.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(i=>this.Us.add(i.toString()))}).next(()=>s.removeTargetData(e,t))}Ms(){this.Ls=new Set}Fs(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.Us,s=>{const r=A.fromPath(s);return this.Ks(e,r).next(i=>{i||t.removeEntry(r,R.min())})}).next(()=>(this.Ls=null,t.apply(e)))}updateLimboDocument(e,t){return this.Ks(e,t).next(s=>{s?this.Us.delete(t.toString()):this.Us.add(t.toString())})}ks(e){return 0}Ks(e,t){return b.or([()=>b.resolve(this.Bs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.$s(e,t)])}}class zg{constructor(e){this.Tt=e}$(e,t,s,r){const i=new ha("createOrUpgrade",t);var a;s<1&&r>=1&&(e.createObjectStore("owner"),(a=e).createObjectStore("mutationQueues",{keyPath:"userId"}),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Pd,{unique:!0}),a.createObjectStore("documentMutations"),df(e),function(a){a.createObjectStore("remoteDocuments")}(e));let o=b.resolve();return s<3&&r>=3&&(0!==s&&(function(a){a.deleteObjectStore("targetDocuments"),a.deleteObjectStore("targets"),a.deleteObjectStore("targetGlobal")}(e),df(e)),o=o.next(()=>function(a){const l=a.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:R.min().toTimestamp(),targetCount:0};return l.put("targetGlobalKey",h)}(i))),s<4&&r>=4&&(0!==s&&(o=o.next(()=>function(a,l){return l.store("mutations").W().next(h=>{a.deleteObjectStore("mutations"),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Pd,{unique:!0});const f=l.store("mutations"),p=h.map(y=>f.put(y));return b.waitFor(p)})}(e,i))),o=o.next(()=>{!function(a){a.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),s<5&&r>=5&&(o=o.next(()=>this.Gs(i))),s<6&&r>=6&&(o=o.next(()=>(function(a){a.createObjectStore("remoteDocumentGlobal")}(e),this.Qs(i)))),s<7&&r>=7&&(o=o.next(()=>this.js(i))),s<8&&r>=8&&(o=o.next(()=>this.zs(e,i))),s<9&&r>=9&&(o=o.next(()=>{!function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")}(e)})),s<10&&r>=10&&(o=o.next(()=>this.Ws(i))),s<11&&r>=11&&(o=o.next(()=>{(function(a){a.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(a){a.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),s<12&&r>=12&&(o=o.next(()=>{!function(a){const l=a.createObjectStore("documentOverlays",{keyPath:gg});l.createIndex("collectionPathOverlayIndex",yg,{unique:!1}),l.createIndex("collectionGroupOverlayIndex",wg,{unique:!1})}(e)})),s<13&&r>=13&&(o=o.next(()=>function(a){const l=a.createObjectStore("remoteDocumentsV14",{keyPath:ig});l.createIndex("documentKeyIndex",og),l.createIndex("collectionGroupIndex",ag)}(e)).next(()=>this.Hs(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),s<14&&r>=14&&(o=o.next(()=>this.Js(e,i))),s<15&&r>=15&&(o=o.next(()=>function(a){a.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),a.createObjectStore("indexState",{keyPath:dg}).createIndex("sequenceNumberIndex",fg,{unique:!1}),a.createObjectStore("indexEntries",{keyPath:pg}).createIndex("documentKeyIndex",mg,{unique:!1})}(e))),o}Qs(e){let t=0;return e.store("remoteDocuments").X((s,r)=>{t+=Da(r)}).next(()=>{const s={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",s)})}Gs(e){const t=e.store("mutationQueues"),s=e.store("mutations");return t.W().next(r=>b.forEach(r,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return s.W("userMutationsIndex",o).next(a=>b.forEach(a,l=>{O(l.userId===i.userId);const h=ss(this.Tt,l);return Jd(e,i.userId,h).next(()=>{})}))}))}js(e){const t=e.store("targetDocuments"),s=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(r=>{const i=[];return s.X((o,a)=>{const l=new Z(o),h=[0,We(l)];i.push(t.get(h).next(f=>f?b.resolve():t.put({targetId:0,path:We(l),sequenceNumber:r.highestListenSequenceNumber})))}).next(()=>b.waitFor(i))})}zs(e,t){e.createObjectStore("collectionParents",{keyPath:hg});const s=t.store("collectionParents"),r=new Tu,i=o=>{if(r.add(o)){const a=o.lastSegment(),l=o.popLast();return s.put({collectionId:a,parent:We(l)})}};return t.store("remoteDocuments").X({Z:!0},(o,a)=>{const l=new Z(o);return i(l.popLast())}).next(()=>t.store("documentMutations").X({Z:!0},([o,a,l],h)=>{const f=Ct(a);return i(f.popLast())}))}Ws(e){const t=e.store("targets");return t.X((s,r)=>{const i=ji(r),o=qd(this.Tt,i);return t.put(o)})}Hs(e,t){const s=t.store("remoteDocuments"),r=[];return s.X((i,o)=>{const a=t.store("remoteDocumentsV14"),l=(h=o,h.document?new A(Z.fromString(h.document.name).popFirst(5)):h.noDocument?A.fromSegments(h.noDocument.path):h.unknownDocument?A.fromSegments(h.unknownDocument.path):D()).path.toArray();var h;const f={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(a.put(f))}).next(()=>b.waitFor(r))}Js(e,t){const s=t.store("mutations"),r=of(this.Tt),i=new hf(Pa.qs,this.Tt.oe);return s.W().next(o=>{const a=new Map;return o.forEach(l=>{var h;let f=null!==(h=a.get(l.userId))&&void 0!==h?h:$();ss(this.Tt,l).keys().forEach(p=>f=f.add(p)),a.set(l.userId,f)}),b.forEach(a,(l,h)=>{const f=new Ne(h),p=Ea.ue(this.Tt,f),y=i.getIndexManager(f),v=Ma.ue(f,this.Tt,y,i.referenceDelegate);return new lf(r,v,p,y).recalculateAndSaveOverlaysForDocumentKeys(new fu(t,at.at),l).next()})})}}function df(n){n.createObjectStore("targetDocuments",{keyPath:ug}).createIndex("documentTargetsIndex",lg,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",cg,{unique:!0}),n.createObjectStore("targetGlobal")}const Cu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Eu{constructor(e,t,s,r,i,o,a,l,h,f,p=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=s,this.Ys=i,this.window=o,this.document=a,this.Zs=h,this.Xs=f,this.ti=p,this.Cs=null,this.xs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ei=null,this.inForeground=!1,this.ni=null,this.si=null,this.ii=Number.NEGATIVE_INFINITY,this.ri=y=>Promise.resolve(),!Eu.C())throw new C(x.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Lg(this,r),this.oi=t+"main",this.Tt=new Vd(l),this.ui=new yt(this.oi,this.ti,new zg(this.Tt)),this.Ns=new Mg(this.referenceDelegate,this.Tt),this.remoteDocumentCache=of(this.Tt),this.Os=new _g,this.window&&this.window.localStorage?this.ci=this.window.localStorage:(this.ci=null,!1===f&&we("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new C(x.FAILED_PRECONDITION,Cu);return this.hi(),this.li(),this.fi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ns.getHighestSequenceNumber(e))}).then(e=>{this.Cs=new at(e,this.Zs)}).then(()=>{this.xs=!0}).catch(e=>(this.ui&&this.ui.close(),Promise.reject(e)))}di(e){var t=this;return this.ri=function(){var s=(0,w.Z)(function*(r){if(t.started)return e(r)});return function(r){return s.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.ui.L(function(){var t=(0,w.Z)(function*(s){null===s.newVersion&&(yield e())});return function(s){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Ys.enqueueAndForget((0,w.Z)(function*(){t.started&&(yield t.ai())})))}ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Oa(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this._i(e).next(t=>{t||(this.isPrimary=!1,this.Ys.enqueueRetryable(()=>this.ri(!1)))})}).next(()=>this.wi(e)).next(t=>this.isPrimary&&!t?this.mi(e).next(()=>!1):!!t&&this.gi(e).next(()=>!0))).catch(e=>{if(on(e))return E("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return E("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ys.enqueueRetryable(()=>this.ri(e)),this.isPrimary=e})}_i(e){return Qi(e).get("owner").next(t=>b.resolve(this.yi(t)))}pi(e){return Oa(e).delete(this.clientId)}Ii(){var e=this;return(0,w.Z)(function*(){if(e.isPrimary&&!e.Ti(e.ii,18e5)){e.ii=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",s=>{const r=Oe(s,"clientMetadata");return r.W().next(i=>{const o=e.Ei(i,18e5),a=i.filter(l=>-1===o.indexOf(l));return b.forEach(a,l=>r.delete(l.clientId)).next(()=>a)})}).catch(()=>[]);if(e.ci)for(const s of t)e.ci.removeItem(e.Ai(s.clientId))}})()}fi(){this.si=this.Ys.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ai().then(()=>this.Ii()).then(()=>this.fi()))}yi(e){return!!e&&e.ownerId===this.clientId}wi(e){return this.Xs?b.resolve(!0):Qi(e).get("owner").next(t=>{if(null!==t&&this.Ti(t.leaseTimestampMs,5e3)&&!this.Ri(t.ownerId)){if(this.yi(t)&&this.networkEnabled)return!0;if(!this.yi(t)){if(!t.allowTabSynchronization)throw new C(x.FAILED_PRECONDITION,Cu);return!1}}return!(!this.networkEnabled||!this.inForeground)||Oa(e).W().next(s=>void 0===this.Ei(s,5e3).find(r=>!(this.clientId===r.clientId||!(!this.networkEnabled&&r.networkEnabled||!this.inForeground&&r.inForeground&&this.networkEnabled===r.networkEnabled))))}).next(t=>(this.isPrimary!==t&&E("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,w.Z)(function*(){e.xs=!1,e.bi(),e.si&&(e.si.cancel(),e.si=null),e.vi(),e.Pi(),yield e.ui.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const s=new fu(t,at.at);return e.mi(s).next(()=>e.pi(s))}),e.ui.close(),e.Vi()})()}Ei(e,t){return e.filter(s=>this.Ti(s.updateTimeMs,t)&&!this.Ri(s.clientId))}Si(){return this.runTransaction("getActiveClients","readonly",e=>Oa(e).W().next(t=>this.Ei(t,18e5).map(s=>s.clientId)))}get started(){return this.xs}getMutationQueue(e,t){return Ma.ue(e,this.Tt,t,this.referenceDelegate)}getTargetCache(){return this.Ns}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Dg(e,this.Tt.oe.databaseId)}getDocumentOverlayCache(e){return Ea.ue(this.Tt,e)}getBundleCache(){return this.Os}runTransaction(e,t,s){E("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=15===(o=this.ti)?bg:14===o?Rd:13===o?Fd:12===o?vg:11===o?Ld:void D();var o;let a;return this.ui.runTransaction(e,r,i,l=>(a=new fu(l,this.Cs?this.Cs.next():at.at),"readwrite-primary"===t?this._i(a).next(h=>!!h||this.wi(a)).next(h=>{if(!h)throw we(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ys.enqueueRetryable(()=>this.ri(!1)),new C(x.FAILED_PRECONDITION,xh);return s(a)}).next(h=>this.gi(a).next(()=>h)):this.Di(a).next(()=>s(a)))).then(l=>(a.raiseOnCommittedEvent(),l))}Di(e){return Qi(e).get("owner").next(t=>{if(null!==t&&this.Ti(t.leaseTimestampMs,5e3)&&!this.Ri(t.ownerId)&&!this.yi(t)&&!(this.Xs||this.allowTabSynchronization&&t.allowTabSynchronization))throw new C(x.FAILED_PRECONDITION,Cu)})}gi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Qi(e).put("owner",t)}static C(){return yt.C()}mi(e){const t=Qi(e);return t.get("owner").next(s=>this.yi(s)?(E("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):b.resolve())}Ti(e,t){const s=Date.now();return!(e<s-t||e>s&&(we(`Detected an update time that is in the future: ${e} > ${s}`),1))}hi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ni=()=>{this.Ys.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ai()))},this.document.addEventListener("visibilitychange",this.ni),this.inForeground="visible"===this.document.visibilityState)}vi(){this.ni&&(this.document.removeEventListener("visibilitychange",this.ni),this.ni=null)}li(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ei=()=>{this.bi(),(0,q.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Ys.enterRestrictedMode(!0),this.Ys.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ei))}Pi(){this.ei&&(this.window.removeEventListener("pagehide",this.ei),this.ei=null)}Ri(e){var t;try{const s=null!==(null===(t=this.ci)||void 0===t?void 0:t.getItem(this.Ai(e)));return E("IndexedDbPersistence",`Client '${e}' ${s?"is":"is not"} zombied in LocalStorage`),s}catch(s){return we("IndexedDbPersistence","Failed to get zombied client id.",s),!1}}bi(){if(this.ci)try{this.ci.setItem(this.Ai(this.clientId),String(Date.now()))}catch(e){we("Failed to set zombie client id.",e)}}Vi(){if(this.ci)try{this.ci.removeItem(this.Ai(this.clientId))}catch{}}Ai(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Qi(n){return Oe(n,"owner")}function Oa(n){return Oe(n,"clientMetadata")}function Su(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class Au{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Ci=s,this.xi=r}static Ni(e,t){let s=$(),r=$();for(const i of t.docChanges)switch(i.type){case 0:s=s.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new Au(e,t.fromCache,s,r)}}class ff{constructor(){this.ki=!1}initialize(e,t){this.Oi=e,this.indexManager=t,this.ki=!0}getDocumentsMatchingQuery(e,t,s,r){return this.Mi(e,t).next(i=>i||this.Fi(e,t,r,s)).next(i=>i||this.$i(e,t))}Mi(e,t){if(Qh(t))return b.resolve(null);let s=Ze(t);return this.indexManager.getIndexType(e,s).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=wa(t,null,"F"),s=Ze(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next(i=>{const o=$(...i);return this.Oi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,s).next(l=>{const h=this.Bi(t,a);return this.Li(t,h,o,l.readTime)?this.Mi(e,wa(t,null,"F")):this.qi(e,h,t,l)}))})))}Fi(e,t,s,r){return Qh(t)||r.isEqual(R.min())?this.$i(e,t):this.Oi.getDocuments(e,s).next(i=>{const o=this.Bi(t,i);return this.Li(t,o,s,r)?this.$i(e,t):(Kc()<=Je.in.DEBUG&&E("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),au(t)),this.qi(e,o,t,vh(r,-1)))})}Bi(e,t){let s=new ne(Xh(e));return t.forEach((r,i)=>{Ni(e,i)&&(s=s.add(i))}),s}Li(e,t,s,r){if(null===e.limit)return!1;if(s.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}$i(e,t){return Kc()<=Je.in.DEBUG&&E("QueryEngine","Using full collection scan to execute query:",au(t)),this.Oi.getDocumentsMatchingQuery(e,t,ot.min())}qi(e,t,s,r){return this.Oi.getDocumentsMatchingQuery(e,s,r).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}class Hg{constructor(e,t,s,r){this.persistence=e,this.Ui=t,this.Tt=r,this.Ki=new ye(U),this.Gi=new dn(i=>Xn(i),Di),this.Qi=new Map,this.ji=e.getRemoteDocumentCache(),this.Ns=e.getTargetCache(),this.Os=e.getBundleCache(),this.zi(s)}zi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new lf(this.ji,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ji.setIndexManager(this.indexManager),this.Ui.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ki))}}function pf(n,e,t,s){return new Hg(n,e,t,s)}function mf(n,e){return ku.apply(this,arguments)}function ku(){return ku=(0,w.Z)(function*(n,e){const t=k(n);return yield t.persistence.runTransaction("Handle user change","readonly",s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next(i=>(r=i,t.zi(e),t.mutationQueue.getAllMutationBatches(s))).next(i=>{const o=[],a=[];let l=$();for(const h of r){o.push(h.batchId);for(const f of h.mutations)l=l.add(f.key)}for(const h of i){a.push(h.batchId);for(const f of h.mutations)l=l.add(f.key)}return t.localDocuments.getDocuments(s,l).next(h=>({Wi:h,removedBatchIds:o,addedBatchIds:a}))})})}),ku.apply(this,arguments)}function gf(n){const e=k(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ns.getLastRemoteSnapshotVersion(t))}function yf(n,e,t){let s=$(),r=$();return t.forEach(i=>s=s.add(i)),e.getEntries(n,s).next(i=>{let o=nt();return t.forEach((a,l)=>{const h=i.get(a);l.isFoundDocument()!==h.isFoundDocument()&&(r=r.add(a)),l.isNoDocument()&&l.version.isEqual(R.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!h.isValidDocument()||l.version.compareTo(h.version)>0||0===l.version.compareTo(h.version)&&h.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):E("LocalStore","Ignoring outdated watch update for ",a,". Current version:",h.version," Watch version:",l.version)}),{Hi:o,Ji:r}})}function Wg(n,e){const t=k(n);return t.persistence.runTransaction("Get next mutation batch","readonly",s=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}function lr(n,e){const t=k(n);return t.persistence.runTransaction("Allocate target","readwrite",s=>{let r;return t.Ns.getTargetData(s,e).next(i=>i?(r=i,b.resolve(r)):t.Ns.allocateTargetId(s).next(o=>(r=new pn(e,o,0,s.currentSequenceNumber),t.Ns.addTargetData(s,r).next(()=>r))))}).then(s=>{const r=t.Ki.get(s.targetId);return(null===r||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ki=t.Ki.insert(s.targetId,s),t.Gi.set(e,s.targetId)),s})}function hr(n,e,t){return Du.apply(this,arguments)}function Du(){return Du=(0,w.Z)(function*(n,e,t){const s=k(n),r=s.Ki.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield s.persistence.runTransaction("Release target",i,o=>s.persistence.referenceDelegate.removeTarget(o,r)))}catch(o){if(!on(o))throw o;E("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}s.Ki=s.Ki.remove(e),s.Gi.delete(r.target)}),Du.apply(this,arguments)}function La(n,e,t){const s=k(n);let r=R.min(),i=$();return s.persistence.runTransaction("Execute query","readonly",o=>function(a,l,h){const f=k(a),p=f.Gi.get(h);return void 0!==p?b.resolve(f.Ki.get(p)):f.Ns.getTargetData(l,h)}(s,o,Ze(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,s.Ns.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>s.Ui.getDocumentsMatchingQuery(o,e,t?r:R.min(),t?i:$())).next(a=>(bf(s,Wh(e),a),{documents:a,Yi:i})))}function wf(n,e){const t=k(n),s=k(t.Ns),r=t.Ki.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",i=>s.ie(i,e).next(o=>o?o.target:null))}function vf(n,e){const t=k(n),s=t.Qi.get(e)||R.min();return t.persistence.runTransaction("Get new document changes","readonly",r=>t.ji.getAllFromCollectionGroup(r,e,vh(s,-1),Number.MAX_SAFE_INTEGER)).then(r=>(bf(t,e,r),r))}function bf(n,e,t){let s=n.Qi.get(e)||R.min();t.forEach((r,i)=>{i.readTime.compareTo(s)>0&&(s=i.readTime)}),n.Qi.set(e,s)}function Mu(){return Mu=(0,w.Z)(function*(n,e,t,s){const r=k(n);let i=$(),o=nt();for(const h of t){const f=e.Zi(h.metadata.name);h.document&&(i=i.add(f));const p=e.Xi(h);p.setReadTime(e.tr(h.metadata.readTime)),o=o.insert(f,p)}const a=r.ji.newChangeBuffer({trackRemovals:!0}),l=yield lr(r,(h=s,Ze(tr(Z.fromString(`__bundle__/docs/${h}`)))));var h;return r.persistence.runTransaction("Apply bundle documents","readwrite",h=>yf(h,a,o).next(f=>(a.apply(h),f)).next(f=>r.Ns.removeMatchingKeysForTargetId(h,l.targetId).next(()=>r.Ns.addMatchingKeys(h,i,l.targetId)).next(()=>r.localDocuments.getLocalViewOfDocuments(h,f.Hi,f.Ji)).next(()=>f.Hi)))}),Mu.apply(this,arguments)}function Yg(n,e){return Nu.apply(this,arguments)}function Nu(){return Nu=(0,w.Z)(function*(n,e,t=$()){const s=yield lr(n,Ze(yu(e.bundledQuery))),r=k(n);return r.persistence.runTransaction("Save named query","readwrite",i=>{const o=ve(e.readTime);if(s.snapshotVersion.compareTo(o)>=0)return r.Os.saveNamedQuery(i,e);const a=s.withResumeToken(Ae.EMPTY_BYTE_STRING,o);return r.Ki=r.Ki.insert(a.targetId,a),r.Ns.updateTargetData(i,a).next(()=>r.Ns.removeMatchingKeysForTargetId(i,s.targetId)).next(()=>r.Ns.addMatchingKeys(i,t,s.targetId)).next(()=>r.Os.saveNamedQuery(i,e))})}),Nu.apply(this,arguments)}function xf(n,e){return`firestore_clients_${n}_${e}`}function _f(n,e,t){let s=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(s+=`_${e.uid}`),s}function Pu(n,e){return`firestore_targets_${n}_${e}`}class Fa{constructor(e,t,s,r){this.user=e,this.batchId=t,this.state=s,this.error=r}static er(e,t,s){const r=JSON.parse(s);let i,o="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return o&&r.error&&(o="string"==typeof r.error.message&&"string"==typeof r.error.code,o&&(i=new C(r.error.code,r.error.message))),o?new Fa(e,t,r.state,i):(we("SharedClientState",`Failed to parse mutation state for ID '${t}': ${s}`),null)}nr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Zi{constructor(e,t,s){this.targetId=e,this.state=t,this.error=s}static er(e,t){const s=JSON.parse(t);let r,i="object"==typeof s&&-1!==["not-current","current","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return i&&s.error&&(i="string"==typeof s.error.message&&"string"==typeof s.error.code,i&&(r=new C(s.error.code,s.error.message))),i?new Zi(e,s.state,r):(we("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}nr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ra{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static er(e,t){const s=JSON.parse(t);let r="object"==typeof s&&s.activeTargetIds instanceof Array,i=_a();for(let o=0;r&&o<s.activeTargetIds.length;++o)r=Eh(s.activeTargetIds[o]),i=i.add(s.activeTargetIds[o]);return r?new Ra(e,i):(we("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Ou{constructor(e,t){this.clientId=e,this.onlineState=t}static er(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Ou(t.clientId,t.onlineState):(we("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Lu{constructor(){this.activeTargetIds=_a()}sr(e){this.activeTargetIds=this.activeTargetIds.add(e)}ir(e){this.activeTargetIds=this.activeTargetIds.delete(e)}nr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Fu{constructor(e,t,s,r,i){this.window=e,this.Ys=t,this.persistenceKey=s,this.rr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ur=this.cr.bind(this),this.ar=new ye(U),this.started=!1,this.hr=[];const o=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.lr=xf(this.persistenceKey,this.rr),this.dr=`firestore_sequence_number_${this.persistenceKey}`,this.ar=this.ar.insert(this.rr,new Lu),this._r=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.wr=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.mr=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.gr=`firestore_online_state_${this.persistenceKey}`,this.yr=function(a){return`firestore_bundle_loaded_v2_${a}`}(this.persistenceKey),this.window.addEventListener("storage",this.ur)}static C(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,w.Z)(function*(){const t=yield e.syncEngine.Si();for(const r of t){if(r===e.rr)continue;const i=e.getItem(xf(e.persistenceKey,r));if(i){const o=Ra.er(r,i);o&&(e.ar=e.ar.insert(o.clientId,o))}}e.pr();const s=e.storage.getItem(e.gr);if(s){const r=e.Ir(s);r&&e.Tr(r)}for(const r of e.hr)e.cr(r);e.hr=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.dr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Er(this.ar)}isActiveQueryTarget(e){let t=!1;return this.ar.forEach((s,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ar(e,"pending")}updateMutationState(e,t,s){this.Ar(e,t,s),this.Rr(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Pu(this.persistenceKey,e));if(s){const r=Zi.er(e,s);r&&(t=r.state)}}return this.br.sr(e),this.pr(),t}removeLocalQueryTarget(e){this.br.ir(e),this.pr()}isLocalQueryTarget(e){return this.br.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Pu(this.persistenceKey,e))}updateQueryState(e,t,s){this.vr(e,t,s)}handleUserChange(e,t,s){t.forEach(r=>{this.Rr(r)}),this.currentUser=e,s.forEach(r=>{this.addPendingMutation(r)})}setOnlineState(e){this.Pr(e)}notifyBundleLoaded(e){this.Vr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ur),this.removeItem(this.lr),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return E("SharedClientState","READ",e,t),t}setItem(e,t){E("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){E("SharedClientState","REMOVE",e),this.storage.removeItem(e)}cr(e){var t=this;const s=e;if(s.storageArea===this.storage){if(E("SharedClientState","EVENT",s.key,s.newValue),s.key===this.lr)return void we("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ys.enqueueRetryable((0,w.Z)(function*(){if(t.started){if(null!==s.key)if(t._r.test(s.key)){if(null==s.newValue){const r=t.Sr(s.key);return t.Dr(r,null)}{const r=t.Cr(s.key,s.newValue);if(r)return t.Dr(r.clientId,r)}}else if(t.wr.test(s.key)){if(null!==s.newValue){const r=t.Nr(s.key,s.newValue);if(r)return t.kr(r)}}else if(t.mr.test(s.key)){if(null!==s.newValue){const r=t.Or(s.key,s.newValue);if(r)return t.Mr(r)}}else if(s.key===t.gr){if(null!==s.newValue){const r=t.Ir(s.newValue);if(r)return t.Tr(r)}}else if(s.key===t.dr){const r=function(i){let o=at.at;if(null!=i)try{const a=JSON.parse(i);O("number"==typeof a),o=a}catch(a){we("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(s.newValue);r!==at.at&&t.sequenceNumberHandler(r)}else if(s.key===t.yr){const r=t.Fr(s.newValue);yield Promise.all(r.map(i=>t.syncEngine.$r(i)))}}else t.hr.push(s)}))}}get br(){return this.ar.get(this.rr)}pr(){this.setItem(this.lr,this.br.nr())}Ar(e,t,s){const r=new Fa(this.currentUser,e,t,s),i=_f(this.persistenceKey,this.currentUser,e);this.setItem(i,r.nr())}Rr(e){const t=_f(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Pr(e){this.storage.setItem(this.gr,JSON.stringify({clientId:this.rr,onlineState:e}))}vr(e,t,s){const r=Pu(this.persistenceKey,e),i=new Zi(e,t,s);this.setItem(r,i.nr())}Vr(e){const t=JSON.stringify(Array.from(e));this.setItem(this.yr,t)}Sr(e){const t=this._r.exec(e);return t?t[1]:null}Cr(e,t){const s=this.Sr(e);return Ra.er(s,t)}Nr(e,t){const s=this.wr.exec(e),r=Number(s[1]);return Fa.er(new Ne(void 0!==s[2]?s[2]:null),r,t)}Or(e,t){const s=this.mr.exec(e),r=Number(s[1]);return Zi.er(r,t)}Ir(e){return Ou.er(e)}Fr(e){return JSON.parse(e)}kr(e){var t=this;return(0,w.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Br(e.batchId,e.state,e.error);E("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Mr(e){return this.syncEngine.Lr(e.targetId,e.state,e.error)}Dr(e,t){const s=t?this.ar.insert(e,t):this.ar.remove(e),r=this.Er(this.ar),i=this.Er(s),o=[],a=[];return i.forEach(l=>{r.has(l)||o.push(l)}),r.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.qr(o,a).then(()=>{this.ar=s})}Tr(e){this.ar.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Er(e){let t=_a();return e.forEach((s,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class Tf{constructor(){this.Ur=new Lu,this.Kr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e){return this.Ur.sr(e),this.Kr[e]||"not-current"}updateQueryState(e,t,s){this.Kr[e]=t}removeLocalQueryTarget(e){this.Ur.ir(e)}isLocalQueryTarget(e){return this.Ur.activeTargetIds.has(e)}clearQueryState(e){delete this.Kr[e]}getAllActiveQueryTargets(){return this.Ur.activeTargetIds}isActiveQueryTarget(e){return this.Ur.activeTargetIds.has(e)}start(){return this.Ur=new Lu,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Jg{Gr(e){}shutdown(){}}class If{constructor(){this.Qr=()=>this.jr(),this.zr=()=>this.Wr(),this.Hr=[],this.Jr()}Gr(e){this.Hr.push(e)}shutdown(){window.removeEventListener("online",this.Qr),window.removeEventListener("offline",this.zr)}Jr(){window.addEventListener("online",this.Qr),window.addEventListener("offline",this.zr)}jr(){E("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Hr)e(0)}Wr(){E("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Hr)e(1)}static C(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const ey={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ty{constructor(e){this.Yr=e.Yr,this.Zr=e.Zr}Xr(e){this.eo=e}no(e){this.so=e}onMessage(e){this.io=e}close(){this.Zr()}send(e){this.Yr(e)}ro(){this.eo()}oo(e){this.so(e)}uo(e){this.io(e)}}class ny extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.co=(e.ssl?"https":"http")+"://"+e.host,this.ao="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get ho(){return!1}lo(e,t,s,r,i){const o=this.fo(e,t);E("RestConnection","Sending: ",o,s);const a={};return this._o(a,r,i),this.wo(e,o,a,s).then(l=>(E("RestConnection","Received: ",l),l),l=>{throw Kn("RestConnection",`${e} failed with error: `,l,"url: ",o,"request:",s),l})}mo(e,t,s,r,i,o){return this.lo(e,t,s,r,i)}_o(e,t,s){e["X-Goog-Api-Client"]="gl-js/ fire/"+Zs,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,i)=>e[i]=r),s&&s.headers.forEach((r,i)=>e[i]=r)}fo(e,t){return`${this.co}/v1/${t}:${ey[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}wo(e,t,s,r){return new Promise((i,o)=>{const a=new Yp;a.setWithCredentials(!0),a.listenOnce(Zp.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case $c.NO_ERROR:const h=a.getResponseJson();E("Connection","XHR received:",JSON.stringify(h)),i(h);break;case $c.TIMEOUT:E("Connection",'RPC "'+e+'" timed out'),o(new C(x.DEADLINE_EXCEEDED,"Request time out"));break;case $c.HTTP_ERROR:const f=a.getStatus();if(E("Connection",'RPC "'+e+'" failed with status:',f,"response text:",a.getResponseText()),f>0){let p=a.getResponseJson();Array.isArray(p)&&(p=p[0]);const y=p?.error;if(y&&y.status&&y.message){const v=function(I){const S=I.toLowerCase().replace(/_/g,"-");return Object.values(x).indexOf(S)>=0?S:x.UNKNOWN}(y.status);o(new C(v,y.message))}else o(new C(x.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new C(x.UNAVAILABLE,"Connection failed."));break;default:D()}}finally{E("Connection",'RPC "'+e+'" completed.')}});const l=JSON.stringify(r);a.send(t,"POST",l,s,15)})}yo(e,t,s){const r=[this.co,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Hp(),o=Qp(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new Xp({})),this._o(a.initMessageHeaders,t,s),a.encodeInitMessageHeaders=!0;const l=r.join("");E("Connection","Creating WebChannel: "+l,a);const h=i.createWebChannel(l,a);let f=!1,p=!1;const y=new ty({Yr:I=>{p?E("Connection","Not sending because WebChannel is closed:",I):(f||(E("Connection","Opening WebChannel transport."),h.open(),f=!0),E("Connection","WebChannel sending:",I),h.send(I))},Zr:()=>h.close()}),v=(I,S,P)=>{I.listen(S,J=>{try{P(J)}catch(M){setTimeout(()=>{throw M},0)}})};return v(h,ca.EventType.OPEN,()=>{p||E("Connection","WebChannel transport opened.")}),v(h,ca.EventType.CLOSE,()=>{p||(p=!0,E("Connection","WebChannel transport closed"),y.oo())}),v(h,ca.EventType.ERROR,I=>{p||(p=!0,Kn("Connection","WebChannel transport errored:",I),y.oo(new C(x.UNAVAILABLE,"The operation could not be completed")))}),v(h,ca.EventType.MESSAGE,I=>{var S;if(!p){const P=I.data[0];O(!!P);const M=P.error||(null===(S=P[0])||void 0===S?void 0:S.error);if(M){E("Connection","WebChannel received error:",M);const L=M.status;let ue=function(Y){const ke=Te[Y];if(void 0!==ke)return dd(ke)}(L),z=M.message;void 0===ue&&(ue=x.INTERNAL,z="Unknown error status: "+L+" with message "+M.message),p=!0,y.oo(new C(ue,z)),h.close()}else E("Connection","WebChannel received:",P),y.uo(P)}}),v(o,Wp.STAT_EVENT,I=>{I.stat===fh.PROXY?E("Connection","Detected buffering proxy"):I.stat===fh.NOPROXY&&E("Connection","Detected no buffering proxy")}),setTimeout(()=>{y.ro()},0),y}}function Cf(){return typeof window<"u"?window:null}function Va(){return typeof document<"u"?document:null}function Wi(n){return new Hm(n,!0)}class Ru{constructor(e,t,s=1e3,r=1.5,i=6e4){this.Ys=e,this.timerId=t,this.po=s,this.Io=r,this.To=i,this.Eo=0,this.Ao=null,this.Ro=Date.now(),this.reset()}reset(){this.Eo=0}bo(){this.Eo=this.To}vo(e){this.cancel();const t=Math.floor(this.Eo+this.Po()),s=Math.max(0,Date.now()-this.Ro),r=Math.max(0,t-s);r>0&&E("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Eo} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.Ao=this.Ys.enqueueAfterDelay(this.timerId,r,()=>(this.Ro=Date.now(),e())),this.Eo*=this.Io,this.Eo<this.po&&(this.Eo=this.po),this.Eo>this.To&&(this.Eo=this.To)}Vo(){null!==this.Ao&&(this.Ao.skipDelay(),this.Ao=null)}cancel(){null!==this.Ao&&(this.Ao.cancel(),this.Ao=null)}Po(){return(Math.random()-.5)*this.Eo}}class Ef{constructor(e,t,s,r,i,o,a,l){this.Ys=e,this.So=s,this.Do=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Co=0,this.xo=null,this.No=null,this.stream=null,this.ko=new Ru(e,t)}Oo(){return 1===this.state||5===this.state||this.Mo()}Mo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Fo()}stop(){var e=this;return(0,w.Z)(function*(){e.Oo()&&(yield e.close(0))})()}$o(){this.state=0,this.ko.reset()}Bo(){this.Mo()&&null===this.xo&&(this.xo=this.Ys.enqueueAfterDelay(this.So,6e4,()=>this.Lo()))}qo(e){this.Uo(),this.stream.send(e)}Lo(){var e=this;return(0,w.Z)(function*(){if(e.Mo())return e.close(0)})()}Uo(){this.xo&&(this.xo.cancel(),this.xo=null)}Ko(){this.No&&(this.No.cancel(),this.No=null)}close(e,t){var s=this;return(0,w.Z)(function*(){s.Uo(),s.Ko(),s.ko.cancel(),s.Co++,4!==e?s.ko.reset():t&&t.code===x.RESOURCE_EXHAUSTED?(we(t.toString()),we("Using maximum backoff delay to prevent overloading the backend."),s.ko.bo()):t&&t.code===x.UNAUTHENTICATED&&3!==s.state&&(s.authCredentialsProvider.invalidateToken(),s.appCheckCredentialsProvider.invalidateToken()),null!==s.stream&&(s.Go(),s.stream.close(),s.stream=null),s.state=e,yield s.listener.no(t)})()}Go(){}auth(){this.state=1;const e=this.Qo(this.Co),t=this.Co;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,r])=>{this.Co===t&&this.jo(s,r)},s=>{e(()=>{const r=new C(x.UNKNOWN,"Fetching auth token failed: "+s.message);return this.zo(r)})})}jo(e,t){const s=this.Qo(this.Co);this.stream=this.Wo(e,t),this.stream.Xr(()=>{s(()=>(this.state=2,this.No=this.Ys.enqueueAfterDelay(this.Do,1e4,()=>(this.Mo()&&(this.state=3),Promise.resolve())),this.listener.Xr()))}),this.stream.no(r=>{s(()=>this.zo(r))}),this.stream.onMessage(r=>{s(()=>this.onMessage(r))})}Fo(){var e=this;this.state=5,this.ko.vo((0,w.Z)(function*(){e.state=0,e.start()}))}zo(e){return E("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Qo(e){return t=>{this.Ys.enqueueAndForget(()=>this.Co===e?t():(E("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class sy extends Ef{constructor(e,t,s,r,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,o),this.Tt=i}Wo(e,t){return this.connection.yo("Listen",e,t)}onMessage(e){this.ko.reset();const t=function Wm(n,e){let t;if("targetChange"in e){const s="NO_CHANGE"===(l=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===l?1:"REMOVE"===l?2:"CURRENT"===l?3:"RESET"===l?4:D(),r=e.targetChange.targetIds||[],i=function(l,h){return l.yt?(O(void 0===h||"string"==typeof h),Ae.fromBase64String(h||"")):(O(void 0===h||h instanceof Uint8Array),Ae.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(l){const h=void 0===l.code?x.UNKNOWN:dd(l.code);return new C(h,l.message||"")}(o);t=new yd(s,r,i,a||null)}else if("documentChange"in e){const s=e.documentChange,r=It(n,s.document.name),i=ve(s.document.updateTime),o=s.document.createTime?ve(s.document.createTime):R.min(),a=new Pe({mapValue:{fields:s.document.fields}}),l=oe.newFoundDocument(r,i,o,a);t=new Ta(s.targetIds||[],s.removedTargetIds||[],l.key,l)}else if("documentDelete"in e){const s=e.documentDelete,r=It(n,s.document),i=s.readTime?ve(s.readTime):R.min(),o=oe.newNoDocument(r,i);t=new Ta([],s.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const s=e.documentRemove,r=It(n,s.document);t=new Ta([],s.removedTargetIds||[],r,null)}else{if(!("filter"in e))return D();{const s=e.filter,i=new Vm(s.count||0);t=new gd(s.targetId,i)}}var l;return t}(this.Tt,e),s=function(r){if(!("targetChange"in r))return R.min();const i=r.targetChange;return i.targetIds&&i.targetIds.length?R.min():i.readTime?ve(i.readTime):R.min()}(e);return this.listener.Ho(t,s)}Jo(e){const t={};t.database=qi(this.Tt),t.addTarget=function(r,i){let o;const a=i.target;return o=ma(a)?{documents:Sd(r,a)}:{query:du(r,a)},o.targetId=i.targetId,i.resumeToken.approximateByteSize()>0?o.resumeToken=xd(r,i.resumeToken):i.snapshotVersion.compareTo(R.min())>0&&(o.readTime=or(r,i.snapshotVersion.toTimestamp())),o}(this.Tt,e);const s=function Ym(n,e){const t=function(s,r){switch(r){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return D()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);s&&(t.labels=s),this.qo(t)}Yo(e){const t={};t.database=qi(this.Tt),t.removeTarget=e,this.qo(t)}}class ry extends Ef{constructor(e,t,s,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,o),this.Tt=i,this.Zo=!1}get Xo(){return this.Zo}start(){this.Zo=!1,this.lastStreamToken=void 0,super.start()}Go(){this.Zo&&this.tu([])}Wo(e,t){return this.connection.yo("Write",e,t)}onMessage(e){if(O(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Zo){this.ko.reset();const t=function Xm(n,e){return n&&n.length>0?(O(void 0!==e),n.map(t=>function(s,r){let i=ve(s.updateTime?s.updateTime:r);return i.isEqual(R.min())&&(i=ve(r)),new Lm(i,s.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),s=ve(e.commitTime);return this.listener.eu(s,t)}return O(!e.writeResults||0===e.writeResults.length),this.Zo=!0,this.listener.nu()}su(){const e={};e.database=qi(this.Tt),this.qo(e)}tu(e){const t={streamToken:this.lastStreamToken,writes:e.map(s=>Ui(this.Tt,s))};this.qo(t)}}class iy extends class{}{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.Tt=r,this.iu=!1}ru(){if(this.iu)throw new C(x.FAILED_PRECONDITION,"The client has already been terminated.")}lo(e,t,s){return this.ru(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.connection.lo(e,t,s,r,i)).catch(r=>{throw"FirebaseError"===r.name?(r.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new C(x.UNKNOWN,r.toString())})}mo(e,t,s,r){return this.ru(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.mo(e,t,s,i,o,r)).catch(i=>{throw"FirebaseError"===i.name?(i.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new C(x.UNKNOWN,i.toString())})}terminate(){this.iu=!0}}class ay{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.ou=0,this.uu=null,this.cu=!0}au(){0===this.ou&&(this.hu("Unknown"),this.uu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.uu=null,this.lu("Backend didn't respond within 10 seconds."),this.hu("Offline"),Promise.resolve())))}fu(e){"Online"===this.state?this.hu("Unknown"):(this.ou++,this.ou>=1&&(this.du(),this.lu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.hu("Offline")))}set(e){this.du(),this.ou=0,"Online"===e&&(this.cu=!1),this.hu(e)}hu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}lu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.cu?(we(t),this.cu=!1):E("OnlineStateTracker",t)}du(){null!==this.uu&&(this.uu.cancel(),this.uu=null)}}class cy{constructor(e,t,s,r,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this._u=[],this.wu=new Map,this.mu=new Set,this.gu=[],this.yu=i,this.yu.Gr(a=>{s.enqueueAndForget((0,w.Z)(function*(){var l;jt(o)&&(E("RemoteStore","Restarting streams for network reachability change."),yield(l=(0,w.Z)(function*(h){const f=k(h);f.mu.add(4),yield dr(f),f.pu.set("Unknown"),f.mu.delete(4),yield Xi(f)}),function(h){return l.apply(this,arguments)})(o))}))}),this.pu=new ay(s,r)}}function Xi(n){return Bu.apply(this,arguments)}function Bu(){return Bu=(0,w.Z)(function*(n){if(jt(n))for(const e of n.gu)yield e(!0)}),Bu.apply(this,arguments)}function dr(n){return qu.apply(this,arguments)}function qu(){return qu=(0,w.Z)(function*(n){for(const e of n.gu)yield e(!1)}),qu.apply(this,arguments)}function Ba(n,e){const t=k(n);t.wu.has(e.targetId)||(t.wu.set(e.targetId,e),$u(t)?ju(t):pr(t).Mo()&&Uu(t,e))}function Yi(n,e){const t=k(n),s=pr(t);t.wu.delete(e),s.Mo()&&Sf(t,e),0===t.wu.size&&(s.Mo()?s.Bo():jt(t)&&t.pu.set("Unknown"))}function Uu(n,e){n.Iu.Ft(e.targetId),pr(n).Jo(e)}function Sf(n,e){n.Iu.Ft(e),pr(n).Yo(e)}function ju(n){n.Iu=new $m({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ie:e=>n.wu.get(e)||null}),pr(n).start(),n.pu.au()}function $u(n){return jt(n)&&!pr(n).Oo()&&n.wu.size>0}function jt(n){return 0===k(n).mu.size}function Af(n){n.Iu=void 0}function uy(n){return Ku.apply(this,arguments)}function Ku(){return Ku=(0,w.Z)(function*(n){n.wu.forEach((e,t)=>{Uu(n,e)})}),Ku.apply(this,arguments)}function ly(n,e){return Gu.apply(this,arguments)}function Gu(){return Gu=(0,w.Z)(function*(n,e){Af(n),$u(n)?(n.pu.fu(e),ju(n)):n.pu.set("Unknown")}),Gu.apply(this,arguments)}function hy(n,e,t){return zu.apply(this,arguments)}function zu(){return zu=(0,w.Z)(function*(n,e,t){if(n.pu.set("Online"),e instanceof yd&&2===e.state&&e.cause)try{yield(s=(0,w.Z)(function*(r,i){const o=i.cause;for(const a of i.targetIds)r.wu.has(a)&&(yield r.remoteSyncer.rejectListen(a,o),r.wu.delete(a),r.Iu.removeTarget(a))}),function(r,i){return s.apply(this,arguments)})(n,e)}catch(s){E("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),s),yield qa(n,s)}else if(e instanceof Ta?n.Iu.Qt(e):e instanceof gd?n.Iu.Zt(e):n.Iu.Wt(e),!t.isEqual(R.min()))try{const s=yield gf(n.localStore);t.compareTo(s)>=0&&(yield function(r,i){const o=r.Iu.ee(i);return o.targetChanges.forEach((a,l)=>{if(a.resumeToken.approximateByteSize()>0){const h=r.wu.get(l);h&&r.wu.set(l,h.withResumeToken(a.resumeToken,i))}}),o.targetMismatches.forEach(a=>{const l=r.wu.get(a);if(!l)return;r.wu.set(a,l.withResumeToken(Ae.EMPTY_BYTE_STRING,l.snapshotVersion)),Sf(r,a);const h=new pn(l.target,a,1,l.sequenceNumber);Uu(r,h)}),r.remoteSyncer.applyRemoteEvent(o)}(n,t))}catch(s){E("RemoteStore","Failed to raise snapshot:",s),yield qa(n,s)}var s}),zu.apply(this,arguments)}function qa(n,e,t){return Hu.apply(this,arguments)}function Hu(){return Hu=(0,w.Z)(function*(n,e,t){if(!on(e))throw e;n.mu.add(1),yield dr(n),n.pu.set("Offline"),t||(t=()=>gf(n.localStore)),n.asyncQueue.enqueueRetryable((0,w.Z)(function*(){E("RemoteStore","Retrying IndexedDB access"),yield t(),n.mu.delete(1),yield Xi(n)}))}),Hu.apply(this,arguments)}function kf(n,e){return e().catch(t=>qa(n,t,e))}function fr(n){return Qu.apply(this,arguments)}function Qu(){return Qu=(0,w.Z)(function*(n){const e=k(n),t=wn(e);let s=e._u.length>0?e._u[e._u.length-1].batchId:-1;for(;dy(e);)try{const r=yield Wg(e.localStore,s);if(null===r){0===e._u.length&&t.Bo();break}s=r.batchId,fy(e,r)}catch(r){yield qa(e,r)}Df(e)&&Mf(e)}),Qu.apply(this,arguments)}function dy(n){return jt(n)&&n._u.length<10}function fy(n,e){n._u.push(e);const t=wn(n);t.Mo()&&t.Xo&&t.tu(e.mutations)}function Df(n){return jt(n)&&!wn(n).Oo()&&n._u.length>0}function Mf(n){wn(n).start()}function py(n){return Zu.apply(this,arguments)}function Zu(){return Zu=(0,w.Z)(function*(n){wn(n).su()}),Zu.apply(this,arguments)}function my(n){return Wu.apply(this,arguments)}function Wu(){return Wu=(0,w.Z)(function*(n){const e=wn(n);for(const t of n._u)e.tu(t.mutations)}),Wu.apply(this,arguments)}function gy(n,e,t){return Xu.apply(this,arguments)}function Xu(){return Xu=(0,w.Z)(function*(n,e,t){const s=n._u.shift(),r=mu.from(s,e,t);yield kf(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield fr(n)}),Xu.apply(this,arguments)}function yy(n,e){return Yu.apply(this,arguments)}function Yu(){return Yu=(0,w.Z)(function*(n,e){var t;e&&wn(n).Xo&&(yield(t=(0,w.Z)(function*(s,r){if(hd(i=r.code)&&i!==x.ABORTED){const o=s._u.shift();wn(s).$o(),yield kf(s,()=>s.remoteSyncer.rejectFailedWrite(o.batchId,r)),yield fr(s)}var i}),function(s,r){return t.apply(this,arguments)})(n,e)),Df(n)&&Mf(n)}),Yu.apply(this,arguments)}function Nf(n,e){return Ju.apply(this,arguments)}function Ju(){return Ju=(0,w.Z)(function*(n,e){const t=k(n);t.asyncQueue.verifyOperationInProgress(),E("RemoteStore","RemoteStore received new credentials");const s=jt(t);t.mu.add(3),yield dr(t),s&&t.pu.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.mu.delete(3),yield Xi(t)}),Ju.apply(this,arguments)}function el(n,e){return tl.apply(this,arguments)}function tl(){return tl=(0,w.Z)(function*(n,e){const t=k(n);e?(t.mu.delete(2),yield Xi(t)):e||(t.mu.add(2),yield dr(t),t.pu.set("Unknown"))}),tl.apply(this,arguments)}function pr(n){return n.Tu||(n.Tu=function(e,t,s){const r=k(e);return r.ru(),new sy(t,r.connection,r.authCredentials,r.appCheckCredentials,r.Tt,s)}(n.datastore,n.asyncQueue,{Xr:uy.bind(null,n),no:ly.bind(null,n),Ho:hy.bind(null,n)}),n.gu.push(function(){var e=(0,w.Z)(function*(t){t?(n.Tu.$o(),$u(n)?ju(n):n.pu.set("Unknown")):(yield n.Tu.stop(),Af(n))});return function(t){return e.apply(this,arguments)}}())),n.Tu}function wn(n){return n.Eu||(n.Eu=function(e,t,s){const r=k(e);return r.ru(),new ry(t,r.connection,r.authCredentials,r.appCheckCredentials,r.Tt,s)}(n.datastore,n.asyncQueue,{Xr:py.bind(null,n),no:yy.bind(null,n),nu:my.bind(null,n),eu:gy.bind(null,n)}),n.gu.push(function(){var e=(0,w.Z)(function*(t){t?(n.Eu.$o(),yield fr(n)):(yield n.Eu.stop(),n._u.length>0&&(E("RemoteStore",`Stopping write stream with ${n._u.length} pending writes`),n._u=[]))});return function(t){return e.apply(this,arguments)}}())),n.Eu}class nl{constructor(e,t,s,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new Se,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,s,r,i){const o=Date.now()+s,a=new nl(e,t,o,r,i);return a.start(s),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new C(x.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function mr(n,e){if(we("AsyncQueue",`${e}: ${n}`),on(n))return new C(x.UNAVAILABLE,`${e}: ${n}`);throw n}class gr{constructor(e){this.comparator=e?(t,s)=>e(t,s)||A.comparator(t.key,s.key):(t,s)=>A.comparator(t.key,s.key),this.keyedMap=Li(),this.sortedSet=new ye(this.comparator)}static emptySet(e){return new gr(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,s)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof gr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const s=new gr;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}class Pf{constructor(){this.Au=new ye(A.comparator)}track(e){const t=e.doc.key,s=this.Au.get(t);s?0!==e.type&&3===s.type?this.Au=this.Au.insert(t,e):3===e.type&&1!==s.type?this.Au=this.Au.insert(t,{type:s.type,doc:e.doc}):2===e.type&&2===s.type?this.Au=this.Au.insert(t,{type:2,doc:e.doc}):2===e.type&&0===s.type?this.Au=this.Au.insert(t,{type:0,doc:e.doc}):1===e.type&&0===s.type?this.Au=this.Au.remove(t):1===e.type&&2===s.type?this.Au=this.Au.insert(t,{type:1,doc:s.doc}):0===e.type&&1===s.type?this.Au=this.Au.insert(t,{type:2,doc:e.doc}):D():this.Au=this.Au.insert(t,e)}Ru(){const e=[];return this.Au.inorderTraversal((t,s)=>{e.push(s)}),e}}class yr{constructor(e,t,s,r,i,o,a,l,h){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=h}static fromInitialDocuments(e,t,s,r,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new yr(e,t,gr.emptySet(t),o,s,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Mi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}class wy{constructor(){this.bu=void 0,this.listeners=[]}}class vy{constructor(){this.queries=new dn(e=>Zh(e),Mi),this.onlineState="Unknown",this.vu=new Set}}function sl(n,e){return rl.apply(this,arguments)}function rl(){return rl=(0,w.Z)(function*(n,e){const t=k(n),s=e.query;let r=!1,i=t.queries.get(s);if(i||(r=!0,i=new wy),r)try{i.bu=yield t.onListen(s)}catch(o){const a=mr(o,`Initialization of query '${au(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.listeners.push(e),e.Pu(t.onlineState),i.bu&&e.Vu(i.bu)&&al(t)}),rl.apply(this,arguments)}function il(n,e){return ol.apply(this,arguments)}function ol(){return ol=(0,w.Z)(function*(n,e){const t=k(n),s=e.query;let r=!1;const i=t.queries.get(s);if(i){const o=i.listeners.indexOf(e);o>=0&&(i.listeners.splice(o,1),r=0===i.listeners.length)}if(r)return t.queries.delete(s),t.onUnlisten(s)}),ol.apply(this,arguments)}function by(n,e){const t=k(n);let s=!1;for(const r of e){const o=t.queries.get(r.query);if(o){for(const a of o.listeners)a.Vu(r)&&(s=!0);o.bu=r}}s&&al(t)}function xy(n,e,t){const s=k(n),r=s.queries.get(e);if(r)for(const i of r.listeners)i.onError(t);s.queries.delete(e)}function al(n){n.vu.forEach(e=>{e.next()})}class cl{constructor(e,t,s){this.query=e,this.Su=t,this.Du=!1,this.Cu=null,this.onlineState="Unknown",this.options=s||{}}Vu(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)3!==r.type&&s.push(r);e=new yr(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Du?this.xu(e)&&(this.Su.next(e),t=!0):this.Nu(e,this.onlineState)&&(this.ku(e),t=!0),this.Cu=e,t}onError(e){this.Su.error(e)}Pu(e){this.onlineState=e;let t=!1;return this.Cu&&!this.Du&&this.Nu(this.Cu,e)&&(this.ku(this.Cu),t=!0),t}Nu(e,t){return!e.fromCache||(!this.options.Ou||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}xu(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Cu&&this.Cu.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}ku(e){e=yr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Du=!0,this.Su.next(e)}}class _y{constructor(e,t){this.Mu=e,this.byteLength=t}Fu(){return"metadata"in this.Mu}}class Of{constructor(e){this.Tt=e}Zi(e){return It(this.Tt,e)}Xi(e){return e.metadata.exists?Ed(this.Tt,e.document,!1):oe.newNoDocument(this.Zi(e.metadata.name),this.tr(e.metadata.readTime))}tr(e){return ve(e)}}class Ty{constructor(e,t,s){this.$u=e,this.localStore=t,this.Tt=s,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Lf(e)}Bu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Mu.namedQuery)this.queries.push(e.Mu.namedQuery);else if(e.Mu.documentMetadata){this.documents.push({metadata:e.Mu.documentMetadata}),e.Mu.documentMetadata.exists||++t;const s=Z.fromString(e.Mu.documentMetadata.name);this.collectionGroups.add(s.get(s.length-2))}else e.Mu.document&&(this.documents[this.documents.length-1].document=e.Mu.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Lu(e){const t=new Map,s=new Of(this.Tt);for(const r of e)if(r.metadata.queries){const i=s.Zi(r.metadata.name);for(const o of r.metadata.queries){const a=(t.get(o)||$()).add(i);t.set(o,a)}}return t}complete(){var e=this;return(0,w.Z)(function*(){const t=yield function Xg(n,e,t,s){return Mu.apply(this,arguments)}(e.localStore,new Of(e.Tt),e.documents,e.$u.id),s=e.Lu(e.documents);for(const r of e.queries)yield Yg(e.localStore,r,s.get(r.name));return e.progress.taskState="Success",{progress:e.progress,qu:e.collectionGroups,Uu:t}})()}}function Lf(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class Ff{constructor(e){this.key=e}}class Rf{constructor(e){this.key=e}}class Vf{constructor(e,t){this.query=e,this.Ku=t,this.Gu=null,this.hasCachedResults=!1,this.current=!1,this.Qu=$(),this.mutatedKeys=$(),this.ju=Xh(e),this.zu=new gr(this.ju)}get Wu(){return this.Ku}Hu(e,t){const s=t?t.Ju:new Pf,r=t?t.zu:this.zu;let i=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1;const l="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,h="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((f,p)=>{const y=r.get(f),v=Ni(this.query,p)?p:null,I=!!y&&this.mutatedKeys.has(y.key),S=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let P=!1;y&&v?y.data.isEqual(v.data)?I!==S&&(s.track({type:3,doc:v}),P=!0):this.Yu(y,v)||(s.track({type:2,doc:v}),P=!0,(l&&this.ju(v,l)>0||h&&this.ju(v,h)<0)&&(a=!0)):!y&&v?(s.track({type:0,doc:v}),P=!0):y&&!v&&(s.track({type:1,doc:y}),P=!0,(l||h)&&(a=!0)),P&&(v?(o=o.add(v),i=S?i.add(f):i.delete(f)):(o=o.delete(f),i=i.delete(f)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const f="F"===this.query.limitType?o.last():o.first();o=o.delete(f.key),i=i.delete(f.key),s.track({type:1,doc:f})}return{zu:o,Ju:s,Li:a,mutatedKeys:i}}Yu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s){const r=this.zu;this.zu=e.zu,this.mutatedKeys=e.mutatedKeys;const i=e.Ju.Ru();i.sort((h,f)=>function(p,y){const v=I=>{switch(I){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return D()}};return v(p)-v(y)}(h.type,f.type)||this.ju(h.doc,f.doc)),this.Zu(s);const o=t?this.Xu():[],a=0===this.Qu.size&&this.current?1:0,l=a!==this.Gu;return this.Gu=a,0!==i.length||l?{snapshot:new yr(this.query,e.zu,r,i,e.mutatedKeys,0===a,l,!1,!!s&&s.resumeToken.approximateByteSize()>0),tc:o}:{tc:o}}Pu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({zu:this.zu,Ju:new Pf,mutatedKeys:this.mutatedKeys,Li:!1},!1)):{tc:[]}}ec(e){return!this.Ku.has(e)&&!!this.zu.has(e)&&!this.zu.get(e).hasLocalMutations}Zu(e){e&&(e.addedDocuments.forEach(t=>this.Ku=this.Ku.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ku=this.Ku.delete(t)),this.current=e.current)}Xu(){if(!this.current)return[];const e=this.Qu;this.Qu=$(),this.zu.forEach(s=>{this.ec(s.key)&&(this.Qu=this.Qu.add(s.key))});const t=[];return e.forEach(s=>{this.Qu.has(s)||t.push(new Rf(s))}),this.Qu.forEach(s=>{e.has(s)||t.push(new Ff(s))}),t}nc(e){this.Ku=e.Yi,this.Qu=$();const t=this.Hu(e.documents);return this.applyChanges(t,!0)}sc(){return yr.fromInitialDocuments(this.query,this.zu,this.mutatedKeys,0===this.Gu,this.hasCachedResults)}}class Iy{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class Cy{constructor(e){this.key=e,this.ic=!1}}class Ey{constructor(e,t,s,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.rc={},this.oc=new dn(a=>Zh(a),Mi),this.uc=new Map,this.cc=new Set,this.ac=new ye(A.comparator),this.hc=new Map,this.lc=new Iu,this.fc={},this.dc=new Map,this._c=os.Sn(),this.onlineState="Unknown",this.wc=void 0}get isPrimaryClient(){return!0===this.wc}}function Sy(n,e){return ul.apply(this,arguments)}function ul(){return ul=(0,w.Z)(function*(n,e){const t=Nl(n);let s,r;const i=t.oc.get(e);if(i)s=i.targetId,t.sharedClientState.addLocalQueryTarget(s),r=i.view.sc();else{const o=yield lr(t.localStore,Ze(e));t.isPrimaryClient&&Ba(t.remoteStore,o);const a=t.sharedClientState.addLocalQueryTarget(o.targetId);s=o.targetId,r=yield ll(t,e,s,"current"===a,o.resumeToken)}return r}),ul.apply(this,arguments)}function ll(n,e,t,s,r){return hl.apply(this,arguments)}function hl(){return hl=(0,w.Z)(function*(n,e,t,s,r){n.mc=(p,y,v)=>{return(I=(0,w.Z)(function*(S,P,J,M){let L=P.view.Hu(J);L.Li&&(L=yield La(S.localStore,P.query,!1).then(({documents:Y})=>P.view.Hu(Y,L)));const ue=M&&M.targetChanges.get(P.targetId),z=P.view.applyChanges(L,S.isPrimaryClient,ue);return xl(S,P.targetId,z.tc),z.snapshot}),function(S,P,J,M){return I.apply(this,arguments)})(n,p,y,v);var I};const i=yield La(n.localStore,e,!0),o=new Vf(e,i.Yi),a=o.Hu(i.documents),l=Vi.createSynthesizedTargetChangeForCurrentChange(t,s&&"Offline"!==n.onlineState,r),h=o.applyChanges(a,n.isPrimaryClient,l);xl(n,t,h.tc);const f=new Iy(e,t,o);return n.oc.set(e,f),n.uc.has(t)?n.uc.get(t).push(e):n.uc.set(t,[e]),h.snapshot}),hl.apply(this,arguments)}function Ay(n,e){return dl.apply(this,arguments)}function dl(){return dl=(0,w.Z)(function*(n,e){const t=k(n),s=t.oc.get(e),r=t.uc.get(s.targetId);if(r.length>1)return t.uc.set(s.targetId,r.filter(i=>!Mi(i,e))),void t.oc.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(s.targetId),t.sharedClientState.isActiveQueryTarget(s.targetId)||(yield hr(t.localStore,s.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(s.targetId),Yi(t.remoteStore,s.targetId),wr(t,s.targetId)}).catch(rn))):(wr(t,s.targetId),yield hr(t.localStore,s.targetId,!0))}),dl.apply(this,arguments)}function fl(){return fl=(0,w.Z)(function*(n,e,t){const s=Pl(n);try{const r=yield function(i,o){const a=k(i),l=he.now(),h=o.reduce((y,v)=>y.add(v.key),$());let f,p;return a.persistence.runTransaction("Locally write mutations","readwrite",y=>{let v=nt(),I=$();return a.ji.getEntries(y,h).next(S=>{v=S,v.forEach((P,J)=>{J.isValidDocument()||(I=I.add(P))})}).next(()=>a.localDocuments.getOverlayedDocuments(y,v)).next(S=>{f=S;const P=[];for(const J of o){const M=Rm(J,f.get(J.key).overlayedDocument);null!=M&&P.push(new Ut(J.key,M,Kh(M.value.mapValue),de.exists(!0)))}return a.mutationQueue.addMutationBatch(y,l,P,o)}).next(S=>{p=S;const P=S.applyToLocalDocumentSet(f,I);return a.documentOverlayCache.saveOverlays(y,S.batchId,P)})}).then(()=>({batchId:p.batchId,changes:pd(f)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),function(i,o,a){let l=i.fc[i.currentUser.toKey()];l||(l=new ye(U)),l=l.insert(o,a),i.fc[i.currentUser.toKey()]=l}(s,r.batchId,t),yield $t(s,r.changes),yield fr(s.remoteStore)}catch(r){const i=mr(r,"Failed to persist write");t.reject(i)}}),fl.apply(this,arguments)}function Bf(n,e){return pl.apply(this,arguments)}function pl(){return pl=(0,w.Z)(function*(n,e){const t=k(n);try{const s=yield function Zg(n,e){const t=k(n),s=e.snapshotVersion;let r=t.Ki;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.ji.newChangeBuffer({trackRemovals:!0});r=t.Ki;const a=[];e.targetChanges.forEach((f,p)=>{const y=r.get(p);if(!y)return;a.push(t.Ns.removeMatchingKeys(i,f.removedDocuments,p).next(()=>t.Ns.addMatchingKeys(i,f.addedDocuments,p)));let v=y.withSequenceNumber(i.currentSequenceNumber);var I,S,P;e.targetMismatches.has(p)?v=v.withResumeToken(Ae.EMPTY_BYTE_STRING,R.min()).withLastLimboFreeSnapshotVersion(R.min()):f.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(f.resumeToken,s)),r=r.insert(p,v),S=v,P=f,(0===(I=y).resumeToken.approximateByteSize()||S.snapshotVersion.toMicroseconds()-I.snapshotVersion.toMicroseconds()>=3e8||P.addedDocuments.size+P.modifiedDocuments.size+P.removedDocuments.size>0)&&a.push(t.Ns.updateTargetData(i,v))});let l=nt(),h=$();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,f))}),a.push(yf(i,o,e.documentUpdates).next(f=>{l=f.Hi,h=f.Ji})),!s.isEqual(R.min())){const f=t.Ns.getLastRemoteSnapshotVersion(i).next(p=>t.Ns.setTargetsMetadata(i,i.currentSequenceNumber,s));a.push(f)}return b.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,h)).next(()=>l)}).then(i=>(t.Ki=r,i))}(t.localStore,e);e.targetChanges.forEach((r,i)=>{const o=t.hc.get(i);o&&(O(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.ic=!0:r.modifiedDocuments.size>0?O(o.ic):r.removedDocuments.size>0&&(O(o.ic),o.ic=!1))}),yield $t(t,s,e)}catch(s){yield rn(s)}}),pl.apply(this,arguments)}function qf(n,e,t){const s=k(n);if(s.isPrimaryClient&&0===t||!s.isPrimaryClient&&1===t){const r=[];s.oc.forEach((i,o)=>{const a=o.view.Pu(e);a.snapshot&&r.push(a.snapshot)}),function(i,o){const a=k(i);a.onlineState=o;let l=!1;a.queries.forEach((h,f)=>{for(const p of f.listeners)p.Pu(o)&&(l=!0)}),l&&al(a)}(s.eventManager,e),r.length&&s.rc.Ho(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}function Dy(n,e,t){return ml.apply(this,arguments)}function ml(){return ml=(0,w.Z)(function*(n,e,t){const s=k(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.hc.get(e),i=r&&r.key;if(i){let o=new ye(A.comparator);o=o.insert(i,oe.newNoDocument(i,R.min()));const a=$().add(i),l=new Ri(R.min(),new Map,new ne(U),o,a);yield Bf(s,l),s.ac=s.ac.remove(i),s.hc.delete(e),_l(s)}else yield hr(s.localStore,e,!1).then(()=>wr(s,e,t)).catch(rn)}),ml.apply(this,arguments)}function My(n,e){return gl.apply(this,arguments)}function gl(){return gl=(0,w.Z)(function*(n,e){const t=k(n),s=e.batch.batchId;try{const r=yield function Qg(n,e){const t=k(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const r=e.batch.keys(),i=t.ji.newChangeBuffer({trackRemovals:!0});return function(o,a,l,h){const f=l.batch,p=f.keys();let y=b.resolve();return p.forEach(v=>{y=y.next(()=>h.getEntry(a,v)).next(I=>{const S=l.docVersions.get(v);O(null!==S),I.version.compareTo(S)<0&&(f.applyToRemoteDocument(I,l),I.isValidDocument()&&(I.setReadTime(l.commitVersion),h.addEntry(I)))})}),y.next(()=>o.mutationQueue.removeMutationBatch(a,f))}(t,s,e,i).next(()=>i.apply(s)).next(()=>t.mutationQueue.performConsistencyCheck(s)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(o){let a=$();for(let l=0;l<o.mutationResults.length;++l)o.mutationResults[l].transformResults.length>0&&(a=a.add(o.batch.mutations[l].key));return a}(e))).next(()=>t.localDocuments.getDocuments(s,r))})}(t.localStore,e);bl(t,s,null),vl(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),yield $t(t,r)}catch(r){yield rn(r)}}),gl.apply(this,arguments)}function Ny(n,e,t){return yl.apply(this,arguments)}function yl(){return yl=(0,w.Z)(function*(n,e,t){const s=k(n);try{const r=yield function(i,o){const a=k(i);return a.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let h;return a.mutationQueue.lookupMutationBatch(l,o).next(f=>(O(null!==f),h=f.keys(),a.mutationQueue.removeMutationBatch(l,f))).next(()=>a.mutationQueue.performConsistencyCheck(l)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(l,h,o)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,h)).next(()=>a.localDocuments.getDocuments(l,h))})}(s.localStore,e);bl(s,e,t),vl(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),yield $t(s,r)}catch(r){yield rn(r)}}),yl.apply(this,arguments)}function wl(){return wl=(0,w.Z)(function*(n,e){const t=k(n);jt(t.remoteStore)||E("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const s=yield function(i){const o=k(i);return o.persistence.runTransaction("Get highest unacknowledged batch id","readonly",a=>o.mutationQueue.getHighestUnacknowledgedBatchId(a))}(t.localStore);if(-1===s)return void e.resolve();const r=t.dc.get(s)||[];r.push(e),t.dc.set(s,r)}catch(s){const r=mr(s,"Initialization of waitForPendingWrites() operation failed");e.reject(r)}}),wl.apply(this,arguments)}function vl(n,e){(n.dc.get(e)||[]).forEach(t=>{t.resolve()}),n.dc.delete(e)}function bl(n,e,t){const s=k(n);let r=s.fc[s.currentUser.toKey()];if(r){const i=r.get(e);i&&(t?i.reject(t):i.resolve(),r=r.remove(e)),s.fc[s.currentUser.toKey()]=r}}function wr(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.uc.get(e))n.oc.delete(s),t&&n.rc.gc(s,t);n.uc.delete(e),n.isPrimaryClient&&n.lc.ds(e).forEach(s=>{n.lc.containsKey(s)||Uf(n,s)})}function Uf(n,e){n.cc.delete(e.path.canonicalString());const t=n.ac.get(e);null!==t&&(Yi(n.remoteStore,t),n.ac=n.ac.remove(e),n.hc.delete(t),_l(n))}function xl(n,e,t){for(const s of t)s instanceof Ff?(n.lc.addReference(s.key,e),Oy(n,s)):s instanceof Rf?(E("SyncEngine","Document no longer in limbo: "+s.key),n.lc.removeReference(s.key,e),n.lc.containsKey(s.key)||Uf(n,s.key)):D()}function Oy(n,e){const t=e.key,s=t.path.canonicalString();n.ac.get(t)||n.cc.has(s)||(E("SyncEngine","New document in limbo: "+t),n.cc.add(s),_l(n))}function _l(n){for(;n.cc.size>0&&n.ac.size<n.maxConcurrentLimboResolutions;){const e=n.cc.values().next().value;n.cc.delete(e);const t=new A(Z.fromString(e)),s=n._c.next();n.hc.set(s,new Cy(t)),n.ac=n.ac.insert(t,s),Ba(n.remoteStore,new pn(Ze(tr(t.path)),s,2,at.at))}}function $t(n,e,t){return Tl.apply(this,arguments)}function Tl(){return Tl=(0,w.Z)(function*(n,e,t){const s=k(n),r=[],i=[],o=[];var a;s.oc.isEmpty()||(s.oc.forEach((a,l)=>{o.push(s.mc(l,e,t).then(h=>{if((h||t)&&s.isPrimaryClient&&s.sharedClientState.updateQueryState(l.targetId,h?.fromCache?"not-current":"current"),h){r.push(h);const f=Au.Ni(l.targetId,h);i.push(f)}}))}),yield Promise.all(o),s.rc.Ho(r),yield(a=(0,w.Z)(function*(l,h){const f=k(l);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>b.forEach(h,y=>b.forEach(y.Ci,v=>f.persistence.referenceDelegate.addReference(p,y.targetId,v)).next(()=>b.forEach(y.xi,v=>f.persistence.referenceDelegate.removeReference(p,y.targetId,v)))))}catch(p){if(!on(p))throw p;E("LocalStore","Failed to update sequence numbers: "+p)}for(const p of h){const y=p.targetId;if(!p.fromCache){const v=f.Ki.get(y),S=v.withLastLimboFreeSnapshotVersion(v.snapshotVersion);f.Ki=f.Ki.insert(y,S)}}}),function(l,h){return a.apply(this,arguments)})(s.localStore,i))}),Tl.apply(this,arguments)}function Ly(n,e){return Il.apply(this,arguments)}function Il(){return Il=(0,w.Z)(function*(n,e){const t=k(n);if(!t.currentUser.isEqual(e)){E("SyncEngine","User change. New user:",e.toKey());const s=yield mf(t.localStore,e);t.currentUser=e,(r=t).dc.forEach(o=>{o.forEach(a=>{a.reject(new C(x.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),r.dc.clear(),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),yield $t(t,s.Wi)}var r}),Il.apply(this,arguments)}function Fy(n,e){const t=k(n),s=t.hc.get(e);if(s&&s.ic)return $().add(s.key);{let r=$();const i=t.uc.get(e);if(!i)return r;for(const o of i){const a=t.oc.get(o);r=r.unionWith(a.view.Wu)}return r}}function Ry(n,e){return Cl.apply(this,arguments)}function Cl(){return Cl=(0,w.Z)(function*(n,e){const t=k(n),s=yield La(t.localStore,e.query,!0),r=e.view.nc(s);return t.isPrimaryClient&&xl(t,e.targetId,r.tc),r}),Cl.apply(this,arguments)}function Vy(n,e){return El.apply(this,arguments)}function El(){return El=(0,w.Z)(function*(n,e){const t=k(n);return vf(t.localStore,e).then(s=>$t(t,s))}),El.apply(this,arguments)}function By(n,e,t,s){return Sl.apply(this,arguments)}function Sl(){return Sl=(0,w.Z)(function*(n,e,t,s){const r=k(n),i=yield function(o,a){const l=k(o),h=k(l.mutationQueue);return l.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.An(f,a).next(p=>p?l.localDocuments.getDocuments(f,p):b.resolve(null)))}(r.localStore,e);var a;null!==i?("pending"===t?yield fr(r.remoteStore):"acknowledged"===t||"rejected"===t?(bl(r,e,s||null),vl(r,e),a=e,k(k(r.localStore).mutationQueue).bn(a)):D(),yield $t(r,i)):E("SyncEngine","Cannot apply mutation batch with id: "+e)}),Sl.apply(this,arguments)}function Al(){return Al=(0,w.Z)(function*(n,e){const t=k(n);if(Nl(t),Pl(t),!0===e&&!0!==t.wc){const s=t.sharedClientState.getAllActiveQueryTargets(),r=yield jf(t,s.toArray());t.wc=!0,yield el(t.remoteStore,!0);for(const i of r)Ba(t.remoteStore,i)}else if(!1===e&&!1!==t.wc){const s=[];let r=Promise.resolve();t.uc.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?s.push(o):r=r.then(()=>(wr(t,o),hr(t.localStore,o,!0))),Yi(t.remoteStore,o)}),yield r,yield jf(t,s),function(i){const o=k(i);o.hc.forEach((a,l)=>{Yi(o.remoteStore,l)}),o.lc._s(),o.hc=new Map,o.ac=new ye(A.comparator)}(t),t.wc=!1,yield el(t.remoteStore,!1)}}),Al.apply(this,arguments)}function jf(n,e,t){return kl.apply(this,arguments)}function kl(){return kl=(0,w.Z)(function*(n,e,t){const s=k(n),r=[],i=[];for(const o of e){let a;const l=s.uc.get(o);if(l&&0!==l.length){a=yield lr(s.localStore,Ze(l[0]));for(const h of l){const f=s.oc.get(h),p=yield Ry(s,f);p.snapshot&&i.push(p.snapshot)}}else{const h=yield wf(s.localStore,o);a=yield lr(s.localStore,h),yield ll(s,$f(h),o,!1,a.resumeToken)}r.push(a)}return s.rc.Ho(i),r}),kl.apply(this,arguments)}function $f(n){return Hh(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Uy(n){const e=k(n);return k(k(e.localStore).persistence).Si()}function jy(n,e,t,s){return Dl.apply(this,arguments)}function Dl(){return Dl=(0,w.Z)(function*(n,e,t,s){const r=k(n);if(r.wc)return void E("SyncEngine","Ignoring unexpected query state notification.");const i=r.uc.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=yield vf(r.localStore,Wh(i[0])),a=Ri.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,Ae.EMPTY_BYTE_STRING);yield $t(r,o,a);break}case"rejected":yield hr(r.localStore,e,!0),wr(r,e,s);break;default:D()}}),Dl.apply(this,arguments)}function $y(n,e,t){return Ml.apply(this,arguments)}function Ml(){return Ml=(0,w.Z)(function*(n,e,t){const s=Nl(n);if(s.wc){for(const r of e){if(s.uc.has(r)){E("SyncEngine","Adding an already active target "+r);continue}const i=yield wf(s.localStore,r),o=yield lr(s.localStore,i);yield ll(s,$f(i),o.targetId,!1,o.resumeToken),Ba(s.remoteStore,o)}for(const r of t)s.uc.has(r)&&(yield hr(s.localStore,r,!1).then(()=>{Yi(s.remoteStore,r),wr(s,r)}).catch(rn))}}),Ml.apply(this,arguments)}function Nl(n){const e=k(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Bf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Fy.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Dy.bind(null,e),e.rc.Ho=by.bind(null,e.eventManager),e.rc.gc=xy.bind(null,e.eventManager),e}function Pl(n){const e=k(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=My.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ny.bind(null,e),e}class Kf{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,w.Z)(function*(){t.Tt=Wi(e.databaseInfo.databaseId),t.sharedClientState=t.Ic(e),t.persistence=t.Tc(e),yield t.persistence.start(),t.localStore=t.Ec(e),t.gcScheduler=t.Ac(e,t.localStore),t.indexBackfillerScheduler=t.Rc(e,t.localStore)})()}Ac(e,t){return null}Rc(e,t){return null}Ec(e){return pf(this.persistence,new ff,e.initialUser,this.Tt)}Tc(e){return new hf(Pa.qs,this.Tt)}Ic(e){return new Tf}terminate(){var e=this;return(0,w.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Gf extends Kf{constructor(e,t,s){super(),this.bc=e,this.cacheSizeBytes=t,this.forceOwnership=s,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,s=this;return(0,w.Z)(function*(){yield t().call(s,e),yield s.bc.initialize(s,e),yield Pl(s.bc.syncEngine),yield fr(s.bc.remoteStore),yield s.persistence.di(()=>(s.gcScheduler&&!s.gcScheduler.started&&s.gcScheduler.start(),s.indexBackfillerScheduler&&!s.indexBackfillerScheduler.started&&s.indexBackfillerScheduler.start(),Promise.resolve()))})()}Ec(e){return pf(this.persistence,new ff,e.initialUser,this.Tt)}Ac(e,t){return new Pg(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Rc(e,t){const s=new pm(t,this.persistence);return new fm(e.asyncQueue,s)}Tc(e){const t=Su(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),s=void 0!==this.cacheSizeBytes?st.withCacheSize(this.cacheSizeBytes):st.DEFAULT;return new Eu(this.synchronizeTabs,t,e.clientId,s,e.asyncQueue,Cf(),Va(),this.Tt,this.sharedClientState,!!this.forceOwnership)}Ic(e){return new Tf}}class Gy extends Gf{constructor(e,t){super(e,t,!1),this.bc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,s=this;return(0,w.Z)(function*(){yield t().call(s,e);const r=s.bc.syncEngine;s.sharedClientState instanceof Fu&&(s.sharedClientState.syncEngine={Br:By.bind(null,r),Lr:jy.bind(null,r),qr:$y.bind(null,r),Si:Uy.bind(null,r),$r:Vy.bind(null,r)},yield s.sharedClientState.start()),yield s.persistence.di(function(){var i=(0,w.Z)(function*(o){yield function qy(n,e){return Al.apply(this,arguments)}(s.bc.syncEngine,o),s.gcScheduler&&(o&&!s.gcScheduler.started?s.gcScheduler.start():o||s.gcScheduler.stop()),s.indexBackfillerScheduler&&(o&&!s.indexBackfillerScheduler.started?s.indexBackfillerScheduler.start():o||s.indexBackfillerScheduler.stop())});return function(o){return i.apply(this,arguments)}}())})()}Ic(e){const t=Cf();if(!Fu.C(t))throw new C(x.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const s=Su(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Fu(t,e.asyncQueue,s,e.clientId,e.initialUser)}}class Ol{initialize(e,t){var s=this;return(0,w.Z)(function*(){s.localStore||(s.localStore=e.localStore,s.sharedClientState=e.sharedClientState,s.datastore=s.createDatastore(t),s.remoteStore=s.createRemoteStore(t),s.eventManager=s.createEventManager(t),s.syncEngine=s.createSyncEngine(t,!e.synchronizeTabs),s.sharedClientState.onlineStateHandler=r=>qf(s.syncEngine,r,1),s.remoteStore.remoteSyncer.handleCredentialChange=Ly.bind(null,s.syncEngine),yield el(s.remoteStore,s.syncEngine.isPrimaryClient))})()}createEventManager(e){return new vy}createDatastore(e){const t=Wi(e.databaseInfo.databaseId),s=new ny(e.databaseInfo);return new iy(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return t=this.localStore,s=this.datastore,r=e.asyncQueue,i=a=>qf(this.syncEngine,a,0),o=If.C()?new If:new Jg,new cy(t,s,r,i,o);var t,s,r,i,o}createSyncEngine(e,t){return function(s,r,i,o,a,l,h){const f=new Ey(s,r,i,o,a,l);return h&&(f.wc=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,w.Z)(function*(t){const s=k(t);E("RemoteStore","RemoteStore shutting down."),s.mu.add(5),yield dr(s),s.yu.shutdown(),s.pu.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function zf(n,e=10240){let t=0;return{read:()=>(0,w.Z)(function*(){if(t<n.byteLength){const s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})(),cancel:()=>(0,w.Z)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class Ua{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.vc(this.observer.next,e)}error(e){this.observer.error?this.vc(this.observer.error,e):we("Uncaught Error in snapshot listener:",e.toString())}Pc(){this.muted=!0}vc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class zy{constructor(e,t){this.Vc=e,this.Tt=t,this.metadata=new Se,this.buffer=new Uint8Array,this.Sc=new TextDecoder("utf-8"),this.Dc().then(s=>{s&&s.Fu()?this.metadata.resolve(s.Mu.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(s?.Mu)}`))},s=>this.metadata.reject(s))}close(){return this.Vc.cancel()}getMetadata(){var e=this;return(0,w.Z)(function*(){return e.metadata.promise})()}yc(){var e=this;return(0,w.Z)(function*(){return yield e.getMetadata(),e.Dc()})()}Dc(){var e=this;return(0,w.Z)(function*(){const t=yield e.Cc();if(null===t)return null;const s=e.Sc.decode(t),r=Number(s);isNaN(r)&&e.xc(`length string (${s}) is not valid number`);const i=yield e.Nc(r);return new _y(JSON.parse(i),t.length+r)})()}kc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}Cc(){var e=this;return(0,w.Z)(function*(){for(;e.kc()<0&&!(yield e.Oc()););if(0===e.buffer.length)return null;const t=e.kc();t<0&&e.xc("Reached the end of bundle when a length string is expected.");const s=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),s})()}Nc(e){var t=this;return(0,w.Z)(function*(){for(;t.buffer.length<e;)(yield t.Oc())&&t.xc("Reached the end of bundle when more is expected.");const s=t.Sc.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),s})()}xc(e){throw this.Vc.cancel(),new Error(`Invalid bundle format: ${e}`)}Oc(){var e=this;return(0,w.Z)(function*(){const t=yield e.Vc.read();if(!t.done){const s=new Uint8Array(e.buffer.length+t.value.length);s.set(e.buffer),s.set(t.value,e.buffer.length),e.buffer=s}return t.done})()}}class Hy{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,w.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new C(x.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const s=yield(r=(0,w.Z)(function*(i,o){const a=k(i),l=qi(a.Tt)+"/documents",h={documents:o.map(v=>Bi(a.Tt,v))},f=yield a.mo("BatchGetDocuments",l,h,o.length),p=new Map;f.forEach(v=>{const I=function Zm(n,e){return"found"in e?function(t,s){O(!!s.found);const r=It(t,s.found.name),i=ve(s.found.updateTime),o=s.found.createTime?ve(s.found.createTime):R.min(),a=new Pe({mapValue:{fields:s.found.fields}});return oe.newFoundDocument(r,i,o,a)}(n,e):"missing"in e?function(t,s){O(!!s.missing),O(!!s.readTime);const r=It(t,s.missing),i=ve(s.readTime);return oe.newNoDocument(r,i)}(n,e):D()}(a.Tt,v);p.set(I.key.toString(),I)});const y=[];return o.forEach(v=>{const I=p.get(v.toString());O(!!I),y.push(I)}),y}),function(i,o){return r.apply(this,arguments)})(t.datastore,e);var r;return s.forEach(r=>t.recordVersion(r)),s})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(s){this.lastWriteError=s}this.writtenDocs.add(e.toString())}delete(e){this.write(new ir(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,w.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var s;e.mutations.forEach(s=>{t.delete(s.key.toString())}),t.forEach((s,r)=>{const i=A.fromPath(r);e.mutations.push(new cu(i,e.precondition(i)))}),yield(s=(0,w.Z)(function*(r,i){const o=k(r),a=qi(o.Tt)+"/documents",l={writes:i.map(h=>Ui(o.Tt,h))};yield o.lo("Commit",a,l)}),function(r,i){return s.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw D();t=R.min()}const s=this.readVersions.get(e.key.toString());if(s){if(!t.isEqual(s))throw new C(x.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(R.min())?de.exists(!1):de.updateTime(t):de.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(R.min()))throw new C(x.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return de.updateTime(t)}return de.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Qy{constructor(e,t,s,r,i){this.asyncQueue=e,this.datastore=t,this.options=s,this.updateFunction=r,this.deferred=i,this.Mc=s.maxAttempts,this.ko=new Ru(this.asyncQueue,"transaction_retry")}run(){this.Mc-=1,this.Fc()}Fc(){var e=this;this.ko.vo((0,w.Z)(function*(){const t=new Hy(e.datastore),s=e.$c(t);s&&s.then(r=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(r)}).catch(i=>{e.Bc(i)}))}).catch(r=>{e.Bc(r)})}))}$c(e){try{const t=this.updateFunction(e);return!Ii(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Bc(e){this.Mc>0&&this.Lc(e)?(this.Mc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Fc(),Promise.resolve()))):this.deferred.reject(e)}Lc(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!hd(t)}return!1}}class Zy{constructor(e,t,s,r){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=r,this.user=Ne.UNAUTHENTICATED,this.clientId=yh.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(s,function(){var o=(0,w.Z)(function*(a){E("FirestoreClient","Received user=",a.uid),yield i.authCredentialListener(a),i.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(s,o=>(E("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}getConfiguration(){var e=this;return(0,w.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new C(x.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Se;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,w.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(s){const r=mr(s,"Failed to shutdown persistence");t.reject(r)}})),t.promise}}function Hf(n,e){return Ll.apply(this,arguments)}function Ll(){return Ll=(0,w.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),E("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener(function(){var r=(0,w.Z)(function*(i){s.isEqual(i)||(yield mf(e.localStore,i),s=i)});return function(i){return r.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}),Ll.apply(this,arguments)}function Qf(n,e){return Fl.apply(this,arguments)}function Fl(){return Fl=(0,w.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield Rl(n);E("FirestoreClient","Initializing OnlineComponentProvider");const s=yield n.getConfiguration();yield e.initialize(t,s),n.setCredentialChangeListener(r=>Nf(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Nf(e.remoteStore,i)),n.onlineComponents=e}),Fl.apply(this,arguments)}function Rl(n){return Vl.apply(this,arguments)}function Vl(){return Vl=(0,w.Z)(function*(n){return n.offlineComponents||(E("FirestoreClient","Using default OfflineComponentProvider"),yield Hf(n,new Kf)),n.offlineComponents}),Vl.apply(this,arguments)}function ja(n){return Bl.apply(this,arguments)}function Bl(){return Bl=(0,w.Z)(function*(n){return n.onlineComponents||(E("FirestoreClient","Using default OnlineComponentProvider"),yield Qf(n,new Ol)),n.onlineComponents}),Bl.apply(this,arguments)}function Zf(n){return Rl(n).then(e=>e.persistence)}function $a(n){return Rl(n).then(e=>e.localStore)}function ql(n){return ja(n).then(e=>e.remoteStore)}function Ul(n){return ja(n).then(e=>e.syncEngine)}function vr(n){return jl.apply(this,arguments)}function jl(){return jl=(0,w.Z)(function*(n){const e=yield ja(n),t=e.eventManager;return t.onListen=Sy.bind(null,e.syncEngine),t.onUnlisten=Ay.bind(null,e.syncEngine),t}),jl.apply(this,arguments)}function Xf(n,e,t={}){const s=new Se;return n.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return function(r,i,o,a,l){const h=new Ua({next:p=>{i.enqueueAndForget(()=>il(r,f));const y=p.docs.has(o);!y&&p.fromCache?l.reject(new C(x.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&p.fromCache&&a&&"server"===a.source?l.reject(new C(x.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(p)},error:p=>l.reject(p)}),f=new cl(tr(o.path),h,{includeMetadataChanges:!0,Ou:!0});return sl(r,f)}(yield vr(n),n.asyncQueue,e,t,s)})),s.promise}function Yf(n,e,t={}){const s=new Se;return n.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return function(r,i,o,a,l){const h=new Ua({next:p=>{i.enqueueAndForget(()=>il(r,f)),p.fromCache&&"server"===a.source?l.reject(new C(x.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(p)},error:p=>l.reject(p)}),f=new cl(o,h,{includeMetadataChanges:!0,Ou:!0});return sl(r,f)}(yield vr(n),n.asyncQueue,e,t,s)})),s.promise}const Jf=new Map;function $l(n,e,t){if(!t)throw new C(x.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function ep(n,e,t,s){if(!0===e&&!0===s)throw new C(x.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function tp(n){if(!A.isDocumentKey(n))throw new C(x.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function np(n){if(A.isDocumentKey(n))throw new C(x.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Ka(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":D()}function Q(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new C(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ka(n);throw new C(x.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function sp(n,e){if(e<=0)throw new C(x.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class rp{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new C(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new C(x.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,ep("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ji{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new rp({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new C(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new C(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new rp(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new tm;switch(t.type){case"gapi":return new im(t.client,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new C(x.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Jf.get(e);t&&(E("ComponentProvider","Removing Datastore"),Jf.delete(e),t.terminate())}(this),Promise.resolve()}}class ae{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Et(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ae(this.firestore,e,this._key)}}class Ue{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new Ue(this.firestore,e,this._query)}}class Et extends Ue{constructor(e,t,s){super(e,t,tr(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ae(this.firestore,null,new A(e))}withConverter(e){return new Et(this.firestore,e,this._path)}}function op(n,e,...t){if(n=(0,q.m9)(n),$l("collection","path",e),n instanceof Ji){const s=Z.fromString(e,...t);return np(s),new Et(n,null,s)}{if(!(n instanceof ae||n instanceof Et))throw new C(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Z.fromString(e,...t));return np(s),new Et(n.firestore,null,s)}}function Ga(n,e,...t){if(n=(0,q.m9)(n),1===arguments.length&&(e=yh.R()),$l("doc","path",e),n instanceof Ji){const s=Z.fromString(e,...t);return tp(s),new ae(n,null,new A(s))}{if(!(n instanceof ae||n instanceof Et))throw new C(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(Z.fromString(e,...t));return tp(s),new ae(n.firestore,n instanceof Et?n.converter:null,new A(s))}}function ap(n,e){return n=(0,q.m9)(n),e=(0,q.m9)(e),(n instanceof ae||n instanceof Et)&&(e instanceof ae||e instanceof Et)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Kl(n,e){return n=(0,q.m9)(n),e=(0,q.m9)(e),n instanceof Ue&&e instanceof Ue&&n.firestore===e.firestore&&Mi(n._query,e._query)&&n.converter===e.converter}class rw{constructor(){this.qc=Promise.resolve(),this.Uc=[],this.Kc=!1,this.Gc=[],this.Qc=null,this.jc=!1,this.zc=!1,this.Wc=[],this.ko=new Ru(this,"async_queue_retry"),this.Hc=()=>{const t=Va();t&&E("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ko.Vo()};const e=Va();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Hc)}get isShuttingDown(){return this.Kc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Jc(),this.Yc(e)}enterRestrictedMode(e){if(!this.Kc){this.Kc=!0,this.zc=e||!1;const t=Va();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Hc)}}enqueue(e){if(this.Jc(),this.Kc)return new Promise(()=>{});const t=new Se;return this.Yc(()=>this.Kc&&this.zc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Uc.push(e),this.Zc()))}Zc(){var e=this;return(0,w.Z)(function*(){if(0!==e.Uc.length){try{yield e.Uc[0](),e.Uc.shift(),e.ko.reset()}catch(t){if(!on(t))throw t;E("AsyncQueue","Operation failed with retryable error: "+t)}e.Uc.length>0&&e.ko.vo(()=>e.Zc())}})()}Yc(e){const t=this.qc.then(()=>(this.jc=!0,e().catch(s=>{throw this.Qc=s,this.jc=!1,we("INTERNAL UNHANDLED ERROR: ",function(i){let o=i.message||"";return i.stack&&(o=i.stack.includes(i.message)?i.stack:i.message+"\n"+i.stack),o}(s)),s}).then(s=>(this.jc=!1,s))));return this.qc=t,t}enqueueAfterDelay(e,t,s){this.Jc(),this.Wc.indexOf(e)>-1&&(t=0);const r=nl.createAndSchedule(this,e,t,s,i=>this.Xc(i));return this.Gc.push(r),r}Jc(){this.Qc&&D()}verifyOperationInProgress(){}ta(){var e=this;return(0,w.Z)(function*(){let t;do{t=e.qc,yield t}while(t!==e.qc)})()}ea(e){for(const t of this.Gc)if(t.timerId===e)return!0;return!1}na(e){return this.ta().then(()=>{this.Gc.sort((t,s)=>t.targetTimeMs-s.targetTimeMs);for(const t of this.Gc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.ta()})}sa(e){this.Wc.push(e)}Xc(e){const t=this.Gc.indexOf(e);this.Gc.splice(t,1)}}function Gl(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const s=e;for(const r of["next","error","complete"])if(r in s&&"function"==typeof s[r])return!0;return!1}(n)}class iw{constructor(){this._progressObserver={},this._taskCompletionResolver=new Se,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,s){this._progressObserver={next:e,error:t,complete:s}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class ce extends Ji{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new rw,this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||cp(this),this._firestoreClient.terminate()}}function be(n){return n._firestoreClient||cp(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function cp(n){var e;const t=n._freezeSettings(),s=(i=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new ym(n._databaseId,i,n._persistenceKey,(a=t).host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams));var i,a;n._firestoreClient=new Zy(n._authCredentials,n._appCheckCredentials,n._queue,s)}function up(n,e,t){const s=new Se;return n.asyncQueue.enqueue((0,w.Z)(function*(){try{yield Hf(n,t),yield Qf(n,e),s.resolve()}catch(r){const i=r;if(!("FirebaseError"===(o=i).name?o.code===x.FAILED_PRECONDITION||o.code===x.UNIMPLEMENTED:!(typeof DOMException<"u"&&o instanceof DOMException)||22===o.code||20===o.code||11===o.code))throw i;Kn("Error enabling offline persistence. Falling back to persistence disabled: "+i),s.reject(i)}var o})).then(()=>s.promise)}function lp(n){if(n._initialized||n._terminated)throw new C(x.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class St{constructor(e){this._byteString=e}static fromBase64String(e){try{return new St(Ae.fromBase64String(e))}catch(t){throw new C(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new St(Ae.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Kt{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new C(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new me(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class cs{constructor(e){this._methodName=e}}class za{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new C(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new C(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return U(this._lat,e._lat)||U(this._long,e._long)}}const gw=/^__.*__$/;class yw{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return null!==this.fieldMask?new Ut(e,this.data,this.fieldMask,t,this.fieldTransforms):new rr(e,this.data,t,this.fieldTransforms)}}class hp{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new Ut(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function dp(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw D()}}class Ha{constructor(e,t,s,r,i,o){this.settings=e,this.databaseId=t,this.Tt=s,this.ignoreUndefinedProperties=r,void 0===i&&this.ia(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get ra(){return this.settings.ra}oa(e){return new Ha(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.Tt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ua(e){var t;const s=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.oa({path:s,ca:!1});return r.aa(e),r}ha(e){var t;const s=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.oa({path:s,ca:!1});return r.ia(),r}la(e){return this.oa({path:void 0,ca:!0})}fa(e){return Wa(e,this.settings.methodName,this.settings.da||!1,this.path,this.settings._a)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}ia(){if(this.path)for(let e=0;e<this.path.length;e++)this.aa(this.path.get(e))}aa(e){if(0===e.length)throw this.fa("Document fields must not be empty");if(dp(this.ra)&&gw.test(e))throw this.fa('Document fields cannot begin and end with "__"')}}class ww{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.Tt=s||Wi(e)}wa(e,t,s,r=!1){return new Ha({ra:e,methodName:t,_a:s,path:me.emptyPath(),ca:!1,da:r},this.databaseId,this.Tt,this.ignoreUndefinedProperties)}}function us(n){const e=n._freezeSettings(),t=Wi(n._databaseId);return new ww(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Qa(n,e,t,s,r,i={}){const o=n.wa(i.merge||i.mergeFields?2:0,e,t,r);Zl("Data must be an object, but it was:",o,s);const a=mp(s,o);let l,h;if(i.merge)l=new tt(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const f=[];for(const p of i.mergeFields){const y=no(e,p,t);if(!o.contains(y))throw new C(x.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);yp(f,y)||f.push(y)}l=new tt(f),h=o.fieldTransforms.filter(p=>l.covers(p.field))}else l=null,h=o.fieldTransforms;return new yw(new Pe(a),l,h)}class to extends cs{_toFieldTransform(e){if(2!==e.ra)throw e.fa(1===e.ra?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof to}}function fp(n,e,t){return new Ha({ra:3,_a:e.settings._a,methodName:n._methodName,ca:t},e.databaseId,e.Tt,e.ignoreUndefinedProperties)}class zl extends cs{_toFieldTransform(e){return new Pi(e.path,new nr)}isEqual(e){return e instanceof zl}}class vw extends cs{constructor(e,t){super(e),this.ma=t}_toFieldTransform(e){const t=fp(this,e,!0),s=this.ma.map(i=>ls(i,t)),r=new Jn(s);return new Pi(e.path,r)}isEqual(e){return this===e}}class bw extends cs{constructor(e,t){super(e),this.ma=t}_toFieldTransform(e){const t=fp(this,e,!0),s=this.ma.map(i=>ls(i,t)),r=new es(s);return new Pi(e.path,r)}isEqual(e){return this===e}}class xw extends cs{constructor(e,t){super(e),this.ga=t}_toFieldTransform(e){const t=new sr(e.Tt,ed(e.Tt,this.ga));return new Pi(e.path,t)}isEqual(e){return this===e}}function Hl(n,e,t,s){const r=n.wa(1,e,t);Zl("Data must be an object, but it was:",r,s);const i=[],o=Pe.empty();Hn(s,(l,h)=>{const f=Za(e,l,t);h=(0,q.m9)(h);const p=r.ha(f);if(h instanceof to)i.push(f);else{const y=ls(h,p);null!=y&&(i.push(f),o.set(f,y))}});const a=new tt(i);return new hp(o,a,r.fieldTransforms)}function Ql(n,e,t,s,r,i){const o=n.wa(1,e,t),a=[no(e,s,t)],l=[r];if(i.length%2!=0)throw new C(x.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<i.length;y+=2)a.push(no(e,i[y])),l.push(i[y+1]);const h=[],f=Pe.empty();for(let y=a.length-1;y>=0;--y)if(!yp(h,a[y])){const v=a[y];let I=l[y];I=(0,q.m9)(I);const S=o.ha(v);if(I instanceof to)h.push(v);else{const P=ls(I,S);null!=P&&(h.push(v),f.set(v,P))}}const p=new tt(h);return new hp(f,p,o.fieldTransforms)}function pp(n,e,t,s=!1){return ls(t,n.wa(s?4:3,e))}function ls(n,e){if(gp(n=(0,q.m9)(n)))return Zl("Unsupported field value:",e,n),mp(n,e);if(n instanceof cs)return function(t,s){if(!dp(s.ra))throw s.fa(`${t._methodName}() can only be used with update() and set()`);if(!s.path)throw s.fa(`${t._methodName}() is not currently supported inside arrays`);const r=t._toFieldTransform(s);r&&s.fieldTransforms.push(r)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.ca&&4!==e.ra)throw e.fa("Nested arrays are not supported");return function(t,s){const r=[];let i=0;for(const o of t){let a=ls(o,s.la(i));null==a&&(a={nullValue:"NULL_VALUE"}),r.push(a),i++}return{arrayValue:{values:r}}}(n,e)}return function(t,s){if(null===(t=(0,q.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ed(s.Tt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const r=he.fromDate(t);return{timestampValue:or(s.Tt,r)}}if(t instanceof he){const r=new he(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:or(s.Tt,r)}}if(t instanceof za)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof St)return{bytesValue:xd(s.Tt,t._byteString)};if(t instanceof ae){const r=s.databaseId,i=t.firestore._databaseId;if(!i.isEqual(r))throw s.fa(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:uu(t.firestore._databaseId||s.databaseId,t._key.path)}}throw s.fa(`Unsupported field value: ${Ka(t)}`)}(n,e)}function mp(n,e){const t={};return Ch(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Hn(n,(s,r)=>{const i=ls(r,e.ua(s));null!=i&&(t[s]=i)}),{mapValue:{fields:t}}}function gp(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof he||n instanceof za||n instanceof St||n instanceof ae||n instanceof cs)}function Zl(n,e,t){if(!gp(t)||"object"!=typeof(s=t)||null===s||Object.getPrototypeOf(s)!==Object.prototype&&null!==Object.getPrototypeOf(s)){const s=Ka(t);throw e.fa("an object"===s?n+" a custom object":n+" "+s)}var s}function no(n,e,t){if((e=(0,q.m9)(e))instanceof Kt)return e._internalPath;if("string"==typeof e)return Za(n,e);throw Wa("Field path arguments must be of type string or ",n,!1,void 0,t)}const _w=new RegExp("[~\\*/\\[\\]]");function Za(n,e,t){if(e.search(_w)>=0)throw Wa(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Kt(...e.split("."))._internalPath}catch{throw Wa(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Wa(n,e,t,s,r){const i=s&&!s.isEmpty(),o=void 0!==r;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${s}`),o&&(l+=` in document ${r}`),l+=")"),new C(x.INVALID_ARGUMENT,a+n+l)}function yp(n,e){return n.some(t=>t.isEqual(e))}class so{constructor(e,t,s,r,i){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ae(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Tw(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Xa("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Tw extends so{data(){return super.data()}}function Xa(n,e){return"string"==typeof e?Za(n,e):e instanceof Kt?e._internalPath:e._delegate._internalPath}function wp(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new C(x.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Wl{}class ro extends Wl{}function vn(n,e,...t){let s=[];e instanceof Wl&&s.push(e),s=s.concat(t),function(r){const i=r.filter(a=>a instanceof br).length,o=r.filter(a=>a instanceof io).length;if(i>1||i>0&&o>0)throw new C(x.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const r of s)n=r._apply(n);return n}class io extends ro{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new io(e,t,s)}_apply(e){const t=this._parse(e);return _p(e._query,t),new Ue(e.firestore,e.converter,ou(e._query,t))}_parse(e){const t=us(e.firestore);return function(r,i,o,a,l,h,f){let p;if(l.isKeyField()){if("array-contains"===h||"array-contains-any"===h)throw new C(x.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if("in"===h||"not-in"===h){xp(f,h);const y=[];for(const v of f)y.push(bp(a,r,v));p={arrayValue:{values:y}}}else p=bp(a,r,f)}else"in"!==h&&"not-in"!==h&&"array-contains-any"!==h||xp(f,h),p=pp(o,"where",f,"in"===h||"not-in"===h);return H.create(l,h,p)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class br extends Wl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new br(e,t)}_parse(e){const t=this._queryConstraints.map(s=>s._parse(e)).filter(s=>s.getFilters().length>0);return 1===t.length?t[0]:te.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(s,r){let i=s;const o=r.getFlattenedFilters();for(const a of o)_p(i,a),i=ou(i,a)}(e._query,t),new Ue(e.firestore,e.converter,ou(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Xl extends ro{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Xl(e,t)}_apply(e){const t=function(s,r,i){if(null!==s.startAt)throw new C(x.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==s.endAt)throw new C(x.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new Js(r,i);return function(a,l){if(null===ru(a)){const h=ya(a);null!==h&&Tp(0,h,l.field)}}(s,o),o}(e._query,this._field,this._direction);return new Ue(e.firestore,e.converter,function(s,r){const i=s.explicitOrderBy.concat([r]);return new qt(s.path,s.collectionGroup,i,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}class Ya extends ro{constructor(e,t,s){super(),this.type=e,this._limit=t,this._limitType=s}static _create(e,t,s){return new Ya(e,t,s)}_apply(e){return new Ue(e.firestore,e.converter,wa(e._query,this._limit,this._limitType))}}class Ja extends ro{constructor(e,t,s){super(),this.type=e,this._docOrFields=t,this._inclusive=s}static _create(e,t,s){return new Ja(e,t,s)}_apply(e){const t=vp(e,this.type,this._docOrFields,this._inclusive);return new Ue(e.firestore,e.converter,(r=t,new qt((s=e._query).path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,r,s.endAt)));var s,r}}class ec extends ro{constructor(e,t,s){super(),this.type=e,this._docOrFields=t,this._inclusive=s}static _create(e,t,s){return new ec(e,t,s)}_apply(e){const t=vp(e,this.type,this._docOrFields,this._inclusive);return new Ue(e.firestore,e.converter,(r=t,new qt((s=e._query).path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,r)));var s,r}}function vp(n,e,t,s){if(t[0]=(0,q.m9)(t[0]),t[0]instanceof so)return function(r,i,o,a,l){if(!a)throw new C(x.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const h=[];for(const f of Yn(r))if(f.field.isKeyField())h.push(Wn(i,a.key));else{const p=a.data.field(f.field);if(Xc(p))throw new C(x.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===p){const y=f.field.canonicalString();throw new C(x.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}h.push(p)}return new hn(h,l)}(n._query,n.firestore._databaseId,e,t[0]._document,s);{const r=us(n.firestore);return function(i,o,a,l,h,f){const p=i.explicitOrderBy;if(h.length>p.length)throw new C(x.INVALID_ARGUMENT,`Too many arguments provided to ${l}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let v=0;v<h.length;v++){const I=h[v];if(p[v].field.isKeyField()){if("string"!=typeof I)throw new C(x.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${l}(), but got a ${typeof I}`);if(!iu(i)&&-1!==I.indexOf("/"))throw new C(x.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${l}() must be a plain document ID, but '${I}' contains a slash.`);const S=i.path.child(Z.fromString(I));if(!A.isDocumentKey(S))throw new C(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${l}() must result in a valid document path, but '${S}' is not because it contains an odd number of segments.`);const P=new A(S);y.push(Wn(o,P))}else{const S=pp(a,l,I);y.push(S)}}return new hn(y,f)}(n._query,n.firestore._databaseId,r,e,t,s)}}function bp(n,e,t){if("string"==typeof(t=(0,q.m9)(t))){if(""===t)throw new C(x.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!iu(e)&&-1!==t.indexOf("/"))throw new C(x.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const s=e.path.child(Z.fromString(t));if(!A.isDocumentKey(s))throw new C(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Wn(n,new A(s))}if(t instanceof ae)return Wn(n,t._key);throw new C(x.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ka(t)}.`)}function xp(n,e){if(!Array.isArray(n)||0===n.length)throw new C(x.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function _p(n,e){if(e.isInequality()){const s=ya(n),r=e.field;if(null!==s&&!s.isEqual(r))throw new C(x.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${s.toString()}' and '${r.toString()}'`);const i=ru(n);null!==i&&Tp(0,r,i)}const t=function(s,r){for(const i of s)for(const o of i.getFlattenedFilters())if(r.indexOf(o.op)>=0)return o.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new C(x.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Tp(n,e,t){if(!t.isEqual(e))throw new C(x.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class Yl{convertValue(e,t="none"){switch(Zn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ge(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Qn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw D()}}convertObject(e,t){const s={};return Hn(e.fields,(r,i)=>{s[r]=this.convertValue(i,t)}),s}convertGeoPoint(e){return new za(ge(e.latitude),ge(e.longitude))}convertArray(e,t){return(e.values||[]).map(s=>this.convertValue(s,t))}convertServerTimestamp(e,t){switch(t){case"previous":const s=Sh(e);return null==s?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(Ei(e));default:return null}}convertTimestamp(e){const t=cn(e);return new he(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=Z.fromString(e);O(Md(s));const r=new an(s.get(1),s.get(3)),i=new A(s.popFirst(5));return r.isEqual(t)||we(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function tc(n,e,t){let s;return s=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,s}class Nw extends Yl{constructor(e){super(),this.firestore=e}convertBytes(e){return new St(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ae(this.firestore,null,t)}}class hs{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Gt extends so{constructor(e,t,s,r,i,o){super(e,t,s,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new oo(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(Xa("DocumentSnapshot.get",e));if(null!==s)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}}class oo extends Gt{data(e={}){return super.data(e)}}class bn{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new hs(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(s=>{e.call(t,new oo(this._firestore,this._userDataWriter,s.key,s,new hs(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new C(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,r){if(s._snapshot.oldDocs.isEmpty()){let i=0;return s._snapshot.docChanges.map(o=>({type:"added",doc:new oo(s._firestore,s._userDataWriter,o.doc.key,o.doc,new hs(s._snapshot.mutatedKeys.has(o.doc.key),s._snapshot.fromCache),s.query.converter),oldIndex:-1,newIndex:i++}))}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(o=>r||3!==o.type).map(o=>{const a=new oo(s._firestore,s._userDataWriter,o.doc.key,o.doc,new hs(s._snapshot.mutatedKeys.has(o.doc.key),s._snapshot.fromCache),s.query.converter);let l=-1,h=-1;return 0!==o.type&&(l=i.indexOf(o.doc.key),i=i.delete(o.doc.key)),1!==o.type&&(i=i.add(o.doc),h=i.indexOf(o.doc.key)),{type:Ow(o.type),doc:a,oldIndex:l,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Ow(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return D()}}function Cp(n,e){return n instanceof Gt&&e instanceof Gt?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof bn&&e instanceof bn&&n._firestore===e._firestore&&Kl(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class xn extends Yl{constructor(e){super(),this.firestore=e}convertBytes(e){return new St(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ae(this.firestore,null,t)}}function Ep(n,e,t){n=Q(n,ae);const s=Q(n.firestore,ce),r=tc(n.converter,e,t);return xr(s,[Qa(us(s),"setDoc",n._key,r,null!==n.converter,t).toMutation(n._key,de.none())])}function Sp(n,e,t,...s){n=Q(n,ae);const r=Q(n.firestore,ce),i=us(r);let o;return o="string"==typeof(e=(0,q.m9)(e))||e instanceof Kt?Ql(i,"updateDoc",n._key,e,t,s):Hl(i,"updateDoc",n._key,e),xr(r,[o.toMutation(n._key,de.exists(!0))])}function Ap(n,...e){var t,s,r;n=(0,q.m9)(n);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Gl(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(Gl(e[o])){const p=e[o];e[o]=null===(t=p.next)||void 0===t?void 0:t.bind(p),e[o+1]=null===(s=p.error)||void 0===s?void 0:s.bind(p),e[o+2]=null===(r=p.complete)||void 0===r?void 0:r.bind(p)}let l,h,f;if(n instanceof ae)h=Q(n.firestore,ce),f=tr(n._key.path),l={next:p=>{e[o]&&e[o](Jl(h,n,p))},error:e[o+1],complete:e[o+2]};else{const p=Q(n,Ue);h=Q(p.firestore,ce),f=p._query;const y=new xn(h);l={next:v=>{e[o]&&e[o](new bn(h,y,p,v))},error:e[o+1],complete:e[o+2]},wp(n._query)}return function(p,y,v,I){const S=new Ua(I),P=new cl(y,S,v);return p.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return sl(yield vr(p),P)})),()=>{S.Pc(),p.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return il(yield vr(p),P)}))}}(be(h),f,a,l)}function xr(n,e){return function(t,s){const r=new Se;return t.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return function ky(n,e,t){return fl.apply(this,arguments)}(yield Ul(t),s,r)})),r.promise}(be(n),e)}function Jl(n,e,t){const s=t.docs.get(e._key),r=new xn(n);return new Gt(n,r,e._key,s,new hs(t.hasPendingWrites,t.fromCache),e.converter)}const Gw={maxAttempts:5};class kp{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=us(e)}set(e,t,s){this._verifyNotCommitted();const r=_n(e,this._firestore),i=tc(r.converter,t,s),o=Qa(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,s);return this._mutations.push(o.toMutation(r._key,de.none())),this}update(e,t,s,...r){this._verifyNotCommitted();const i=_n(e,this._firestore);let o;return o="string"==typeof(t=(0,q.m9)(t))||t instanceof Kt?Ql(this._dataReader,"WriteBatch.update",i._key,t,s,r):Hl(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,de.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=_n(e,this._firestore);return this._mutations=this._mutations.concat(new ir(t._key,de.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new C(x.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function _n(n,e){if((n=(0,q.m9)(n)).firestore!==e)throw new C(x.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class zw extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=us(e)}get(e){const t=_n(e,this._firestore),s=new Nw(this._firestore);return this._transaction.lookup([t._key]).then(r=>{if(!r||1!==r.length)return D();const i=r[0];if(i.isFoundDocument())return new so(this._firestore,s,i.key,i,t.converter);if(i.isNoDocument())return new so(this._firestore,s,t._key,null,t.converter);throw D()})}set(e,t,s){const r=_n(e,this._firestore),i=tc(r.converter,t,s),o=Qa(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,s);return this._transaction.set(r._key,o),this}update(e,t,s,...r){const i=_n(e,this._firestore);let o;return o="string"==typeof(t=(0,q.m9)(t))||t instanceof Kt?Ql(this._dataReader,"Transaction.update",i._key,t,s,r):Hl(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=_n(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=_n(e,this._firestore),s=new xn(this._firestore);return super.get(e).then(r=>new Gt(this._firestore,s,t._key,r._document,new hs(!1,!1),t.converter))}}!function(n,e=!0){Zs=Qe.SDK_VERSION,(0,Qe._registerComponent)(new pt.wA("firestore",(t,{instanceIdentifier:s,options:r})=>{const i=t.getProvider("app").getImmediate(),o=new ce(new sm(t.getProvider("auth-internal")),new om(t.getProvider("app-check-internal")),function(a,l){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new C(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new an(a.options.projectId,l)}(i,s),i);return r=Object.assign({useFetchStreams:e},r),o._setSettings(r),o},"PUBLIC").setMultipleInstances(!0)),(0,Qe.registerVersion)(ph,"3.8.4",n),(0,Qe.registerVersion)(ph,"3.8.4","esm2017")}();function eh(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new C("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Mp(){if(typeof Uint8Array>"u")throw new C("unimplemented","Uint8Arrays are not available in this environment.")}function Np(){if(!function vm(){return typeof atob<"u"}())throw new C("unimplemented","Blobs are unavailable in Firestore in this environment.")}class ao{constructor(e){this._delegate=e}static fromBase64String(e){return Np(),new ao(St.fromBase64String(e))}static fromUint8Array(e){return Mp(),new ao(St.fromUint8Array(e))}toBase64(){return Np(),this._delegate.toBase64()}toUint8Array(){return Mp(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function th(n){return function t0(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const s of e)if(s in t&&"function"==typeof t[s])return!0;return!1}(n,["next","error","complete"])}class n0{enableIndexedDbPersistence(e,t){return function aw(n,e){lp(n=Q(n,ce));const t=be(n),s=n._freezeSettings(),r=new Ol;return up(t,r,new Gf(r,s.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function cw(n){lp(n=Q(n,ce));const e=be(n),t=n._freezeSettings(),s=new Ol;return up(e,s,new Gy(s,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function uw(n){if(n._initialized&&!n._terminated)throw new C(x.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Se;return n._queue.enqueueAndForgetEvenWhileRestricted((0,w.Z)(function*(){try{yield(t=(0,w.Z)(function*(s){if(!yt.C())return Promise.resolve();const r=s+"main";yield yt.delete(r)}),function(s){return t.apply(this,arguments)})(Su(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Pp{constructor(e,t,s){this._delegate=t,this._persistenceProvider=s,this.INTERNAL={delete:()=>this.terminate()},e instanceof an||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Kn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,s={}){!function ip(n,e,t,s={}){var r;const i=(n=Q(n,Ji))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Kn("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${t}`,ssl:!1})),s.mockUserToken){let o,a;if("string"==typeof s.mockUserToken)o=s.mockUserToken,a=Ne.MOCK_USER;else{o=(0,q.Sg)(s.mockUserToken,null===(r=n._app)||void 0===r?void 0:r.options.projectId);const l=s.mockUserToken.sub||s.mockUserToken.user_id;if(!l)throw new C(x.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new Ne(l)}n._authCredentials=new nm(new mh(o,a))}}(this._delegate,e,t,s)}enableNetwork(){return function hw(n){return function Wy(n){return n.asyncQueue.enqueue((0,w.Z)(function*(){const e=yield Zf(n),t=yield ql(n);return e.setNetworkEnabled(!0),function(s){const r=k(s);return r.mu.delete(0),Xi(r)}(t)}))}(be(n=Q(n,ce)))}(this._delegate)}disableNetwork(){return function dw(n){return function Xy(n){return n.asyncQueue.enqueue((0,w.Z)(function*(){const e=yield Zf(n),t=yield ql(n);return e.setNetworkEnabled(!1),(s=(0,w.Z)(function*(r){const i=k(r);i.mu.add(0),yield dr(i),i.pu.set("Offline")}),function(r){return s.apply(this,arguments)})(t);var s}))}(be(n=Q(n,ce)))}(this._delegate)}enablePersistence(e){let t=!1,s=!1;return e&&(t=!!e.synchronizeTabs,s=!!e.experimentalForceOwningTab,ep("synchronizeTabs",t,"experimentalForceOwningTab",s)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,s)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function lw(n){return function(e){const t=new Se;return e.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return function Py(n,e){return wl.apply(this,arguments)}(yield Ul(e),t)})),t.promise}(be(n=Q(n,ce)))}(this._delegate)}onSnapshotsInSync(e){return function $w(n,e){return function ew(n,e){const t=new Ua(e);return n.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return s=yield vr(n),r=t,k(s).vu.add(r),void r.next();var s,r})),()=>{t.Pc(),n.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return s=yield vr(n),r=t,void k(s).vu.delete(r);var s,r}))}}(be(n=Q(n,ce)),Gl(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new C("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new _r(this,op(this._delegate,e))}catch(t){throw Xe(t,"collection()","Firestore.collection()")}}doc(e){try{return new ft(this,Ga(this._delegate,e))}catch(t){throw Xe(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Ye(this,function sw(n,e){if(n=Q(n,Ji),$l("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new C(x.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ue(n,null,(t=e,new qt(Z.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw Xe(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function Hw(n,e,t){n=Q(n,ce);const s=Object.assign(Object.assign({},Gw),t);return function(r){if(r.maxAttempts<1)throw new C(x.INVALID_ARGUMENT,"Max attempts must be at least 1")}(s),function(r,i,o){const a=new Se;return r.asyncQueue.enqueueAndForget((0,w.Z)(function*(){const l=yield function Wf(n){return ja(n).then(e=>e.datastore)}(r);new Qy(r.asyncQueue,l,o,i,a).run()})),a.promise}(be(n),r=>e(new zw(n,r)),s)}(this._delegate,t=>e(new Op(this,t)))}batch(){return be(this._delegate),new Lp(new kp(this._delegate,e=>xr(this._delegate,e)))}loadBundle(e){return function fw(n,e){const t=be(n=Q(n,ce)),s=new iw;return function tw(n,e,t,s){const r=function(i,o){let a;return a="string"==typeof i?(new TextEncoder).encode(i):i,l=function(l,h){if(l instanceof Uint8Array)return zf(l,h);if(l instanceof ArrayBuffer)return zf(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(a),new zy(l,o);var l}(t,Wi(e));n.asyncQueue.enqueueAndForget((0,w.Z)(function*(){!function Ky(n,e,t){const s=k(n);var r;(r=(0,w.Z)(function*(i,o,a){try{const l=yield o.getMetadata();if(yield function(y,v){const I=k(y),S=ve(v.createTime);return I.persistence.runTransaction("hasNewerBundle","readonly",P=>I.Os.getBundleMetadata(P,v.id)).then(P=>!!P&&P.createTime.compareTo(S)>=0)}(i.localStore,l))return yield o.close(),a._completeWith({taskState:"Success",documentsLoaded:(y=l).totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}),Promise.resolve(new Set);a._updateProgress(Lf(l));const h=new Ty(l,i.localStore,o.Tt);let f=yield o.yc();for(;f;){const y=yield h.Bu(f);y&&a._updateProgress(y),f=yield o.yc()}const p=yield h.complete();return yield $t(i,p.Uu,void 0),yield function(y,v){const I=k(y);return I.persistence.runTransaction("Save bundle","readwrite",S=>I.Os.saveBundleMetadata(S,v))}(i.localStore,l),a._completeWith(p.progress),Promise.resolve(p.qu)}catch(l){return Kn("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}var y}),function(i,o,a){return r.apply(this,arguments)})(s,e,t).then(r=>{s.sharedClientState.notifyBundleLoaded(r)})}(yield Ul(n),r,s)}))}(t,n._databaseId,e,s),s}(this._delegate,e)}namedQuery(e){return function pw(n,e){return function nw(n,e){return n.asyncQueue.enqueue((0,w.Z)(function*(){return function(t,s){const r=k(t);return r.persistence.runTransaction("Get named query","readonly",i=>r.Os.getNamedQuery(i,s))}(yield $a(n),e)}))}(be(n=Q(n,ce)),e).then(t=>t?new Ue(n,null,t.query):null)}(this._delegate,e).then(t=>t?new Ye(this,t):null)}}class nc extends Yl{constructor(e){super(),this.firestore=e}convertBytes(e){return new ao(new St(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return ft.forKey(t,this.firestore,null)}}class Op{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new nc(e)}get(e){const t=fs(e);return this._delegate.get(t).then(s=>new co(this._firestore,new Gt(this._firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,t.converter)))}set(e,t,s){const r=fs(e);return s?(eh("Transaction.set",s),this._delegate.set(r,t,s)):this._delegate.set(r,t),this}update(e,t,s,...r){const i=fs(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,s,...r),this}delete(e){const t=fs(e);return this._delegate.delete(t),this}}class Lp{constructor(e){this._delegate=e}set(e,t,s){const r=fs(e);return s?(eh("WriteBatch.set",s),this._delegate.set(r,t,s)):this._delegate.set(r,t),this}update(e,t,s,...r){const i=fs(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,s,...r),this}delete(e){const t=fs(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class ds{constructor(e,t,s){this._firestore=e,this._userDataWriter=t,this._delegate=s}fromFirestore(e,t){const s=new oo(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new uo(this._firestore,s),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const s=ds.INSTANCES;let r=s.get(e);r||(r=new WeakMap,s.set(e,r));let i=r.get(t);return i||(i=new ds(e,new nc(e),t),r.set(t,i)),i}}ds.INSTANCES=new WeakMap;class ft{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new nc(e)}static forPath(e,t,s){if(e.length%2!=0)throw new C("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new ft(t,new ae(t._delegate,s,new A(e)))}static forKey(e,t,s){return new ft(t,new ae(t._delegate,s,e))}get id(){return this._delegate.id}get parent(){return new _r(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new _r(this.firestore,op(this._delegate,e))}catch(t){throw Xe(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,q.m9)(e))instanceof ae&&ap(this._delegate,e)}set(e,t){t=eh("DocumentReference.set",t);try{return t?Ep(this._delegate,e,t):Ep(this._delegate,e)}catch(s){throw Xe(s,"setDoc()","DocumentReference.set()")}}update(e,t,...s){try{return 1===arguments.length?Sp(this._delegate,e):Sp(this._delegate,e,t,...s)}catch(r){throw Xe(r,"updateDoc()","DocumentReference.update()")}}delete(){return function Uw(n){return xr(Q(n.firestore,ce),[new ir(n._key,de.none())])}(this._delegate)}onSnapshot(...e){const t=Fp(e),s=Rp(e,r=>new co(this.firestore,new Gt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)));return Ap(this._delegate,t,s)}get(e){let t;return t="cache"===e?.source?function Fw(n){n=Q(n,ae);const e=Q(n.firestore,ce),t=be(e),s=new xn(e);return function Yy(n,e){const t=new Se;return n.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return(s=(0,w.Z)(function*(r,i,o){try{const a=yield function(l,h){const f=k(l);return f.persistence.runTransaction("read document","readonly",p=>f.localDocuments.getDocument(p,h))}(r,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new C(x.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=mr(a,`Failed to get document '${i} from cache`);o.reject(l)}}),function(r,i,o){return s.apply(this,arguments)})(yield $a(n),e,t);var s})),t.promise}(t,n._key).then(r=>new Gt(e,s,n._key,r,new hs(null!==r&&r.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===e?.source?function Rw(n){n=Q(n,ae);const e=Q(n.firestore,ce);return Xf(be(e),n._key,{source:"server"}).then(t=>Jl(e,n,t))}(this._delegate):function Lw(n){n=Q(n,ae);const e=Q(n.firestore,ce);return Xf(be(e),n._key).then(t=>Jl(e,n,t))}(this._delegate),t.then(s=>new co(this.firestore,new Gt(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)))}withConverter(e){return new ft(this.firestore,this._delegate.withConverter(e?ds.getInstance(this.firestore,e):null))}}function Xe(n,e,t){return n.message=n.message.replace(e,t),n}function Fp(n){for(const e of n)if("object"==typeof e&&!th(e))return e;return{}}function Rp(n,e){var t,s;let r;return r=th(n[0])?n[0]:th(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:i=>{r.next&&r.next(e(i))},error:null===(t=r.error)||void 0===t?void 0:t.bind(r),complete:null===(s=r.complete)||void 0===s?void 0:s.bind(r)}}class co{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new ft(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Cp(this._delegate,e._delegate)}}class uo extends co{data(e){const t=this._delegate.data(e);return function em(n,e){n||D()}(void 0!==t),t}}class Ye{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new nc(e)}where(e,t,s){try{return new Ye(this.firestore,vn(this._delegate,function Iw(n,e,t){const s=e,r=Xa("where",n);return io._create(r,s,t)}(e,t,s)))}catch(r){throw Xe(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Ye(this.firestore,vn(this._delegate,function Cw(n,e="asc"){const t=e,s=Xa("orderBy",n);return Xl._create(s,t)}(e,t)))}catch(s){throw Xe(s,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Ye(this.firestore,vn(this._delegate,function Ew(n){return sp("limit",n),Ya._create("limit",n,"F")}(e)))}catch(t){throw Xe(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Ye(this.firestore,vn(this._delegate,function Sw(n){return sp("limitToLast",n),Ya._create("limitToLast",n,"L")}(e)))}catch(t){throw Xe(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Ye(this.firestore,vn(this._delegate,function Aw(...n){return Ja._create("startAt",n,!0)}(...e)))}catch(t){throw Xe(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Ye(this.firestore,vn(this._delegate,function kw(...n){return Ja._create("startAfter",n,!1)}(...e)))}catch(t){throw Xe(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Ye(this.firestore,vn(this._delegate,function Dw(...n){return ec._create("endBefore",n,!1)}(...e)))}catch(t){throw Xe(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Ye(this.firestore,vn(this._delegate,function Mw(...n){return ec._create("endAt",n,!0)}(...e)))}catch(t){throw Xe(t,"endAt()","Query.endAt()")}}isEqual(e){return Kl(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function Bw(n){n=Q(n,Ue);const e=Q(n.firestore,ce),t=be(e),s=new xn(e);return function Jy(n,e){const t=new Se;return n.asyncQueue.enqueueAndForget((0,w.Z)(function*(){return(s=(0,w.Z)(function*(r,i,o){try{const a=yield La(r,i,!0),l=new Vf(i,a.Yi),h=l.Hu(a.documents),f=l.applyChanges(h,!1);o.resolve(f.snapshot)}catch(a){const l=mr(a,`Failed to execute query '${i} against cache`);o.reject(l)}}),function(r,i,o){return s.apply(this,arguments)})(yield $a(n),e,t);var s})),t.promise}(t,n._query).then(r=>new bn(e,s,n,r))}(this._delegate):"server"===e?.source?function qw(n){n=Q(n,Ue);const e=Q(n.firestore,ce),t=be(e),s=new xn(e);return Yf(t,n._query,{source:"server"}).then(r=>new bn(e,s,n,r))}(this._delegate):function Vw(n){n=Q(n,Ue);const e=Q(n.firestore,ce),t=be(e),s=new xn(e);return wp(n._query),Yf(t,n._query).then(r=>new bn(e,s,n,r))}(this._delegate),t.then(s=>new nh(this.firestore,new bn(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)))}onSnapshot(...e){const t=Fp(e),s=Rp(e,r=>new nh(this.firestore,new bn(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)));return Ap(this._delegate,t,s)}withConverter(e){return new Ye(this.firestore,this._delegate.withConverter(e?ds.getInstance(this.firestore,e):null))}}class r0{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new uo(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class nh{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Ye(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new uo(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new r0(this._firestore,t))}forEach(e,t){this._delegate.forEach(s=>{e.call(t,new uo(this._firestore,s))})}isEqual(e){return Cp(this._delegate,e._delegate)}}class _r extends Ye{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new ft(this.firestore,e):null}doc(e){try{return new ft(this.firestore,void 0===e?Ga(this._delegate):Ga(this._delegate,e))}catch(t){throw Xe(t,"doc()","CollectionReference.doc()")}}add(e){return function jw(n,e){const t=Q(n.firestore,ce),s=Ga(n),r=tc(n.converter,e);return xr(t,[Qa(us(n.firestore),"addDoc",s._key,r,null!==n.converter,{}).toMutation(s._key,de.exists(!1))]).then(()=>s)}(this._delegate,e).then(t=>new ft(this.firestore,t))}isEqual(e){return ap(this._delegate,e._delegate)}withConverter(e){return new _r(this.firestore,this._delegate.withConverter(e?ds.getInstance(this.firestore,e):null))}}function fs(n){return Q(n,ae)}class sh{constructor(...e){this._delegate=new Kt(...e)}static documentId(){return new sh(me.keyField().canonicalString())}isEqual(e){return(e=(0,q.m9)(e))instanceof Kt&&this._delegate._internalPath.isEqual(e._internalPath)}}class ps{constructor(e){this._delegate=e}static serverTimestamp(){const e=function Zw(){return new zl("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new ps(e)}static delete(){const e=function Qw(){return new to("deleteField")}();return e._methodName="FieldValue.delete",new ps(e)}static arrayUnion(...e){const t=function Ww(...n){return new vw("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new ps(t)}static arrayRemove(...e){const t=function Xw(...n){return new bw("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new ps(t)}static increment(e){const t=function Yw(n){return new xw("increment",n)}(e);return t._methodName="FieldValue.increment",new ps(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const o0={Firestore:Pp,GeoPoint:za,Timestamp:he,Blob:ao,Transaction:Op,WriteBatch:Lp,DocumentReference:ft,DocumentSnapshot:co,Query:Ye,QueryDocumentSnapshot:uo,QuerySnapshot:nh,CollectionReference:_r,FieldPath:sh,FieldValue:ps,setLogLevel:function s0(n){!function Jp(n){sn.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function c0(n){(function a0(n,e){n.INTERNAL.registerComponent(new pt.wA("firestore-compat",t=>{const s=t.getProvider("app-compat").getImmediate(),r=t.getProvider("firestore").getImmediate();return e(s,r)},"PUBLIC").setServiceProps(Object.assign({},o0)))})(n,(e,t)=>new Pp(e,t,new n0)),n.registerVersion("@firebase/firestore-compat","0.3.4")}(go.Z);var Tn=K(1205),u0=K(6217);function Vp(n,e){return function l0(n,e=Sr.z){return new At.y(t=>{let s;return null!=e?e.schedule(()=>{s=n.onSnapshot({includeMetadataChanges:!0},t)}):s=n.onSnapshot({includeMetadataChanges:!0},t),()=>{s?.()}})}(n,e)}function rh(n,e){return Vp(n,e).pipe((0,Ie.U)(t=>({payload:t,type:"query"})))}function sc(n,e){return rh(n,e).pipe((0,Ht.O)(void 0),Re(),(0,Ie.U)(([t,s])=>{const r=s.payload.docChanges(),i=r.map(o=>({type:o.type,payload:o}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(s.payload.metadata)&&s.payload.docs.forEach((o,a)=>{const l=r.find(f=>f.doc.ref.isEqual(o.ref)),h=t?.payload.docs.find(f=>f.ref.isEqual(o.ref));l&&JSON.stringify(l.doc.metadata)===JSON.stringify(o.metadata)||!l&&h&&JSON.stringify(h.metadata)===JSON.stringify(o.metadata)||i.push({type:"modified",payload:{oldIndex:a,newIndex:a,type:"modified",doc:o}})}),i}))}function Bp(n,e,t){return sc(n,t).pipe((0,rt.R)((s,r)=>function d0(n,e,t){return e.forEach(s=>{t.indexOf(s.type)>-1&&(n=function f0(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return ih(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return ih(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return ih(n,e.oldIndex,1)}return n}(n,s))}),n}(s,r.map(i=>i.payload),e),[]),(0,cc.x)(),(0,Ie.U)(s=>s.map(r=>({type:r.type,payload:r}))))}function ih(n,e,t,...s){const r=n.slice();return r.splice(e,t,...s),r}function qp(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}K(9260);class Up{constructor(e,t,s){this.ref=e,this.query=t,this.afs=s}stateChanges(e){let t=sc(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,Ie.U)(s=>s.filter(r=>e.indexOf(r.type)>-1)))),t.pipe((0,Ht.O)(void 0),Re(),(0,He.h)(([s,r])=>r.length>0||!s),(0,Ie.U)(([s,r])=>r),$e.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,rt.R)((t,s)=>[...t,...s],[]))}snapshotChanges(e){const t=qp(e);return Bp(this.query,t,this.afs.schedulers.outsideAngular).pipe($e.iC)}valueChanges(e={}){return rh(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ie.U)(t=>t.payload.docs.map(s=>e.idField?Object.assign(Object.assign({},s.data()),{[e.idField]:s.id}):s.data())),$e.iC)}get(e){return(0,ws.D)(this.query.get(e)).pipe($e.iC)}add(e){return this.ref.add(e)}doc(e){return new jp(this.ref.doc(e),this.afs)}}class jp{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const s=this.ref.collection(e),{ref:r,query:i}=$p(s,t);return new Up(r,i,this.afs)}snapshotChanges(){return function h0(n,e){return Vp(n,e).pipe((0,Ht.O)(void 0),Re(),(0,Ie.U)(([t,s])=>s.exists?t?.exists?{payload:s,type:"modified"}:{payload:s,type:"added"}:{payload:s,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe($e.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,Ie.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,ws.D)(this.ref.get(e)).pipe($e.iC)}}class p0{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?sc(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ie.U)(t=>t.filter(s=>e.indexOf(s.type)>-1)),(0,He.h)(t=>t.length>0),$e.iC):sc(this.query,this.afs.schedulers.outsideAngular).pipe($e.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,rt.R)((t,s)=>[...t,...s],[]))}snapshotChanges(e){const t=qp(e);return Bp(this.query,t,this.afs.schedulers.outsideAngular).pipe($e.iC)}valueChanges(e={}){return rh(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ie.U)(s=>s.payload.docs.map(r=>e.idField?Object.assign({[e.idField]:r.id},r.data()):r.data())),$e.iC)}get(e){return(0,ws.D)(this.query.get(e)).pipe($e.iC)}}const m0=new g.OlP("angularfire2.enableFirestorePersistence"),g0=new g.OlP("angularfire2.firestore.persistenceSettings"),y0=new g.OlP("angularfire2.firestore.settings"),w0=new g.OlP("angularfire2.firestore.use-emulator");function $p(n,e=(t=>t)){return{query:e(n),ref:n}}let oh=(()=>{class n{constructor(t,s,r,i,o,a,l,h,f,p,y,v,I,S,P,J,M){this.schedulers=l;const L=(0,Zt.on)(t,a,s),ue=f;p&&(0,Tn.nw)(L,a,y,I,S,P,v,J),[this.firestore,this.persistenceEnabled$]=(0,Zt.cc)(`${L.name}.firestore`,"AngularFirestore",L.name,()=>{const z=a.runOutsideAngular(()=>L.firestore());if(i&&z.settings(i),ue&&z.useEmulator(...ue),r&&!(0,ze.PM)(o)){const Y=()=>{try{return(0,ws.D)(z.enablePersistence(h||void 0).then(()=>!0,()=>!1))}catch(ke){return typeof console<"u"&&console.warn(ke),(0,vs.of)(!1)}};return[z,a.runOutsideAngular(Y)]}return[z,(0,vs.of)(!1)]},[i,ue,r])}collection(t,s){let r;r="string"==typeof t?this.firestore.collection(t):t;const{ref:i,query:o}=$p(r,s),a=this.schedulers.ngZone.run(()=>i);return new Up(a,o,this)}collectionGroup(t,s){const r=s||(o=>o),i=this.firestore.collectionGroup(t);return new p0(r(i),this)}doc(t){let s;s="string"==typeof t?this.firestore.doc(t):t;const r=this.schedulers.ngZone.run(()=>s);return new jp(r,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)(g.LFG(Zt.Dh),g.LFG(Zt.xv,8),g.LFG(m0,8),g.LFG(y0,8),g.LFG(g.Lbi),g.LFG(g.R0b),g.LFG($e.HU),g.LFG(g0,8),g.LFG(w0,8),g.LFG(Tn.zQ,8),g.LFG(Tn.Qv,8),g.LFG(Tn.L6,8),g.LFG(Tn._Q,8),g.LFG(Tn.rT,8),g.LFG(Tn.lh,8),g.LFG(Tn.f7,8),g.LFG(u0.nm,8))},n.\u0275prov=g.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})(),Kp=(()=>{class n extends Er{constructor(t){super(mo,t,"calendarios")}}return n.\u0275fac=function(t){return new(t||n)(g.LFG(oh))},n.\u0275prov=g.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),v0=(()=>{class n extends Er{constructor(t){super(ys,t,"refeicoes")}}return n.\u0275fac=function(t){return new(t||n)(g.LFG(oh))},n.\u0275prov=g.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),_0=(()=>{class n{compress(t){const s=t.type||"image/jpeg",r=new FileReader;return r.readAsDataURL(t),At.y.create(i=>{r.onload=o=>{const a=this.createImage(o),l=a.width>a.height?a.width:a.height;let h=l>500?500/l:.8,f=t.size>25e4?25e4/t.size:.7;a.onload=()=>{const p=document.createElement("canvas");p.width=500,p.height=500/(a.width*h)*(a.height*h),console.log("teste img:",p);const y=p.getContext("2d");y.drawImage(a,0,0,p.width,p.height),y.canvas.toBlob(v=>{i.next(new File([v],t.name,{type:s,lastModified:Date.now()}))},s,f)}},r.onerror=o=>i.error(o)})}createImage(t){let s=t.target.result;const r=new Image;return r.src=s,r}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=g.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function T0(n,e){if(1&n){const t=g.EpF();g.ynx(0),g.TgZ(1,"div",12),g.NdJ("click",function(){g.CHM(t);const r=g.oxw().$implicit,i=g.oxw(3);return g.KtG(i.openImage(r.foto))}),g._UZ(2,"img",13),g.qZA(),g.BQk()}if(2&n){const t=g.oxw().$implicit;g.xp6(2),g.Q6J("src",t.foto,g.LSH)}}function I0(n,e){1&n&&(g.ynx(0),g._UZ(1,"div",14),g.BQk())}function C0(n,e){if(1&n){const t=g.EpF();g.TgZ(0,"div",10)(1,"button",7),g.NdJ("click",function(){const i=g.CHM(t).index,o=g.oxw().index,a=g.oxw(2);return g.KtG(a.deleteRefeicoes(o,i))}),g._UZ(2,"i",11),g.qZA(),g.TgZ(3,"div")(4,"h4"),g._uU(5),g.qZA(),g.TgZ(6,"p"),g._uU(7),g.qZA()(),g.YNc(8,T0,3,1,"ng-container",0),g.YNc(9,I0,2,0,"ng-container",0),g.qZA()}if(2&n){const t=e.$implicit;g.xp6(5),g.Oqu(t.hora),g.xp6(2),g.Oqu(t.prato),g.xp6(1),g.Q6J("ngIf",t.foto),g.xp6(1),g.Q6J("ngIf",!t.foto)}}function E0(n,e){if(1&n){const t=g.EpF();g.TgZ(0,"div")(1,"header")(2,"h3"),g._uU(3),g.qZA(),g.TgZ(4,"button",7),g.NdJ("click",function(){const i=g.CHM(t).index,o=g.oxw(2);return g.KtG(o.deleteDia(i))}),g._UZ(5,"i",8),g.qZA()(),g.TgZ(6,"div"),g.YNc(7,C0,10,4,"div",9),g.qZA(),g.TgZ(8,"button",7),g.NdJ("click",function(){const i=g.CHM(t).index,o=g.oxw(2);return g.KtG(o.createRefeicoes(i))}),g._UZ(9,"i",6),g._uU(10," Adicionar Refei\xe7\xe3o"),g.qZA()()}if(2&n){const t=e.$implicit;g.xp6(3),g.Oqu(t.nome),g.xp6(4),g.Q6J("ngForOf",t.refeicoes)}}function S0(n,e){if(1&n){const t=g.EpF();g.TgZ(0,"div")(1,"header",1)(2,"h2"),g._uU(3),g.qZA(),g.TgZ(4,"a",2),g._uU(5,"Voltar"),g.qZA()(),g.TgZ(6,"div",3),g.YNc(7,E0,11,2,"div",4),g.TgZ(8,"button",5),g.NdJ("click",function(){g.CHM(t);const r=g.oxw();return g.KtG(r.createDia())}),g._UZ(9,"i",6),g._uU(10," Adicionar Dia"),g.qZA()()()}if(2&n){const t=g.oxw();g.xp6(3),g.AsE("",t.calendarioPrint.nome," de ",t.calendarioPrint.ano," "),g.xp6(4),g.Q6J("ngForOf",t.calendarioPrint.dias)}}let A0=(()=>{class n{constructor(t,s,r,i,o){this.service=t,this.serviceRefeicoes=s,this.route=r,this.compressImage=i,this.router=o,this.isload=!1,this.id="",this.formRefeicoes='<label class="label-swal">Horas:<input id="hora-input" type="time" class="form-control" required></label><label class="label-swal">Refei\xe7\xe3o:<input id="comida-input" class="form-control" required></label><label class="label-swal">Foto:<input id="foto-input" type="file" accept="image/png, image/jpeg" class="form-control"></label>',this.formDia='<label class="label-swal">Dia:<input id="dia-input" type="number" min="1" max="31" class="form-control" required></label>'}ngOnInit(){this.route.paramMap.subscribe(t=>{this.id=t.params.id,this.updateList()})}createDia(){Fe().fire({title:"Novo Dia",html:this.formDia,confirmButtonText:"Salvar a Dia",focusConfirm:!1,preConfirm:()=>{const t=document.querySelector("#dia-input");t.value?(this.calendario.dias.push({nome:t.value,refeicoes:[]}),this.calendario.dias=this.calendario.dias.sort((s,r)=>parseInt(s.nome)-parseInt(r.nome)),this.service.createOrUpdate(this.calendario).then(()=>{this.updateList(),Fe().fire({icon:"success",title:"Dia Salvo"})})):Fe().showValidationMessage("Preencha todos os campos obrigat\xf3rios")}})}deleteDia(t){console.log("index",t),console.log("this.calendario.dias",this.calendario.dias),console.log("this.calendario.dias[index]",this.calendario.dias[t]),Fe().fire({title:"Deseja Deletar esse Dia?",showDenyButton:!0,confirmButtonText:"Sim",denyButtonText:"N\xe3o"}).then(s=>{s.isConfirmed&&(this.calendario.dias.splice(t,1),console.log("this.calendario.dias",this.calendario.dias),this.service.createOrUpdate(this.calendario).then(()=>{Fe().fire({icon:"success",title:"Refei\xe7\xe3o Deletada"}),this.updateList()}))})}createRefeicoes(t){Fe().fire({title:"Nova Refei\xe7\xe3o",html:this.formRefeicoes,confirmButtonText:"Salvar a Refei\xe7\xe3o",focusConfirm:!1,preConfirm:()=>{const s=document.querySelector("#hora-input"),r=document.querySelector("#comida-input"),i=document.querySelector("#foto-input");s.value&&r.value?this.saveRefeicoes({hora:s.value,prato:r.value,foto:i},t).subscribe(a=>{this.calendario.dias[t].refeicoes.push(a.id),this.service.createOrUpdate(this.calendario).then(()=>{this.updateList(),Fe().fire({icon:"success",title:"Refei\xe7\xe3o Salva"})})}):Fe().showValidationMessage("Preencha todos os campos obrigat\xf3rios")}})}deleteRefeicoes(t,s){Fe().fire({title:"Deseja Deletar essa refei\xe7\xe3o?",showDenyButton:!0,confirmButtonText:"Sim",denyButtonText:"N\xe3o"}).then(r=>{r.isConfirmed&&this.serviceRefeicoes.delete(this.calendarioPrint.dias[t].refeicoes[s].id).then(()=>{const i=this.calendario.dias[t].refeicoes.indexOf(o=>o.id==this.calendarioPrint.dias[t].refeicoes[s].id);console.log("indexDelete: ",i),this.calendario.dias[t].refeicoes.splice(i,1),this.service.createOrUpdate(this.calendario).then(()=>{Fe().fire({icon:"success",title:"Refei\xe7\xe3o Deletada"}),this.updateList()})})})}openImage(t){Fe().fire({html:`<img src="${t}">`,showConfirmButton:!1})}getBase64(t){return new Promise((s,r)=>{const i=new FileReader;i.readAsDataURL(t),i.onload=()=>s(i.result),i.onerror=o=>r(o)})}updateList(){this.isload=!1,this.service.get(this.id).subscribe(t=>{this.calendario=JSON.parse(JSON.stringify(t)),this.calendario.dias.length||(this.isload=!0),t.dias.forEach((s,r)=>{t.dias.length==r+1&&(this.calendarioPrint=JSON.parse(JSON.stringify(t)),this.isload=!0);let i=0;s.refeicoes.forEach((o,a)=>{this.serviceRefeicoes.get(o).subscribe(l=>{i++,s.refeicoes[a]=l,i==s.refeicoes.length&&(s.refeicoes=s.refeicoes.sort((h,f)=>parseInt(h.hora.replace(/[^0-9]/g,""))-parseInt(f.hora.replace(/[^0-9]/g,""))),this.calendarioPrint=JSON.parse(JSON.stringify(t)),this.isload=!0)})})})})}saveRefeicoes(t,s){return new At.y(r=>{t.foto.files[0]?this.compressImage.compress(t.foto.files[0]).pipe((0,ho.q)(1)).subscribe(i=>{console.log(`Image size after compressed: ${i.size} bytes.`),this.getBase64(i).then(o=>{t.foto=o,this.serviceRefeicoes.createOrUpdate(t).then(()=>{r.next(t)})})}):(t.foto="",this.serviceRefeicoes.createOrUpdate(t).then(()=>{r.next(t)}))})}}return n.\u0275fac=function(t){return new(t||n)(g.Y36(Kp),g.Y36(v0),g.Y36(_.gz),g.Y36(_0),g.Y36(_.F0))},n.\u0275cmp=g.Xpm({type:n,selectors:[["app-mes"]],decls:1,vars:1,consts:[[4,"ngIf"],["id","header-detail"],["routerLink","/"],["id","list-dia"],[4,"ngFor","ngForOf"],["id","newCard",3,"click"],[1,"fa-solid","fa-plus"],[3,"click"],[1,"fa-solid","fa-delete-left"],["class","item",4,"ngFor","ngForOf"],[1,"item"],[1,"fa-solid","fa-delete-right"],[1,"foto",3,"click"],[3,"src"],[1,"foto"]],template:function(t,s){1&t&&g.YNc(0,S0,11,3,"div",0),2&t&&g.Q6J("ngIf",s.isload)},dependencies:[ze.sg,ze.O5,_.rH],styles:["#list-dia[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:flex-start}#list-dia[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:calc(33.33% - 20px);margin:10px;border-radius:10px;overflow:hidden;background-color:#fff;border:solid 1px #dddddd;box-shadow:1px 1px 2px 1px #ddd;display:table}#list-dia[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > header[_ngcontent-%COMP%]{width:100%;text-align:center;font-weight:700;font-size:28px;padding:5px 10px;background-color:#ffc901;box-shadow:#0000004d 2px 0 5px 1px;position:relative}#list-dia[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:14px;color:#fff;box-shadow:#0000004d 2px 0 5px 1px;padding:3px 5px;background-color:#d20404;border-radius:50%;top:10px;right:20px;position:absolute}#list-dia[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:auto}#list-dia[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{padding:10px;border-bottom:solid 1px #dddddd;display:flex;align-items:flex-start}#list-dia[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{display:flex;width:30px;height:30px;border-radius:50%;color:#fff;align-items:center;justify-content:center;background:#d20404;text-shadow:1px 1px 1px black;margin-right:10px}#list-dia[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:calc(100% - 100px)}#list-dia[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .foto[_ngcontent-%COMP%]{flex:100px;width:100px;height:100px;background-color:gray;display:flex;align-items:center;justify-content:center;cursor:pointer}#list-dia[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .foto[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{min-width:100%;min-height:100%;max-width:none;max-height:none;width:100%;height:100%}#list-dia[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{display:table;margin-top:10px;padding:15px 5px;background-color:#ffedad;border:solid #ffc901 1px;color:#dd7d02;width:100%}#header-detail[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;align-items:center}#header-detail[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:28px}#header-detail[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{background:#ffedad;border:solid 1px #ffc901;color:#dd7f02;padding:5px 30px;margin:20px;border-radius:10px;text-decoration:none}@media (max-width: 1000px){#list-dia[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:calc(100% - 20px)}#list-dia[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:auto}#list-dia[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .foto[_ngcontent-%COMP%]{flex:50px;width:50px;height:50px}}"]}),n})(),k0=(()=>{class n extends Er{constructor(t){super(En,t,"meses")}}return n.\u0275fac=function(t){return new(t||n)(g.LFG(oh))},n.\u0275prov=g.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const D0=function(n){return[n]};function M0(n,e){if(1&n){const t=g.EpF();g.TgZ(0,"div")(1,"header")(2,"h2"),g._uU(3),g.TgZ(4,"span"),g._uU(5),g.qZA()()(),g.TgZ(6,"div")(7,"a",4),g._uU(8,"Entrar"),g.qZA(),g.TgZ(9,"button",5),g.NdJ("click",function(){const i=g.CHM(t).$implicit,o=g.oxw();return g.KtG(o.deleteMes(i.id))}),g._uU(10,"Deletar"),g.qZA(),g.TgZ(11,"button"),g._UZ(12,"i",6),g._uU(13,"Visto"),g.qZA()()()}if(2&n){const t=e.$implicit,s=g.oxw();g.xp6(3),g.hij("",s.convertMes(t.nome)," "),g.xp6(2),g.Oqu(t.ano),g.xp6(2),g.Q6J("routerLink",g.VKq(3,D0,"mes/"+t.calendario))}}const N0=[{path:"",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=g.Xpm({type:n,selectors:[["app-panel"]],decls:6,vars:0,consts:[["id","panel"],[1,"container"],["src","/dailyfood/assets/svg/logo.svg","alt","Daily Food"]],template:function(t,s){1&t&&(g.TgZ(0,"div",0)(1,"div")(2,"div",1)(3,"h1"),g._UZ(4,"img",2),g.qZA(),g._UZ(5,"router-outlet"),g.qZA()()())},dependencies:[_.lC],styles:["#panel[_ngcontent-%COMP%]{background-color:#ffc901;background-image:url(/dailyfood/assets/img/bg-food-30.png);background-size:260px;padding-top:70px}#panel[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;min-height:calc(100vh - 70px);background-color:#f1f1f1;border-radius:20px 20px 0 0;box-shadow:#0003 0 -5px 5px}#panel[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{width:160px;transform:translateY(-60px);margin:0 auto -40px}"]}),n})(),children:[{path:"",component:(()=>{class n{constructor(t,s){this.service=t,this.serviceCalendario=s,this.meses=[],this.refCalendaro={nome:"",ano:"",dias:[]}}ngOnInit(){this.updateList()}createMes(){Fe().fire({title:"Novo M\xeas",html:'\n        <label class="label-swal">\n          Dia:\n          <input id="mes-input" type="month" class="form-control">\n        </label>\n        ',confirmButtonText:"Salvar a Refei\xe7\xe3o",focusConfirm:!1,preConfirm:()=>{const t=document.querySelector("#mes-input");if(t.value){const s=t.value.split("-");this.refCalendaro.nome=s[1],this.refCalendaro.ano=s[0],this.serviceCalendario.createOrUpdate(this.refCalendaro).then(r=>{this.service.createOrUpdate({nome:s[1],ano:s[0],calendario:this.refCalendaro.id}).then(()=>{this.updateList()})})}else Fe().showValidationMessage("Preencha todos os campos obrigat\xf3rios")}})}deleteMes(t){this.service.get(t).subscribe(s=>{this.serviceCalendario.delete(s.calendario).then(()=>{this.service.delete(t).then(()=>{this.updateList()})})})}convertMes(t){return["Janeiro","Fevereiro","Mar\xe7o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"][t-1]}updateList(){this.service.list().subscribe(t=>{this.meses=t})}}return n.\u0275fac=function(t){return new(t||n)(g.Y36(k0),g.Y36(Kp))},n.\u0275cmp=g.Xpm({type:n,selectors:[["app-meses"]],decls:5,vars:1,consts:[["id","list-meses"],[4,"ngFor","ngForOf"],["id","newCard",3,"click"],[1,"fa-solid","fa-plus"],[3,"routerLink"],[3,"click"],[1,"fa-duotone","fa-toggle-large-on"]],template:function(t,s){1&t&&(g.TgZ(0,"div",0),g.YNc(1,M0,14,5,"div",1),g.TgZ(2,"button",2),g.NdJ("click",function(){return s.createMes()}),g._UZ(3,"i",3),g._uU(4," Adicionar Dia"),g.qZA()()),2&t&&(g.xp6(1),g.Q6J("ngForOf",s.meses))},dependencies:[ze.sg,_.rH],styles:["#list-meses[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}#list-meses[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:calc(25% - 20px);margin:10px;border-radius:10px;overflow:hidden;background-color:#fff;border:solid 1px #dddddd;box-shadow:1px 1px 2px 1px #ddd;display:table}#list-meses[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]{background-color:#ffc901;font-size:20px;padding:10px 15px;text-transform:uppercase;font-weight:700;box-shadow:#0000004d 0 2px 5px 1px}#list-meses[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.7em;opacity:.5}#list-meses[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:flex}#list-meses[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], #list-meses[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;width:33.333%;height:50px;align-items:center;justify-content:center;border-top:solid 1px transparent;border-left:solid 1px #dddddd;border-right:solid 1px #f1f1f1;text-decoration:none;color:#313131}#list-meses[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover:not(:last-child), #list-meses[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:last-child){background-color:#ffc901;color:#000;cursor:pointer;border-top:solid 1px white}#list-meses[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   a[_ngcontent-%COMP%] > i[_ngcontent-%COMP%], #list-meses[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] > i[_ngcontent-%COMP%]{font-size:2em;margin-right:10px;cursor:pointer}@media (max-width: 1000px){#list-meses[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:calc(50% - 20px)}}@media (max-width: 700px){#list-meses[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:calc(100% - 20px)}}"]}),n})()},{path:"mes/:id",component:A0}]},{path:"**",redirectTo:""}];let P0=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=g.oAB({type:n}),n.\u0275inj=g.cJS({imports:[_.Bz.forChild(N0),_.Bz]}),n})(),O0=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=g.oAB({type:n}),n.\u0275inj=g.cJS({imports:[ze.ez,P0]}),n})()},5226:function(ah){ah.exports=function(){"use strict";var B={awaitingPromise:new WeakMap,promise:new WeakMap,innerParams:new WeakMap,domCache:new WeakMap};const ze=c=>{const u={};for(const d in c)u[c[d]]="swal2-"+c[d];return u},_=ze(["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","default-outline","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error"]),At=ze(["success","warning","info","question","error"]),ho="SweetAlert2:",Fe=c=>c.charAt(0).toUpperCase()+c.slice(1),g=c=>{console.warn(`${ho} ${"object"==typeof c?c.join(" "):c}`)},Ie=c=>{console.error(`${ho} ${c}`)},j=[],je=(c,u)=>{(c=>{j.includes(c)||(j.push(c),g(c))})(`"${c}" is deprecated and will be removed in the next major release. Please use "${u}" instead.`)},ms=c=>"function"==typeof c?c():c,Tr=c=>c&&"function"==typeof c.toPromise,In=c=>Tr(c)?c.toPromise():Promise.resolve(c),wt=c=>c&&Promise.resolve(c)===c,fe=()=>document.body.querySelector(`.${_.container}`),Cn=c=>{const u=fe();return u?u.querySelector(c):null},re=c=>Cn(`.${c}`),X=()=>re(_.popup),gs=()=>re(_.icon),fo=()=>re(_.title),Ir=()=>re(_["html-container"]),oc=()=>re(_.image),po=()=>re(_["progress-steps"]),Cr=()=>re(_["validation-message"]),ct=()=>Cn(`.${_.actions} .${_.confirm}`),zt=()=>Cn(`.${_.actions} .${_.cancel}`),kt=()=>Cn(`.${_.actions} .${_.deny}`),vt=()=>Cn(`.${_.loader}`),En=()=>re(_.actions),mo=()=>re(_.footer),ys=()=>re(_["timer-progress-bar"]),Sr=()=>re(_.close),vs=()=>{const c=Array.from(X().querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])')).sort((d,m)=>{const T=parseInt(d.getAttribute("tabindex")),F=parseInt(m.getAttribute("tabindex"));return T>F?1:T<F?-1:0}),u=Array.from(X().querySelectorAll('\n  a[href],\n  area[href],\n  input:not([disabled]),\n  select:not([disabled]),\n  textarea:not([disabled]),\n  button:not([disabled]),\n  iframe,\n  object,\n  embed,\n  [tabindex="0"],\n  [contenteditable],\n  audio[controls],\n  video[controls],\n  summary\n')).filter(d=>"-1"!==d.getAttribute("tabindex"));return(c=>{const u=[];for(let d=0;d<c.length;d++)-1===u.indexOf(c[d])&&u.push(c[d]);return u})(c.concat(u)).filter(d=>Ve(d))},$e=()=>rt(document.body,_.shown)&&!rt(document.body,_["toast-shown"])&&!rt(document.body,_["no-backdrop"]),Ht=()=>X()&&rt(X(),_.toast),Qt={previousBodyPadding:null},Re=(c,u)=>{if(c.textContent="",u){const m=(new DOMParser).parseFromString(u,"text/html");Array.from(m.querySelector("head").childNodes).forEach(T=>{c.appendChild(T)}),Array.from(m.querySelector("body").childNodes).forEach(T=>{T instanceof HTMLVideoElement||T instanceof HTMLAudioElement?c.appendChild(T.cloneNode(!0)):c.appendChild(T)})}},rt=(c,u)=>{if(!u)return!1;const d=u.split(/\s+/);for(let m=0;m<d.length;m++)if(!c.classList.contains(d[m]))return!1;return!0},He=(c,u,d)=>{if(((c,u)=>{Array.from(c.classList).forEach(d=>{!Object.values(_).includes(d)&&!Object.values(At).includes(d)&&!Object.values(u.showClass).includes(d)&&c.classList.remove(d)})})(c,u),u.customClass&&u.customClass[d]){if("string"!=typeof u.customClass[d]&&!u.customClass[d].forEach)return void g(`Invalid type of customClass.${d}! Expected string or iterable object, got "${typeof u.customClass[d]}"`);w(c,u.customClass[d])}},Zt=(c,u)=>{if(!u)return null;switch(u){case"select":case"textarea":case"file":return c.querySelector(`.${_.popup} > .${_[u]}`);case"checkbox":return c.querySelector(`.${_.popup} > .${_.checkbox} input`);case"radio":return c.querySelector(`.${_.popup} > .${_.radio} input:checked`)||c.querySelector(`.${_.popup} > .${_.radio} input:first-child`);case"range":return c.querySelector(`.${_.popup} > .${_.range} input`);default:return c.querySelector(`.${_.popup} > .${_.input}`)}},uc=c=>{if(c.focus(),"file"!==c.type){const u=c.value;c.value="",c.value=u}},go=(c,u,d)=>{!c||!u||("string"==typeof u&&(u=u.split(/\s+/).filter(Boolean)),u.forEach(m=>{Array.isArray(c)?c.forEach(T=>{d?T.classList.add(m):T.classList.remove(m)}):d?c.classList.add(m):c.classList.remove(m)}))},w=(c,u)=>{go(c,u,!0)},Qe=(c,u)=>{go(c,u,!1)},pt=(c,u)=>{const d=Array.from(c.children);for(let m=0;m<d.length;m++){const T=d[m];if(T instanceof HTMLElement&&rt(T,u))return T}},Je=(c,u,d)=>{d===`${parseInt(d)}`&&(d=parseInt(d)),d||0===parseInt(d)?c.style[u]="number"==typeof d?`${d}px`:d:c.style.removeProperty(u)},q=function(c){c.style.display=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flex"},De=c=>{c.style.display="none"},ut=(c,u,d,m)=>{const T=c.querySelector(u);T&&(T.style[d]=m)},N=function(c,u){u?q(c,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"flex"):De(c)},Ve=c=>!(!c||!(c.offsetWidth||c.offsetHeight||c.getClientRects().length)),Sn=c=>c.scrollHeight>c.clientHeight,An=c=>{const u=window.getComputedStyle(c),d=parseFloat(u.getPropertyValue("animation-duration")||"0"),m=parseFloat(u.getPropertyValue("transition-duration")||"0");return d>0||m>0},Dt=function(c){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const d=ys();Ve(d)&&(u&&(d.style.transition="none",d.style.width="100%"),setTimeout(()=>{d.style.transition=`width ${c/1e3}s linear`,d.style.width="0%"},10))},G={},dc=c=>new Promise(u=>{if(!c)return u();const d=window.scrollX,m=window.scrollY;G.restoreFocusTimeout=setTimeout(()=>{G.previousActiveElement instanceof HTMLElement?(G.previousActiveElement.focus(),G.previousActiveElement=null):document.body&&document.body.focus(),u()},100),window.scrollTo(d,m)}),Ce=()=>typeof window>"u"||typeof document>"u",bs=`\n <div aria-labelledby="${_.title}" aria-describedby="${_["html-container"]}" class="${_.popup}" tabindex="-1">\n   <button type="button" class="${_.close}"></button>\n   <ul class="${_["progress-steps"]}"></ul>\n   <div class="${_.icon}"></div>\n   <img class="${_.image}" />\n   <h2 class="${_.title}" id="${_.title}"></h2>\n   <div class="${_["html-container"]}" id="${_["html-container"]}"></div>\n   <input class="${_.input}" />\n   <input type="file" class="${_.file}" />\n   <div class="${_.range}">\n     <input type="range" />\n     <output></output>\n   </div>\n   <select class="${_.select}"></select>\n   <div class="${_.radio}"></div>\n   <label for="${_.checkbox}" class="${_.checkbox}">\n     <input type="checkbox" />\n     <span class="${_.label}"></span>\n   </label>\n   <textarea class="${_.textarea}"></textarea>\n   <div class="${_["validation-message"]}" id="${_["validation-message"]}"></div>\n   <div class="${_.actions}">\n     <div class="${_.loader}"></div>\n     <button type="button" class="${_.confirm}"></button>\n     <button type="button" class="${_.deny}"></button>\n     <button type="button" class="${_.cancel}"></button>\n   </div>\n   <div class="${_.footer}"></div>\n   <div class="${_["timer-progress-bar-container"]}">\n     <div class="${_["timer-progress-bar"]}"></div>\n   </div>\n </div>\n`.replace(/(^|\n)\s*/g,""),Ke=()=>{G.currentInstance.resetValidationMessage()},Me=c=>{const u=(()=>{const c=fe();return!!c&&(c.remove(),Qe([document.documentElement,document.body],[_["no-backdrop"],_["toast-shown"],_["has-column"]]),!0)})();if(Ce())return void Ie("SweetAlert2 requires document to initialize");const d=document.createElement("div");d.className=_.container,u&&w(d,_["no-transition"]),Re(d,bs);const m=(c=>"string"==typeof c?document.querySelector(c):c)(c.target);m.appendChild(d),(c=>{const u=X();u.setAttribute("role",c.toast?"alert":"dialog"),u.setAttribute("aria-live",c.toast?"polite":"assertive"),c.toast||u.setAttribute("aria-modal","true")})(c),(c=>{"rtl"===window.getComputedStyle(c).direction&&w(fe(),_.rtl)})(m),(()=>{const c=X(),u=pt(c,_.input),d=pt(c,_.file),m=c.querySelector(`.${_.range} input`),T=c.querySelector(`.${_.range} output`),F=pt(c,_.select),ee=c.querySelector(`.${_.checkbox} input`),Ge=pt(c,_.textarea);u.oninput=Ke,d.onchange=Ke,F.onchange=Ke,ee.onchange=Ke,Ge.oninput=Ke,m.oninput=()=>{Ke(),T.value=m.value},m.onchange=()=>{Ke(),T.value=m.value}})()},Dr=(c,u)=>{c instanceof HTMLElement?u.appendChild(c):"object"==typeof c?xs(c,u):c&&Re(u,c)},xs=(c,u)=>{c.jquery?vo(u,c):Re(u,c.toString())},vo=(c,u)=>{if(c.textContent="",0 in u)for(let d=0;d in u;d++)c.appendChild(u[d].cloneNode(!0));else c.appendChild(u.cloneNode(!0))},Mt=(()=>{if(Ce())return!1;const c=document.createElement("div"),u={WebkitAnimation:"webkitAnimationEnd",animation:"animationend"};for(const d in u)if(Object.prototype.hasOwnProperty.call(u,d)&&typeof c.style[d]<"u")return u[d];return!1})(),lt=(c,u)=>{const d=En(),m=vt();u.showConfirmButton||u.showDenyButton||u.showCancelButton?q(d):De(d),He(d,u,"actions"),function Mr(c,u,d){const m=ct(),T=kt(),F=zt();Nr(m,"confirm",d),Nr(T,"deny",d),Nr(F,"cancel",d),function pc(c,u,d,m){m.buttonsStyling?(w([c,u,d],_.styled),m.confirmButtonColor&&(c.style.backgroundColor=m.confirmButtonColor,w(c,_["default-outline"])),m.denyButtonColor&&(u.style.backgroundColor=m.denyButtonColor,w(u,_["default-outline"])),m.cancelButtonColor&&(d.style.backgroundColor=m.cancelButtonColor,w(d,_["default-outline"]))):Qe([c,u,d],_.styled)}(m,T,F,d),d.reverseButtons&&(d.toast?(c.insertBefore(F,m),c.insertBefore(T,m)):(c.insertBefore(F,u),c.insertBefore(T,u),c.insertBefore(m,u)))}(d,m,u),Re(m,u.loaderHtml),He(m,u,"loader")};function Nr(c,u,d){N(c,d[`show${Fe(u)}Button`],"inline-block"),Re(c,d[`${u}ButtonText`]),c.setAttribute("aria-label",d[`${u}ButtonAriaLabel`]),c.className=_[u],He(c,d,`${u}Button`),w(c,d[`${u}ButtonClass`])}const bo=(c,u)=>{const d=fe();d&&(function Pr(c,u){"string"==typeof u?c.style.background=u:u||w([document.documentElement,document.body],_["no-backdrop"])}(d,u.backdrop),function xo(c,u){u in _?w(c,_[u]):(g('The "position" parameter is not valid, defaulting to "center"'),w(c,_.center))}(d,u.position),function mc(c,u){if(u&&"string"==typeof u){const d=`grow-${u}`;d in _&&w(c,_[d])}}(d,u.grow),He(d,u,"container"))};const _o=["input","file","range","select","radio","checkbox","textarea"],Or=c=>{if(!xe[c.input])return void Ie(`Unexpected type of input! Expected "text", "email", "password", "number", "tel", "select", "radio", "checkbox", "textarea", "file" or "url", got "${c.input}"`);const u=Vr(c.input),d=xe[c.input](u,c);q(u),c.inputAutoFocus&&setTimeout(()=>{uc(d)})},Fr=(c,u)=>{const d=Zt(X(),c);if(d){(c=>{for(let u=0;u<c.attributes.length;u++){const d=c.attributes[u].name;["type","value","style"].includes(d)||c.removeAttribute(d)}})(d);for(const m in u)d.setAttribute(m,u[m])}},gc=c=>{const u=Vr(c.input);"object"==typeof c.customClass&&w(u,c.customClass.input)},Rr=(c,u)=>{(!c.placeholder||u.inputPlaceholder)&&(c.placeholder=u.inputPlaceholder)},Nt=(c,u,d)=>{if(d.inputLabel){c.id=_.input;const m=document.createElement("label"),T=_["input-label"];m.setAttribute("for",c.id),m.className=T,"object"==typeof d.customClass&&w(m,d.customClass.inputLabel),m.innerText=d.inputLabel,u.insertAdjacentElement("beforebegin",m)}},Vr=c=>pt(X(),_[c]||_.input),Is=(c,u)=>{["string","number"].includes(typeof u)?c.value=`${u}`:wt(u)||g(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof u}"`)},xe={};xe.text=xe.email=xe.password=xe.number=xe.tel=xe.url=(c,u)=>(Is(c,u.inputValue),Nt(c,c,u),Rr(c,u),c.type=u.input,c),xe.file=(c,u)=>(Nt(c,c,u),Rr(c,u),c),xe.range=(c,u)=>{const d=c.querySelector("input"),m=c.querySelector("output");return Is(d,u.inputValue),d.type=u.input,Is(m,u.inputValue),Nt(d,c,u),c},xe.select=(c,u)=>{if(c.textContent="",u.inputPlaceholder){const d=document.createElement("option");Re(d,u.inputPlaceholder),d.value="",d.disabled=!0,d.selected=!0,c.appendChild(d)}return Nt(c,c,u),c},xe.radio=c=>(c.textContent="",c),xe.checkbox=(c,u)=>{const d=Zt(X(),"checkbox");d.value="1",d.id=_.checkbox,d.checked=Boolean(u.inputValue);const m=c.querySelector("span");return Re(m,u.inputPlaceholder),d},xe.textarea=(c,u)=>{Is(c,u.inputValue),Rr(c,u),Nt(c,c,u);return setTimeout(()=>{if("MutationObserver"in window){const m=parseInt(window.getComputedStyle(X()).width);new MutationObserver(()=>{const F=c.offsetWidth+(m=>parseInt(window.getComputedStyle(m).marginLeft)+parseInt(window.getComputedStyle(m).marginRight))(c);X().style.width=F>m?`${F}px`:null}).observe(c,{attributes:!0,attributeFilter:["style"]})}}),c};const yc=(c,u)=>{const d=Ir();He(d,u,"htmlContainer"),u.html?(Dr(u.html,d),q(d,"block")):u.text?(d.textContent=u.text,q(d,"block")):De(d),((c,u)=>{const d=X(),m=B.innerParams.get(c),T=!m||u.input!==m.input;_o.forEach(F=>{const ee=pt(d,_[F]);Fr(F,u.inputAttributes),ee.className=_[F],T&&De(ee)}),u.input&&(T&&Or(u),gc(u))})(c,u)},To=(c,u)=>{for(const d in At)u.icon!==d&&Qe(c,At[d]);w(c,At[u.icon]),Co(c,u),Cs(),He(c,u,"icon")},Cs=()=>{const c=X(),u=window.getComputedStyle(c).getPropertyValue("background-color"),d=c.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let m=0;m<d.length;m++)d[m].style.backgroundColor=u},qr=(c,u)=>{let m,d=c.innerHTML;u.iconHtml?m=Dn(u.iconHtml):"success"===u.icon?(m='\n  <div class="swal2-success-circular-line-left"></div>\n  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>\n  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>\n  <div class="swal2-success-circular-line-right"></div>\n',d=d.replace(/ style=".*?"/g,"")):m="error"===u.icon?'\n  <span class="swal2-x-mark">\n    <span class="swal2-x-mark-line-left"></span>\n    <span class="swal2-x-mark-line-right"></span>\n  </span>\n':Dn({question:"?",warning:"!",info:"i"}[u.icon]),d.trim()!==m.trim()&&Re(c,m)},Co=(c,u)=>{if(u.iconColor){c.style.color=u.iconColor,c.style.borderColor=u.iconColor;for(const d of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])ut(c,d,"backgroundColor",u.iconColor);ut(c,".swal2-success-ring","borderColor",u.iconColor)}},Dn=c=>`<div class="${_["icon-content"]}">${c}</div>`,$r=(c,u)=>{c.className=`${_.popup} ${Ve(c)?u.showClass.popup:""}`,u.toast?(w([document.documentElement,document.body],_["toast-shown"]),w(c,_.toast)):w(c,_.modal),He(c,u,"popup"),"string"==typeof u.customClass&&w(c,u.customClass),u.icon&&w(c,_[`icon-${u.icon}`])},Eo=c=>{const u=document.createElement("li");return w(u,_["progress-step"]),Re(u,c),u},So=c=>{const u=document.createElement("li");return w(u,_["progress-step-line"]),c.progressStepsDistance&&Je(u,"width",c.progressStepsDistance),u},Gr=(c,u)=>{((c,u)=>{const d=fe(),m=X();u.toast?(Je(d,"width",u.width),m.style.width="100%",m.insertBefore(vt(),gs())):Je(m,"width",u.width),Je(m,"padding",u.padding),u.color&&(m.style.color=u.color),u.background&&(m.style.background=u.background),De(Cr()),$r(m,u)})(0,u),bo(0,u),((c,u)=>{const d=po();u.progressSteps&&0!==u.progressSteps.length?(q(d),d.textContent="",u.currentProgressStep>=u.progressSteps.length&&g("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),u.progressSteps.forEach((m,T)=>{const F=Eo(m);if(d.appendChild(F),T===u.currentProgressStep&&w(F,_["active-progress-step"]),T!==u.progressSteps.length-1){const ee=So(u);d.appendChild(ee)}})):De(d)})(0,u),((c,u)=>{const d=B.innerParams.get(c),m=gs();d&&u.icon===d.icon?(qr(m,u),To(m,u)):u.icon||u.iconHtml?u.icon&&-1===Object.keys(At).indexOf(u.icon)?(Ie(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${u.icon}"`),De(m)):(q(m),qr(m,u),To(m,u),w(m,u.showClass.icon)):De(m)})(c,u),((c,u)=>{const d=oc();u.imageUrl?(q(d,""),d.setAttribute("src",u.imageUrl),d.setAttribute("alt",u.imageAlt),Je(d,"width",u.imageWidth),Je(d,"height",u.imageHeight),d.className=_.image,He(d,u,"image")):De(d)})(0,u),((c,u)=>{const d=fo();N(d,u.title||u.titleText,"block"),u.title&&Dr(u.title,d),u.titleText&&(d.innerText=u.titleText),He(d,u,"title")})(0,u),((c,u)=>{const d=Sr();Re(d,u.closeButtonHtml),He(d,u,"closeButton"),N(d,u.showCloseButton),d.setAttribute("aria-label",u.closeButtonAriaLabel)})(0,u),yc(c,u),lt(0,u),((c,u)=>{const d=mo();N(d,u.footer),u.footer&&Dr(u.footer,d),He(d,u,"footer")})(0,u),"function"==typeof u.didRender&&u.didRender(X())};function zr(){const c=B.innerParams.get(this);if(!c)return;const u=B.domCache.get(this);De(u.loader),Ht()?c.icon&&q(gs()):Hr(u),Qe([u.popup,u.actions],_.loading),u.popup.removeAttribute("aria-busy"),u.popup.removeAttribute("data-loading"),u.confirmButton.disabled=!1,u.denyButton.disabled=!1,u.cancelButton.disabled=!1}const Hr=c=>{const u=c.popup.getElementsByClassName(c.loader.getAttribute("data-button-to-replace"));u.length?q(u[0],"inline-block"):!Ve(ct())&&!Ve(kt())&&!Ve(zt())&&De(c.actions)};const Es=()=>ct()&&ct().click(),ie=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),_e=c=>{c.keydownTarget&&c.keydownHandlerAdded&&(c.keydownTarget.removeEventListener("keydown",c.keydownHandler,{capture:c.keydownListenerCapture}),c.keydownHandlerAdded=!1)},Mn=(c,u)=>{const d=vs();if(d.length)return(c+=u)===d.length?c=0:-1===c&&(c=d.length-1),void d[c].focus();X().focus()},ko=["ArrowRight","ArrowDown"],xc=["ArrowLeft","ArrowUp"],Do=(c,u,d)=>{const m=B.innerParams.get(c);m&&(u.isComposing||229===u.keyCode||(m.stopKeydownPropagation&&u.stopPropagation(),"Enter"===u.key?_c(c,u,m):"Tab"===u.key?Tc(u):[...ko,...xc].includes(u.key)?Mo(u.key):"Escape"===u.key&&Wr(u,m,d)))},_c=(c,u,d)=>{if(ms(d.allowEnterKey)&&u.target&&c.getInput()&&u.target instanceof HTMLElement&&u.target.outerHTML===c.getInput().outerHTML){if(["textarea","file"].includes(d.input))return;Es(),u.preventDefault()}},Tc=c=>{const u=c.target,d=vs();let m=-1;for(let T=0;T<d.length;T++)if(u===d[T]){m=T;break}Mn(m,c.shiftKey?-1:1),c.stopPropagation(),c.preventDefault()},Mo=c=>{const u=ct(),d=kt(),m=zt();if(document.activeElement instanceof HTMLElement&&![u,d,m].includes(document.activeElement))return;const F=ko.includes(c)?"nextElementSibling":"previousElementSibling";let ee=document.activeElement;for(let Ge=0;Ge<En().children.length;Ge++){if(ee=ee[F],!ee)return;if(ee instanceof HTMLButtonElement&&Ve(ee))break}ee instanceof HTMLButtonElement&&ee.focus()},Wr=(c,u,d)=>{ms(u.allowEscapeKey)&&(c.preventDefault(),d(ie.esc))};var Nn={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const Yr=()=>{Array.from(document.body.children).forEach(u=>{u.hasAttribute("data-previous-aria-hidden")?(u.setAttribute("aria-hidden",u.getAttribute("data-previous-aria-hidden")),u.removeAttribute("data-previous-aria-hidden")):u.removeAttribute("aria-hidden")})},As=()=>{const c=navigator.userAgent,u=!!c.match(/iPad/i)||!!c.match(/iPhone/i),d=!!c.match(/WebKit/i);u&&d&&!c.match(/CriOS/i)&&X().scrollHeight>window.innerHeight-44&&(fe().style.paddingBottom="44px")},Jr=()=>{const c=fe();let u;c.ontouchstart=d=>{u=ei(d)},c.ontouchmove=d=>{u&&(d.preventDefault(),d.stopPropagation())}},ei=c=>{const u=c.target,d=fe();return!No(c)&&!Cc(c)&&(u===d||!Sn(d)&&u instanceof HTMLElement&&"INPUT"!==u.tagName&&"TEXTAREA"!==u.tagName&&!(Sn(Ir())&&Ir().contains(u)))},No=c=>c.touches&&c.touches.length&&"stylus"===c.touches[0].touchType,Cc=c=>c.touches&&c.touches.length>1,Pn=()=>{if(rt(document.body,_.iosfix)){const c=parseInt(document.body.style.top,10);Qe(document.body,_.iosfix),document.body.style.top="",document.body.scrollTop=-1*c}},Po=()=>{null===Qt.previousBodyPadding&&document.body.scrollHeight>window.innerHeight&&(Qt.previousBodyPadding=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${Qt.previousBodyPadding+(()=>{const c=document.createElement("div");c.className=_["scrollbar-measure"],document.body.appendChild(c);const u=c.getBoundingClientRect().width-c.clientWidth;return document.body.removeChild(c),u})()}px`)},Oo=()=>{null!==Qt.previousBodyPadding&&(document.body.style.paddingRight=`${Qt.previousBodyPadding}px`,Qt.previousBodyPadding=null)};function ti(c,u,d,m){Ht()?ni(c,m):(dc(d).then(()=>ni(c,m)),_e(G)),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?(u.setAttribute("style","display:none !important"),u.removeAttribute("class"),u.innerHTML=""):u.remove(),$e()&&(Oo(),Pn(),Yr()),function ks(){Qe([document.documentElement,document.body],[_.shown,_["height-auto"],_["no-backdrop"],_["toast-shown"]])}()}function Ds(c){c=Pt(c);const u=Nn.swalPromiseResolve.get(this),d=Xt(this);this.isAwaitingPromise()?c.isDismissed||(On(this),u(c)):d&&u(c)}const Xt=c=>{const u=X();if(!u)return!1;const d=B.innerParams.get(c);if(!d||rt(u,d.hideClass.popup))return!1;Qe(u,d.showClass.popup),w(u,d.hideClass.popup);const m=fe();return Qe(m,d.showClass.backdrop),w(m,d.hideClass.backdrop),Lo(c,u,d),!0};const On=c=>{c.isAwaitingPromise()&&(B.awaitingPromise.delete(c),B.innerParams.get(c)||c._destroy())},Pt=c=>typeof c>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},c),Lo=(c,u,d)=>{const m=fe(),T=Mt&&An(u);"function"==typeof d.willClose&&d.willClose(u),T?Ms(c,u,m,d.returnFocus,d.didClose):ti(c,m,d.returnFocus,d.didClose)},Ms=(c,u,d,m,T)=>{G.swalCloseEventFinishedCallback=ti.bind(null,c,d,m,T),u.addEventListener(Mt,function(F){F.target===u&&(G.swalCloseEventFinishedCallback(),delete G.swalCloseEventFinishedCallback)})},ni=(c,u)=>{setTimeout(()=>{"function"==typeof u&&u.bind(c.params)(),c._destroy()})};function Yt(c,u,d){const m=B.domCache.get(c);u.forEach(T=>{m[T].disabled=d})}function si(c,u){if(c)if("radio"===c.type){const m=c.parentNode.parentNode.querySelectorAll("input");for(let T=0;T<m.length;T++)m[T].disabled=u}else c.disabled=u}const Ot={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0},Vo=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","willClose"],Fn={},ii=["allowOutsideClick","allowEnterKey","backdrop","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],Ps=c=>Object.prototype.hasOwnProperty.call(Ot,c),Os=c=>-1!==Vo.indexOf(c),Jt=c=>Fn[c],Rn=c=>{Ps(c)||g(`Unknown parameter "${c}"`)},Bo=c=>{ii.includes(c)&&g(`The parameter "${c}" is incompatible with toasts`)},Ac=c=>{Jt(c)&&je(c,Jt(c))};const ai=c=>{const u={};return Object.keys(c).forEach(d=>{Os(d)?u[d]=c[d]:g(`Invalid parameter to update: ${d}`)}),u};const Uo=c=>{ci(c),delete c.params,delete G.keydownHandler,delete G.keydownTarget,delete G.currentInstance},ci=c=>{c.isAwaitingPromise()?(ui(B,c),B.awaitingPromise.set(c,!0)):(ui(Nn,c),ui(B,c))},ui=(c,u)=>{for(const d in c)c[d].delete(u)};var en=Object.freeze({__proto__:null,_destroy:function qo(){const c=B.domCache.get(this),u=B.innerParams.get(this);u?(c.popup&&G.swalCloseEventFinishedCallback&&(G.swalCloseEventFinishedCallback(),delete G.swalCloseEventFinishedCallback),"function"==typeof u.didDestroy&&u.didDestroy(),Uo(this)):ci(this)},close:Ds,closeModal:Ds,closePopup:Ds,closeToast:Ds,disableButtons:function Fo(){Yt(this,["confirmButton","denyButton","cancelButton"],!0)},disableInput:function Ns(){si(this.getInput(),!0)},disableLoading:zr,enableButtons:function Be(){Yt(this,["confirmButton","denyButton","cancelButton"],!1)},enableInput:function Ln(){si(this.getInput(),!1)},getInput:function Ao(c){const u=B.innerParams.get(c||this),d=B.domCache.get(c||this);return d?Zt(d.popup,u.input):null},handleAwaitingPromise:On,hideLoading:zr,isAwaitingPromise:function Ec(){return!!B.awaitingPromise.get(this)},rejectPromise:function Sc(c){const u=Nn.swalPromiseReject.get(this);On(this),u&&u(c)},resetValidationMessage:function ri(){const c=B.domCache.get(this);c.validationMessage&&De(c.validationMessage);const u=this.getInput();u&&(u.removeAttribute("aria-invalid"),u.removeAttribute("aria-describedby"),Qe(u,_.inputerror))},showValidationMessage:function Ro(c){const u=B.domCache.get(this),d=B.innerParams.get(this);Re(u.validationMessage,c),u.validationMessage.className=_["validation-message"],d.customClass&&d.customClass.validationMessage&&w(u.validationMessage,d.customClass.validationMessage),q(u.validationMessage);const m=this.getInput();m&&(m.setAttribute("aria-invalid",!0),m.setAttribute("aria-describedby",_["validation-message"]),uc(m),w(m,_.inputerror))},update:function Ls(c){const u=X(),d=B.innerParams.get(this);if(!u||rt(u,d.hideClass.popup))return void g("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");const m=ai(c),T=Object.assign({},d,m);Gr(this,T),B.innerParams.set(this,T),Object.defineProperties(this,{params:{value:Object.assign({},this.params,c),writable:!1,enumerable:!0}})}});const Lt=c=>{let u=X();u||new xt,u=X();const d=vt();Ht()?De(gs()):Fs(u,c),q(d),u.setAttribute("data-loading","true"),u.setAttribute("aria-busy","true"),u.focus()},Fs=(c,u)=>{const d=En(),m=vt();!u&&Ve(ct())&&(u=ct()),q(d),u&&(De(u),m.setAttribute("data-button-to-replace",u.className)),m.parentNode.insertBefore(m,u),w([c,d],_.loading)},li=c=>c.checked?1:0,kc=c=>c.checked?c.value:null,Dc=c=>c.files.length?null!==c.getAttribute("multiple")?c.files:c.files[0]:null,jo=(c,u)=>{const d=X(),m=T=>{Mc[u.input](d,mt(T),u)};Tr(u.inputOptions)||wt(u.inputOptions)?(Lt(ct()),In(u.inputOptions).then(T=>{c.hideLoading(),m(T)})):"object"==typeof u.inputOptions?m(u.inputOptions):Ie("Unexpected type of inputOptions! Expected object, Map or Promise, got "+typeof u.inputOptions)},$o=(c,u)=>{const d=c.getInput();De(d),In(u.inputValue).then(m=>{d.value="number"===u.input?`${parseFloat(m)||0}`:`${m}`,q(d),d.focus(),c.hideLoading()}).catch(m=>{Ie(`Error in inputValue promise: ${m}`),d.value="",q(d),d.focus(),c.hideLoading()})},Mc={select:(c,u,d)=>{const m=pt(c,_.select),T=(F,ee,Ge)=>{const pe=document.createElement("option");pe.value=Ge,Re(pe,ee),pe.selected=ht(Ge,d.inputValue),F.appendChild(pe)};u.forEach(F=>{const ee=F[0],Ge=F[1];if(Array.isArray(Ge)){const pe=document.createElement("optgroup");pe.label=ee,pe.disabled=!1,m.appendChild(pe),Ge.forEach(Bt=>T(pe,Bt[1],Bt[0]))}else T(m,Ge,ee)}),m.focus()},radio:(c,u,d)=>{const m=pt(c,_.radio);u.forEach(F=>{const ee=F[0],Ge=F[1],pe=document.createElement("input"),Bt=document.createElement("label");pe.type="radio",pe.name=_.radio,pe.value=ee,ht(ee,d.inputValue)&&(pe.checked=!0);const Hs=document.createElement("span");Re(Hs,Ge),Hs.className=_.label,Bt.appendChild(pe),Bt.appendChild(Hs),m.appendChild(Bt)});const T=m.querySelectorAll("input");T.length&&T[0].focus()}},mt=c=>{const u=[];return typeof Map<"u"&&c instanceof Map?c.forEach((d,m)=>{let T=d;"object"==typeof T&&(T=mt(T)),u.push([m,T])}):Object.keys(c).forEach(d=>{let m=c[d];"object"==typeof m&&(m=mt(m)),u.push([d,m])}),u},ht=(c,u)=>u&&u.toString()===c.toString(),se=(c,u)=>{const d=B.innerParams.get(c);if(!d.input)return void Ie(`The "input" parameter is needed to be set when using returnInputValueOn${Fe(u)}`);const m=((c,u)=>{const d=c.getInput();if(!d)return null;switch(u.input){case"checkbox":return li(d);case"radio":return kc(d);case"file":return Dc(d);default:return u.inputAutoTrim?d.value.trim():d.value}})(c,d);d.inputValidator?Bs(c,m,u):c.getInput().checkValidity()?"deny"===u?Rt(c,m):qs(c,m):(c.enableButtons(),c.showValidationMessage(d.validationMessage))},Bs=(c,u,d)=>{const m=B.innerParams.get(c);c.disableInput(),Promise.resolve().then(()=>In(m.inputValidator(u,m.validationMessage))).then(F=>{c.enableButtons(),c.enableInput(),F?c.showValidationMessage(F):"deny"===d?Rt(c,u):qs(c,u)})},Rt=(c,u)=>{const d=B.innerParams.get(c||void 0);d.showLoaderOnDeny&&Lt(kt()),d.preDeny?(B.awaitingPromise.set(c||void 0,!0),Promise.resolve().then(()=>In(d.preDeny(u,d.validationMessage))).then(T=>{!1===T?(c.hideLoading(),On(c)):c.close({isDenied:!0,value:typeof T>"u"?u:T})}).catch(T=>Go(c||void 0,T))):c.close({isDenied:!0,value:u})},tn=(c,u)=>{c.close({isConfirmed:!0,value:u})},Go=(c,u)=>{c.rejectPromise(u)},qs=(c,u)=>{const d=B.innerParams.get(c||void 0);d.showLoaderOnConfirm&&Lt(),d.preConfirm?(c.resetValidationMessage(),B.awaitingPromise.set(c||void 0,!0),Promise.resolve().then(()=>In(d.preConfirm(u,d.validationMessage))).then(T=>{Ve(Cr())||!1===T?(c.hideLoading(),On(c)):tn(c,typeof T>"u"?u:T)}).catch(T=>Go(c||void 0,T))):tn(c,u)},Pc=(c,u,d)=>{u.popup.onclick=()=>{const m=B.innerParams.get(c);m&&(Oc(m)||m.timer||m.input)||d(ie.close)}},Oc=c=>c.showConfirmButton||c.showDenyButton||c.showCancelButton||c.showCloseButton;let Us=!1;const Bn=c=>{c.popup.onmousedown=()=>{c.container.onmouseup=function(u){c.container.onmouseup=void 0,u.target===c.container&&(Us=!0)}}},bt=c=>{c.container.onmousedown=()=>{c.popup.onmouseup=function(u){c.popup.onmouseup=void 0,(u.target===c.popup||c.popup.contains(u.target))&&(Us=!0)}}},zo=(c,u,d)=>{u.container.onclick=m=>{const T=B.innerParams.get(c);Us?Us=!1:m.target===u.container&&ms(T.allowOutsideClick)&&d(ie.backdrop)}},hi=c=>c instanceof Element||(c=>"object"==typeof c&&c.jquery)(c);const Zo=()=>{if(G.timeout)return(()=>{const c=ys(),u=parseInt(window.getComputedStyle(c).width);c.style.removeProperty("transition"),c.style.width="100%";const d=parseInt(window.getComputedStyle(c).width);c.style.width=u/d*100+"%"})(),G.timeout.stop()},di=()=>{if(G.timeout){const c=G.timeout.start();return Dt(c),c}};let mi=!1;const js={};const Rc=c=>{for(let u=c.target;u&&u!==document;u=u.parentNode)for(const d in js){const m=u.getAttribute(d);if(m)return void js[d].fire({template:m})}};var Vc=Object.freeze({__proto__:null,argsToParams:c=>{const u={};return"object"!=typeof c[0]||hi(c[0])?["title","html","icon"].forEach((d,m)=>{const T=c[m];"string"==typeof T||hi(T)?u[d]=T:void 0!==T&&Ie(`Unexpected type of ${d}! Expected "string" or "Element", got ${typeof T}`)}):Object.assign(u,c[0]),u},bindClickHandler:function gi(){js[arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data-swal-template"]=this,mi||(document.body.addEventListener("click",Rc),mi=!0)},clickCancel:()=>zt()&&zt().click(),clickConfirm:Es,clickDeny:()=>kt()&&kt().click(),enableLoading:Lt,fire:function Lc(){for(var u=arguments.length,d=new Array(u),m=0;m<u;m++)d[m]=arguments[m];return new this(...d)},getActions:En,getCancelButton:zt,getCloseButton:Sr,getConfirmButton:ct,getContainer:fe,getDenyButton:kt,getFocusableElements:vs,getFooter:mo,getHtmlContainer:Ir,getIcon:gs,getIconContent:()=>re(_["icon-content"]),getImage:oc,getInputLabel:()=>re(_["input-label"]),getLoader:vt,getPopup:X,getProgressSteps:po,getTimerLeft:()=>G.timeout&&G.timeout.getTimerLeft(),getTimerProgressBar:ys,getTitle:fo,getValidationMessage:Cr,increaseTimer:c=>{if(G.timeout){const u=G.timeout.increase(c);return Dt(u,!0),u}},isDeprecatedParameter:Jt,isLoading:()=>X().hasAttribute("data-loading"),isTimerRunning:()=>G.timeout&&G.timeout.isRunning(),isUpdatableParameter:Os,isValidParameter:Ps,isVisible:()=>Ve(X()),mixin:function Fc(c){return class u extends(this){_main(m,T){return super._main(m,Object.assign({},c,T))}}},resumeTimer:di,showLoading:Lt,stopTimer:Zo,toggleTimer:()=>{const c=G.timeout;return c&&(c.running?Zo():di())}});class Bc{constructor(u,d){this.callback=u,this.remaining=d,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=(new Date).getTime()-this.started.getTime()),this.remaining}increase(u){const d=this.running;return d&&this.stop(),this.remaining+=u,d&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const qn=["swal-title","swal-html","swal-footer"],$s=c=>{const u={};return Array.from(c.querySelectorAll("swal-param")).forEach(m=>{Vt(m,["name","value"]);const T=m.getAttribute("name"),F=m.getAttribute("value");u[T]="boolean"==typeof Ot[T]?"false"!==F:"object"==typeof Ot[T]?JSON.parse(F):F}),u},yi=c=>{const u={};return Array.from(c.querySelectorAll("swal-function-param")).forEach(m=>{const T=m.getAttribute("name"),F=m.getAttribute("value");u[T]=new Function(`return ${F}`)()}),u},Xo=c=>{const u={};return Array.from(c.querySelectorAll("swal-button")).forEach(m=>{Vt(m,["type","color","aria-label"]);const T=m.getAttribute("type");u[`${T}ButtonText`]=m.innerHTML,u[`show${Fe(T)}Button`]=!0,m.hasAttribute("color")&&(u[`${T}ButtonColor`]=m.getAttribute("color")),m.hasAttribute("aria-label")&&(u[`${T}ButtonAriaLabel`]=m.getAttribute("aria-label"))}),u},jn=c=>{const u={},d=c.querySelector("swal-image");return d&&(Vt(d,["src","width","height","alt"]),d.hasAttribute("src")&&(u.imageUrl=d.getAttribute("src")),d.hasAttribute("width")&&(u.imageWidth=d.getAttribute("width")),d.hasAttribute("height")&&(u.imageHeight=d.getAttribute("height")),d.hasAttribute("alt")&&(u.imageAlt=d.getAttribute("alt"))),u},$n=c=>{const u={},d=c.querySelector("swal-icon");return d&&(Vt(d,["type","color"]),d.hasAttribute("type")&&(u.icon=d.getAttribute("type")),d.hasAttribute("color")&&(u.iconColor=d.getAttribute("color")),u.iconHtml=d.innerHTML),u},qc=c=>{const u={},d=c.querySelector("swal-input");d&&(Vt(d,["type","label","placeholder","value"]),u.input=d.getAttribute("type")||"text",d.hasAttribute("label")&&(u.inputLabel=d.getAttribute("label")),d.hasAttribute("placeholder")&&(u.inputPlaceholder=d.getAttribute("placeholder")),d.hasAttribute("value")&&(u.inputValue=d.getAttribute("value")));const m=Array.from(c.querySelectorAll("swal-input-option"));return m.length&&(u.inputOptions={},m.forEach(T=>{Vt(T,["value"]);const F=T.getAttribute("value");u.inputOptions[F]=T.innerHTML})),u},le=(c,u)=>{const d={};for(const m in u){const T=u[m],F=c.querySelector(T);F&&(Vt(F,[]),d[T.replace(/^swal-/,"")]=F.innerHTML.trim())}return d},Yo=c=>{const u=qn.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(c.children).forEach(d=>{const m=d.tagName.toLowerCase();u.includes(m)||g(`Unrecognized element <${m}>`)})},Vt=(c,u)=>{Array.from(c.attributes).forEach(d=>{-1===u.indexOf(d.name)&&g([`Unrecognized attribute "${d.name}" on <${c.tagName.toLowerCase()}>.`,u.length?`Allowed attributes are: ${u.join(", ")}`:"To set the value, use HTML within the element."])})},Uc=c=>{const u=fe(),d=X();"function"==typeof c.willOpen&&c.willOpen(d);const T=window.getComputedStyle(document.body).overflowY;Ks(u,d,c),setTimeout(()=>{ea(u,d)},10),$e()&&(ta(u,c.scrollbarPadding,T),Array.from(document.body.children).forEach(u=>{u===fe()||u.contains(fe())||(u.hasAttribute("aria-hidden")&&u.setAttribute("data-previous-aria-hidden",u.getAttribute("aria-hidden")),u.setAttribute("aria-hidden","true"))})),!Ht()&&!G.previousActiveElement&&(G.previousActiveElement=document.activeElement),"function"==typeof c.didOpen&&setTimeout(()=>c.didOpen(d)),Qe(u,_["no-transition"])},wi=c=>{const u=X();if(c.target!==u)return;const d=fe();u.removeEventListener(Mt,wi),d.style.overflowY="auto"},ea=(c,u)=>{Mt&&An(u)?(c.style.overflowY="hidden",u.addEventListener(Mt,wi)):c.style.overflowY="auto"},ta=(c,u,d)=>{(()=>{if((/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!rt(document.body,_.iosfix)){const u=document.body.scrollTop;document.body.style.top=-1*u+"px",w(document.body,_.iosfix),Jr(),As()}})(),u&&"hidden"!==d&&Po(),setTimeout(()=>{c.scrollTop=0})},Ks=(c,u,d)=>{w(c,d.showClass.backdrop),u.style.setProperty("opacity","0","important"),q(u,"grid"),setTimeout(()=>{w(u,d.showClass.popup),u.style.removeProperty("opacity")},10),w([document.documentElement,document.body],_.shown),d.heightAuto&&d.backdrop&&!d.toast&&w([document.documentElement,document.body],_["height-auto"])};var vi={email:(c,u)=>/^[a-zA-Z0-9.+_-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]{2,24}$/.test(c)?Promise.resolve():Promise.resolve(u||"Invalid email address"),url:(c,u)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(c)?Promise.resolve():Promise.resolve(u||"Invalid URL")};function sa(c){(function gt(c){c.inputValidator||Object.keys(vi).forEach(u=>{c.input===u&&(c.inputValidator=vi[u])})})(c),c.showLoaderOnConfirm&&!c.preConfirm&&g("showLoaderOnConfirm is set to true, but preConfirm is not defined.\nshowLoaderOnConfirm should be used together with preConfirm, see usage example:\nhttps://sweetalert2.github.io/#ajax-request"),function na(c){(!c.target||"string"==typeof c.target&&!document.querySelector(c.target)||"string"!=typeof c.target&&!c.target.appendChild)&&(g('Target parameter is not valid, defaulting to "body"'),c.target="body")}(c),"string"==typeof c.title&&(c.title=c.title.split("\n").join("<br />")),Me(c)}let et;class dt{constructor(){if(typeof window>"u")return;et=this;for(var u=arguments.length,d=new Array(u),m=0;m<u;m++)d[m]=arguments[m];const T=Object.freeze(this.constructor.argsToParams(d));Object.defineProperties(this,{params:{value:T,writable:!1,enumerable:!0,configurable:!0}});const F=et._main(et.params);B.promise.set(this,F)}_main(u){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(c=>{!1===c.backdrop&&c.allowOutsideClick&&g('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`');for(const u in c)Rn(u),c.toast&&Bo(u),Ac(u)})(Object.assign({},d,u)),G.currentInstance&&(G.currentInstance._destroy(),$e()&&Yr()),G.currentInstance=et;const m=bi(u,d);sa(m),Object.freeze(m),G.timeout&&(G.timeout.stop(),delete G.timeout),clearTimeout(G.restoreFocusTimeout);const T=Gs(et);return Gr(et,m),B.innerParams.set(et,m),ra(et,T,m)}then(u){return B.promise.get(this).then(u)}finally(u){return B.promise.get(this).finally(u)}}const ra=(c,u,d)=>new Promise((m,T)=>{const F=ee=>{c.close({isDismissed:!0,dismiss:ee})};Nn.swalPromiseResolve.set(c,m),Nn.swalPromiseReject.set(c,T),u.confirmButton.onclick=()=>{(c=>{const u=B.innerParams.get(c);c.disableButtons(),u.input?se(c,"confirm"):qs(c,!0)})(c)},u.denyButton.onclick=()=>{(c=>{const u=B.innerParams.get(c);c.disableButtons(),u.returnInputValueOnDeny?se(c,"deny"):Rt(c,!1)})(c)},u.cancelButton.onclick=()=>{((c,u)=>{c.disableButtons(),u(ie.cancel)})(c,F)},u.closeButton.onclick=()=>{F(ie.close)},((c,u,d)=>{B.innerParams.get(c).toast?Pc(c,u,d):(Bn(u),bt(u),zo(c,u,d))})(c,u,F),((c,u,d,m)=>{_e(u),d.toast||(u.keydownHandler=T=>Do(c,T,m),u.keydownTarget=d.keydownListenerCapture?window:X(),u.keydownListenerCapture=d.keydownListenerCapture,u.keydownTarget.addEventListener("keydown",u.keydownHandler,{capture:u.keydownListenerCapture}),u.keydownHandlerAdded=!0)})(c,G,d,F),((c,u)=>{"select"===u.input||"radio"===u.input?jo(c,u):["text","email","number","tel","textarea"].includes(u.input)&&(Tr(u.inputValue)||wt(u.inputValue))&&(Lt(ct()),$o(c,u))})(c,d),Uc(d),ia(G,d,F),zs(u,d),setTimeout(()=>{u.container.scrollTop=0})}),bi=(c,u)=>{const d=(c=>{const u="string"==typeof c.template?document.querySelector(c.template):c.template;if(!u)return{};const d=u.content;return Yo(d),Object.assign($s(d),yi(d),Xo(d),jn(d),$n(d),qc(d),le(d,qn))})(c),m=Object.assign({},Ot,u,d,c);return m.showClass=Object.assign({},Ot.showClass,m.showClass),m.hideClass=Object.assign({},Ot.hideClass,m.hideClass),m},Gs=c=>{const u={popup:X(),container:fe(),actions:En(),confirmButton:ct(),denyButton:kt(),cancelButton:zt(),loader:vt(),closeButton:Sr(),validationMessage:Cr(),progressSteps:po()};return B.domCache.set(c,u),u},ia=(c,u,d)=>{const m=ys();De(m),u.timer&&(c.timeout=new Bc(()=>{d("timer"),delete c.timeout},u.timer),u.timerProgressBar&&(q(m),He(m,u,"timerProgressBar"),setTimeout(()=>{c.timeout&&c.timeout.running&&Dt(u.timer)})))},zs=(c,u)=>{if(!u.toast){if(!ms(u.allowEnterKey))return void oa();jc(c,u)||Mn(-1,1)}},jc=(c,u)=>u.focusDeny&&Ve(c.denyButton)?(c.denyButton.focus(),!0):u.focusCancel&&Ve(c.cancelButton)?(c.cancelButton.focus(),!0):!(!u.focusConfirm||!Ve(c.confirmButton)||(c.confirmButton.focus(),0)),oa=()=>{document.activeElement instanceof HTMLElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()};if(typeof window<"u"&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|xn--p1ai)$/)){const c=new Date,u=localStorage.getItem("swal-initiation");u?(c.getTime()-Date.parse(u))/864e5>3&&setTimeout(()=>{document.body.style.pointerEvents="none";const d=document.createElement("audio");d.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",d.loop=!0,document.body.appendChild(d),setTimeout(()=>{d.play().catch(()=>{})},2500)},500):localStorage.setItem("swal-initiation",`${c}`)}Object.assign(dt.prototype,en),Object.assign(dt,Vc),Object.keys(en).forEach(c=>{dt[c]=function(){if(et)return et[c](...arguments)}}),dt.DismissReason=ie,dt.version="11.7.3";const xt=dt;return xt.default=xt,xt}(),typeof this<"u"&&this.Sweetalert2&&(this.swal=this.sweetAlert=this.Swal=this.SweetAlert=this.Sweetalert2),typeof document<"u"&&function(B,K){var ze=B.createElement("style");if(B.getElementsByTagName("head")[0].appendChild(ze),ze.styleSheet)ze.styleSheet.disabled||(ze.styleSheet.cssText=K);else try{ze.innerHTML=K}catch{ze.innerText=K}}(document,'.swal2-popup.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;background:#fff;box-shadow:0 0 1px rgba(0,0,0,.075),0 1px 2px rgba(0,0,0,.075),1px 2px 4px rgba(0,0,0,.075),1px 3px 8px rgba(0,0,0,.075),2px 4px 16px rgba(0,0,0,.075);pointer-events:all}.swal2-popup.swal2-toast>*{grid-column:2}.swal2-popup.swal2-toast .swal2-title{margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-loading{justify-content:center}.swal2-popup.swal2-toast .swal2-input{height:2em;margin:.5em;font-size:1em}.swal2-popup.swal2-toast .swal2-validation-message{font-size:1em}.swal2-popup.swal2-toast .swal2-footer{margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-popup.swal2-toast .swal2-close{grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-popup.swal2-toast .swal2-html-container{margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-html-container:empty{padding:0}.swal2-popup.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-popup.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-popup.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-popup.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-popup.swal2-toast .swal2-actions{justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-popup.swal2-toast .swal2-styled{margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-popup.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;transform:rotate(45deg);border-radius:50%}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-popup.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}.swal2-popup.swal2-toast.swal2-show{animation:swal2-toast-show .5s}.swal2-popup.swal2-toast.swal2-hide{animation:swal2-toast-hide .1s forwards}.swal2-container{display:grid;position:fixed;z-index:1060;top:0;right:0;bottom:0;left:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:.625em;overflow-x:hidden;transition:background-color .1s;-webkit-overflow-scrolling:touch}.swal2-container.swal2-backdrop-show,.swal2-container.swal2-noanimation{background:rgba(0,0,0,.4)}.swal2-container.swal2-backdrop-hide{background:rgba(0,0,0,0) !important}.swal2-container.swal2-top-start,.swal2-container.swal2-center-start,.swal2-container.swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}.swal2-container.swal2-top,.swal2-container.swal2-center,.swal2-container.swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}.swal2-container.swal2-top-end,.swal2-container.swal2-center-end,.swal2-container.swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}.swal2-container.swal2-top-start>.swal2-popup{align-self:start}.swal2-container.swal2-top>.swal2-popup{grid-column:2;align-self:start;justify-self:center}.swal2-container.swal2-top-end>.swal2-popup,.swal2-container.swal2-top-right>.swal2-popup{grid-column:3;align-self:start;justify-self:end}.swal2-container.swal2-center-start>.swal2-popup,.swal2-container.swal2-center-left>.swal2-popup{grid-row:2;align-self:center}.swal2-container.swal2-center>.swal2-popup{grid-column:2;grid-row:2;align-self:center;justify-self:center}.swal2-container.swal2-center-end>.swal2-popup,.swal2-container.swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;align-self:center;justify-self:end}.swal2-container.swal2-bottom-start>.swal2-popup,.swal2-container.swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}.swal2-container.swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;justify-self:center;align-self:end}.swal2-container.swal2-bottom-end>.swal2-popup,.swal2-container.swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;align-self:end;justify-self:end}.swal2-container.swal2-grow-row>.swal2-popup,.swal2-container.swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}.swal2-container.swal2-grow-column>.swal2-popup,.swal2-container.swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}.swal2-container.swal2-no-transition{transition:none !important}.swal2-popup{display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:32em;max-width:100%;padding:0 0 1.25em;border:none;border-radius:5px;background:#fff;color:#545454;font-family:inherit;font-size:1rem}.swal2-popup:focus{outline:none}.swal2-popup.swal2-loading{overflow-y:hidden}.swal2-title{position:relative;max-width:100%;margin:0;padding:.8em 1em 0;color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word}.swal2-actions{display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:center;width:auto;margin:1.25em auto 0;padding:0}.swal2-actions:not(.swal2-loading) .swal2-styled[disabled]{opacity:.4}.swal2-actions:not(.swal2-loading) .swal2-styled:hover{background-image:linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1))}.swal2-actions:not(.swal2-loading) .swal2-styled:active{background-image:linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2))}.swal2-loader{display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}.swal2-styled{margin:.3125em;padding:.625em 1.1em;transition:box-shadow .1s;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}.swal2-styled:not([disabled]){cursor:pointer}.swal2-styled.swal2-confirm{border:0;border-radius:.25em;background:initial;background-color:#7066e0;color:#fff;font-size:1em}.swal2-styled.swal2-confirm:focus{box-shadow:0 0 0 3px rgba(112,102,224,.5)}.swal2-styled.swal2-deny{border:0;border-radius:.25em;background:initial;background-color:#dc3741;color:#fff;font-size:1em}.swal2-styled.swal2-deny:focus{box-shadow:0 0 0 3px rgba(220,55,65,.5)}.swal2-styled.swal2-cancel{border:0;border-radius:.25em;background:initial;background-color:#6e7881;color:#fff;font-size:1em}.swal2-styled.swal2-cancel:focus{box-shadow:0 0 0 3px rgba(110,120,129,.5)}.swal2-styled.swal2-default-outline:focus{box-shadow:0 0 0 3px rgba(100,150,200,.5)}.swal2-styled:focus{outline:none}.swal2-styled::-moz-focus-inner{border:0}.swal2-footer{justify-content:center;margin:1em 0 0;padding:1em 1em 0;border-top:1px solid #eee;color:inherit;font-size:1em}.swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:5px;border-bottom-left-radius:5px}.swal2-timer-progress-bar{width:100%;height:.25em;background:rgba(0,0,0,.2)}.swal2-image{max-width:100%;margin:2em auto 1em}.swal2-close{z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:color .1s,box-shadow .1s;border:none;border-radius:5px;background:rgba(0,0,0,0);color:#ccc;font-family:serif;font-family:monospace;font-size:2.5em;cursor:pointer;justify-self:end}.swal2-close:hover{transform:none;background:rgba(0,0,0,0);color:#f27474}.swal2-close:focus{outline:none;box-shadow:inset 0 0 0 3px rgba(100,150,200,.5)}.swal2-close::-moz-focus-inner{border:0}.swal2-html-container{z-index:1;justify-content:center;margin:1em 1.6em .3em;padding:0;overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word}.swal2-input,.swal2-file,.swal2-textarea,.swal2-select,.swal2-radio,.swal2-checkbox{margin:1em 2em 3px}.swal2-input,.swal2-file,.swal2-textarea{box-sizing:border-box;width:auto;transition:border-color .1s,box-shadow .1s;border:1px solid #d9d9d9;border-radius:.1875em;background:rgba(0,0,0,0);box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(0,0,0,0);color:inherit;font-size:1.125em}.swal2-input.swal2-inputerror,.swal2-file.swal2-inputerror,.swal2-textarea.swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}.swal2-input:focus,.swal2-file:focus,.swal2-textarea:focus{border:1px solid #b4dbed;outline:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(100,150,200,.5)}.swal2-input::placeholder,.swal2-file::placeholder,.swal2-textarea::placeholder{color:#ccc}.swal2-range{margin:1em 2em 3px;background:#fff}.swal2-range input{width:80%}.swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}.swal2-range input,.swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}.swal2-input{height:2.625em;padding:0 .75em}.swal2-file{width:75%;margin-right:auto;margin-left:auto;background:rgba(0,0,0,0);font-size:1.125em}.swal2-textarea{height:6.75em;padding:.75em}.swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:rgba(0,0,0,0);color:inherit;font-size:1.125em}.swal2-radio,.swal2-checkbox{align-items:center;justify-content:center;background:#fff;color:inherit}.swal2-radio label,.swal2-checkbox label{margin:0 .6em;font-size:1.125em}.swal2-radio input,.swal2-checkbox input{flex-shrink:0;margin:0 .4em}.swal2-input-label{display:flex;justify-content:center;margin:1em auto 0}.swal2-validation-message{align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:#f0f0f0;color:#666;font-size:1em;font-weight:300}.swal2-validation-message::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}.swal2-icon{position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;border:0.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}.swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}.swal2-icon.swal2-error{border-color:#f27474;color:#f27474}.swal2-icon.swal2-error .swal2-x-mark{position:relative;flex-grow:1}.swal2-icon.swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}.swal2-icon.swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}.swal2-icon.swal2-warning{border-color:#facea8;color:#f8bb86}.swal2-icon.swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}.swal2-icon.swal2-info{border-color:#9de0f6;color:#3fc3ee}.swal2-icon.swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}.swal2-icon.swal2-question{border-color:#c9dae1;color:#87adbd}.swal2-icon.swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}.swal2-icon.swal2-success{border-color:#a5dc86;color:#a5dc86}.swal2-icon.swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;transform:rotate(45deg);border-radius:50%}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}.swal2-icon.swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}.swal2-icon.swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}.swal2-icon.swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}.swal2-icon.swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}.swal2-icon.swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}.swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}.swal2-progress-steps li{display:inline-block;position:relative}.swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:#add8e6;color:#fff}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:#add8e6}.swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:swal2-show .3s}.swal2-hide{animation:swal2-hide .15s forwards}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px rgba(0,0,0,.4)}@media print{body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown) .swal2-container{position:static !important}}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{top:0;right:auto;bottom:auto;left:50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{top:0;right:0;bottom:auto;left:auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{top:0;right:auto;bottom:auto;left:0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{top:50%;right:auto;bottom:auto;left:0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{top:50%;right:auto;bottom:auto;left:50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{top:50%;right:0;bottom:auto;left:auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{top:auto;right:auto;bottom:0;left:0}body.swal2-toast-shown .swal2-container.swal2-bottom{top:auto;right:auto;bottom:0;left:50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{top:auto;right:0;bottom:0;left:auto}')}}]);